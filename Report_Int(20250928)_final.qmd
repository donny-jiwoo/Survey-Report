---
title: ""
title-block: false
author: "학생맞춤지원담당관 지역협력복지팀(a.k.a. Donny)"
format: 
  html:
    theme: flatly               # bookdown과 비슷한 테마
    toc: true
    toc-location: left          # 왼쪽 사이드바
    toc-title: "목차"
    toc-depth: 3
    number-sections: false
    number-depth: 3
    code-fold: true
    code-summary: "코드 보기"
    smooth-scroll: true
    css: styles.css
editor: visual
---

# 1. 실태조사 개요

-   목적: 학생맞춤통합지원 체계안착을 위한 운영실태 조사를 통해 정책 인식도, 운영현황, 교육구성원 간 협력의 중요성과 필요성 인식 및 협력실태를 파악함으로써 향후 체계안착을 위한 개선방안 마련

-   조사대상자: 초ㆍ중ㆍ고 학교장, 교감, 교사 등 총 3,178명이 실태조사에 참여하였음 (문항에 따라서 응답 대상자수가 상이함)

-   조사방법: 교육연구정보원 통계분석(유레카) 시스템을 활용하여 데이터를 집계하였으며, R Stutio로 데이터 분석을 실시

```{r}
#| label: setup
#| echo: false
#| warning: false
#| message: false

library(rmarkdown)
library(knitr)
library(tibble)
library(dplyr)
library(ggplot2)
library(readxl)
library(janitor)
library(stringr)
library(scales)
library(RColorBrewer)
library(tidyr)
library(tidytext)
library(cluster)
library(factoextra)
library(gridExtra)    
library(kableExtra)   
library(DT)
library(gt)
library(showtext)
library(forcats)  
library(purrr)


font_add_google("Noto Sans KR", "noto")  # 구글 폰트 
showtext_auto()  # ggplot, plot에 자동 

raw_data <- read_excel("raw_data.xlsx")
dat <-raw_data 
dat <- dat %>% mutate(across(starts_with("ques_"), as.character))
```

# 2. 실태조사 (일반현황)

-   참고사항: 기술통계 현황에서 ‘n’은 응답자수를 의미하며, pct는 퍼센트를 의미함

### 문항1. 귀하의 소속 학교급은 무엇입니까?

① 초등학교 ② 중학교 ③ 고등학교 ④ 특수학교 ⑤ 각종학교

설문응답자는 총 3,178명으로 초등학교 소속이 1,282명(40.34%), 중학교 소속이 1,109명(34.9%), 고등학교 소속이 718명(22.59%), 특수학교 소속이 46명(1.45%), 각종학교 소속은 23명(0.72%)이 설문에 응답하였음

```{r}
#| echo: false
#| warning: false
#| message: false
dat <- dat %>%
  filter(ques_1 %in% c(1,2,3,4,5),
         ques_2 %in% c(1,2,3),
         !is.na(ques_7),
         !is.na(ques_9)) %>%
  mutate(
    학교급 = recode(ques_1,
                 `1` = "초등학교",
                 `2` = "중학교",
                 `3` = "고등학교",
                 `4` = "특수학교",
                 `5` = "각종학교") ,
    설립 = recode(ques_2,
                `1` = "공립",
                `2` = "사립",
                `3` = "국립")
    )

dat_q1 <- dat %>%
  mutate(ques_1 = as.character(ques_1))

# 2. 응답 항목 라벨 정의
ques1_labels <- c(
  "1" = "초등학교",
  "2" = "중학교",
  "3" = "고등학교",
  "4" = "특수학교",
  "5" = "각종학교"
)

ques1_freq <- dat_q1 %>%
  filter(!is.na(ques_1), ques_1 != "해당없음") %>%
  mutate(응답기관 = recode(ques_1, !!!ques1_labels)) %>%
  group_by(응답기관) %>%
  summarise(응답자수 = n(), .groups = "drop") %>%
  mutate(
    pct_raw = 응답자수 / sum(응답자수) * 100,
    pct = round(pct_raw, 2),
    비율 = sprintf("%.2f", pct),  # ✅ 소숫점 2자리 고정
    label = paste0(응답기관, " ", 응답자수, "명 (", pct, "%)")
  ) %>%
  arrange(desc(응답자수)) %>%
  mutate(label = fct_inorder(label))  # 순서를 유지한 범주형

# 4. 기술통계 출력
ques1_freq %>%
  transmute(응답기관, 응답자수, 비율) %>%
  bind_rows(
    tibble(
      응답기관 = "합계",
      응답자수 = sum(ques1_freq$응답자수),
      비율 = sprintf("%.2f", sum(ques1_freq$pct)) # 백분율 합계
    )
  ) %>%
  print(n = Inf)
```

```{r}
#| echo: false
#| warning: false
#| message: false
ggplot(ques1_freq, aes(x = fct_reorder(응답기관, -응답자수), y = 응답자수, fill = 응답기관)) +
  geom_bar(stat = "identity", width = 0.7) +
  geom_text(aes(label = paste0(응답자수, "명\n(", pct, "%)")),
            vjust = -0.5, size = 7) +
  labs(
    title = "응답자 소속기관",
    x = "응답자 소속기관",
    y = "응답수",
    fill = "응답기관"
  ) +
  theme_minimal(base_size = 15) +
  theme(
    plot.title = element_text(size = 32, face = "bold", hjust = 0.5),
    axis.text.x = element_text(size = 18, face = "bold", 
                               margin = margin(t = 15)),              # X축 항목과 제목 사이 간격
    axis.text.y = element_text(size = 18),                           # Y축 숫자 크게 (빈 값 → 18)
    axis.title.x = element_text(size = 20, 
                                margin = margin(t = 20)),             # X축 제목과 항목 사이 간격
    axis.title.y = element_text(size = 20, angle = 0, vjust = 0.5, hjust = 1,
                                margin = margin(r = 20)),             # Y축 제목과 숫자 사이 간격
    legend.position = "none",
    plot.margin = margin(20, 20, 20, 40)                            # 전체 여백 (위, 오른쪽, 아래, 왼쪽)
  ) +
  ylim(0, max(ques1_freq$응답자수) * 1.5)
```

### 문항2. 귀하 소속기관의 유형은?

① 공립 ② 사립 ③ 국립

설문응답자 3,178명 중에서 공립학교 소속은 2,348명(73.9%), 사립학교 소속은 810명(25.5%), 국립학교 소속은 20명(0.6%)이 응답하였음

```{r}
#| echo: false
#| warning: false
#| message: false

ques2_freq <- dat %>%
  filter(!is.na(ques_2), ques_2 != "해당없음") %>%
  mutate(응답기관 = recode(as.character(ques_2),
                       `1` = "공립",
                       `2` = "사립",
                       `3` = "국립")) %>%
  group_by(응답기관) %>%
  summarise(응답자수 = n(), .groups = "drop") %>%
  mutate(
    pct_raw = 응답자수 / sum(응답자수) * 100,
    비율 = round(pct_raw,1),
    label = paste0(응답기관, " ", 응답자수, "명 (", 비율, "%)")
  ) %>%
  arrange(desc(응답자수))  # 내림차순 정렬

# 기술통계표 출력 (참고용)
ques2_freq %>%
  select(응답기관, 응답자수, 비율) %>%
  bind_rows(
    tibble(
      응답기관 = "합계",
      응답자수 = sum(ques2_freq$응답자수),
      비율 = sum(ques2_freq$비율)  
    )
  ) %>%
  print(n = Inf)

```

```{r}
#| echo: false
#| message: false
#| warning: false
ggplot(ques2_freq, aes(x = reorder(응답기관, -응답자수), y = 응답자수, fill = 응답기관)) +  # fill을 응답기관으로 변경
  geom_bar(stat = "identity", width = 0.6) +
  geom_text(aes(label = paste0(응답자수, "명\n(", 비율, "%)")),
            vjust = -0.5, size = 7) +                                 # size 4 → 7
  labs(
    title = "응답자 소속기관 유형",
    x = "응답기관",
    y = "응답수",
    fill = "기관별 분포"
  ) +
  theme_minimal(base_size = 15) +
  theme(
    plot.title = element_text(size = 32, face = "bold", hjust = 0.5),    # 제목 크게
    axis.text.x = element_text(size = 18, face = "bold", 
                               margin = margin(t = 15)),                 # X축 항목 크고 굵게
    axis.text.y = element_text(size = 18),                              # Y축 숫자 크게
    axis.title.x = element_text(size = 20, 
                                margin = margin(t = 20)),                # X축 제목 크게
    axis.title.y = element_text(size = 20, angle = 0, vjust = 0.5, hjust = 1,
                                margin = margin(r = 20)),                # Y축 제목 가로로
    legend.position = "none",
    plot.margin = margin(20, 20, 20, 40)                               # 전체 여백
  ) +
  ylim(0, max(ques2_freq$응답자수) * 1.5)
```

### 문항3. 귀하 소속기관의 소재 자치구는?

① 강남구 ② 강동구 ③ 강북구 ④ 강서구 ⑤ 관악구 ⑥ 광진구 ⑦ 구로구 ⑧ 금천구 ⑨ 노원구 ⑩ 도봉구 ⑪ 동대문구 ⑫ 동작구 ⑬ 마포구 ⑭ 서대문구 ⑮ 서초구 ⑯ 성동구 ⑰ 성북구 ⑱ 송파구 ⑲ 양천구 ⑳ 영등포구 ㉑ 용산구 ㉒ 은평구 ㉓ 종로구 ㉔ 중구 ㉕ 중랑구

설문 응답자 3,178명 중에서 소속기관 소재지가 노원구인 응답자가 236명(7.426%)으로 가장 많았으며, 다음으로 강남구가 소재지인 응답자는 212명(6.671%)이며 중구가 73명(2.297%로)으로 25개 자치구 중에서 응답자 수가 가장 적었음

```{r}
#| echo: false
#| message: false
#| warning: false
# 1. 자치구 레이블 정의
ques3_labels <- c(
  "1" = "강남구", "2" = "강동구", "3" = "강북구", "4" = "강서구", "5" = "관악구",
  "6" = "광진구", "7" = "구로구", "8" = "금천구", "9" = "노원구", "10" = "도봉구",
  "11" = "동대문구", "12" = "동작구", "13" = "마포구", "14" = "서대문구", "15" = "서초구",
  "16" = "성동구", "17" = "성북구", "18" = "송파구", "19" = "양천구", "20" = "영등포구",
  "21" = "용산구", "22" = "은평구", "23" = "종로구", "24" = "중구", "25" = "중랑구"
)

# 2. 기술통계 생성
ques3_freq <- dat %>%
  filter(!is.na(ques_3), ques_3 %in% names(ques3_labels)) %>%
  group_by(ques_3) %>%
  summarise(n = n(), .groups = "drop") %>%
  mutate(
    label = ques3_labels[ques_3],
    pct_raw = n / sum(n) * 100,
    pct = round(pct_raw, 3),  # 일반적인 반올림
    label_full = paste0(label, " (", n, "명 / ", pct, "%)")
  )

# 3. 기술통계 요약 출력

ques3_freq <- ques3_freq %>%
  mutate(
    pct_str = sprintf("%.3f", pct)
  )

# 출력
print(
  ques3_freq %>%
    arrange(desc(n)) %>%
    select(label, n, pct_str) %>%
    bind_rows(
      tibble(
        label = "합계",
        n = sum(ques3_freq$n),
        pct_str = sprintf("%.2f", sum(ques3_freq$pct)) # 합계는 100.00%
      )
    ),
  n = Inf
)
```

```{r}
#| echo: false
#| message: false
#| warning: false
ggplot(ques3_freq, aes(x = n, y = reorder(label, n), fill = label)) +
  geom_bar(stat = "identity", width = 0.6) +
  geom_text(aes(label = paste0(n, "명 (", pct, "%)")), hjust = -0.1, size = 7) +  # size 3.8 → 7
  labs(
    title = "응답자 소속기관 소재지 현황",
    x = "응답수",
    y = "자치구",
    fill = "자치구"
  ) +
  theme_minimal(base_size = 15) +  # base_size 13 → 15
  theme(
    plot.title = element_text(size = 32, face = "bold", hjust = 0.5),  # size 16 → 32
axis.text.x = element_text(size = 18, margin = margin(t = 10)),  # t = 10 추가 (x축 텍스트와 제목 간격)
axis.text.y = element_text(size = 18),
axis.title.x = element_text(size = 20, angle = 0, margin = margin(t = 15)),  # t = 15 추가 (x축 제목 위쪽 여백)
axis.title.y = element_text(size = 20, angle = 0, vjust = 0.5),  # size 20 추가
    legend.position = "none"
  ) +
  xlim(0, max(ques3_freq$n) * 1.30)
```

### 문항4. 귀하의 소속기관은 교육부 학생맞춤통합지원 선도학교입니까?

① 그렇다 ② 아니다

설문 응답자 3,178명 중에서 선도학교 소속인 응답자는 212명(6.7%), 선도학교 소속이 아닌 응답자는 2,966명(93.3%)이 설문에 응답하였음

```{r}
#| echo: false
#| message: false
#| warning: false
# 1. 라벨 정의
ques4_labels <- c(
  "1" = "그렇다",
  "2" = "아니다"
)

# 2. 기술통계 생성
ques4_freq <- dat %>%
  filter(!is.na(ques_4), ques_4 %in% names(ques4_labels)) %>%
  group_by(ques_4) %>%
  summarise(n = n(), .groups = "drop") %>%
  mutate(
    응답 = ques4_labels[ques_4],
    pct_raw = n / sum(n) * 100,
    pct = round(pct_raw, 1),
    label = paste0(응답, " ", n, "명 (", pct, "%)")
  ) %>%
  arrange(desc(n))  # 내림차순 정렬

# 3. 기술통계 출력
ques4_freq %>%
  select(응답, n, pct) %>%
  bind_rows(
    tibble(
      응답 = "합계",
      n = sum(ques4_freq$n),
      pct = sum(ques4_freq$pct)  # ✅ 합계는 100% 예상
    )
  ) %>%
  print(n = Inf)
```

```{r}
#| echo: false
#| message: false
#| warning: false
ggplot(ques4_freq, aes(x = reorder(응답, -n), y = n, fill = 응답)) +  # fill을 응답으로 변경
  geom_bar(stat = "identity", width = 0.6) +
  geom_text(aes(label = paste0(n, "명\n(", pct, "%)")), 
            vjust = -0.3,           # 막대 위로 더 띄우기
            size = 7,               # size 4.5 → 7
            fontface = "bold") +    # 글씨 굵게
  labs(
    title = "선도학교 여부",
    x = "응답항목",
    y = "응답수",
    fill = "응답"
  ) +
  theme_minimal(base_size = 15) +  # base_size 13 → 15
  theme(
    plot.title = element_text(size = 32, face = "bold", hjust = 0.5),  # size 16 → 32
axis.text.x = element_text(size = 18, margin = margin(t = 10)),  # t = 10 추가 (x축 텍스트와 제목 간격)
axis.text.y = element_text(size = 18),
axis.title.x = element_text(size = 20, angle = 0, margin = margin(t = 15)),  # t = 15 추가 (x축 제목 위쪽 여백)
axis.title.y = element_text(size = 20, angle = 0, vjust = 0.5),  # size 20 추가
    legend.position = "none"     # 범례 완전히 제거
  ) +
  ylim(0, max(ques4_freq$n) * 1.6)
```

### 문항5. 귀하의 소속기관은 교육복지사업학교 거점학교(지역사회교육전문가 배치학교) 입니까?

① 그렇다 ② 아니다

설문 응답자 3,178명 중에서 거점학교 소속 응답자는 811명(25.5%), 거점학교 소속이 아닌 응답자는 2,367명(74.5%)가 설문에 응답하였음

```{r}
#| echo: false
#| message: false
#| warning: false
ques5_labels <- c(
  "1" = "그렇다",
  "2" = "아니다"
)

# 2. 기술통계 생성
ques5_freq <- dat %>%
  filter(!is.na(ques_5), ques_5 %in% names(ques5_labels)) %>%
  group_by(ques_5) %>%
  summarise(n = n(), .groups = "drop") %>%
  mutate(
    응답 = ques5_labels[ques_5],
    pct_raw = n / sum(n) * 100,
    pct = round(pct_raw, 1),
    label = paste0(응답, " ", n, "명 (", pct, "%)")
  ) %>%
  arrange(desc(n))  # 내림차순 정렬

# 3. 기술통계 출력
ques5_freq %>%
  select(응답, n, pct) %>%
  bind_rows(
    tibble(
      응답 = "합계",
      n = sum(ques5_freq$n),
      pct = sum(ques5_freq$pct)  # ✅ 합계는 100% 예상
    )
  ) %>%
  print(n = Inf)

```

```{r}
#| echo: false
#| message: false
#| warning: false
ggplot(ques5_freq, aes(x = reorder(응답, -n), y = n, fill = 응답)) +
 geom_bar(stat = "identity", width = 0.6) +
 # ✅ 막대 위 명수+퍼센트 표시
 geom_text(aes(label = paste0(n, "명\n(", pct, "%)")), 
           vjust = -0.3, size = 7) +  # size 4 → 7
 labs(
   title = "교육복지 거점학교 여부",
   x = "응답항목",
   y = "응답수",
   fill = "응답"
 ) +
 ylim(0, max(ques5_freq$n) * 1.2) +        # ✅ 막대 위 20% 여유 공간
 theme_minimal(base_size = 15) +  # base_size 13 → 15
 theme(
   plot.title = element_text(size = 32, face = "bold", hjust = 0.5),  # size 16 → 32
axis.text.x = element_text(size = 18, margin = margin(t = 10)),  # t = 10 추가 (x축 텍스트와 제목 간격)
axis.text.y = element_text(size = 18),
axis.title.x = element_text(size = 20, angle = 0, margin = margin(t = 15)),  # t = 15 추가 (x축 제목 위쪽 여백)
axis.title.y = element_text(size = 20, angle = 0, vjust = 0.5),  # size 20 추가
   legend.position = "none"
 )
```

### 문항6. 귀하의 소속기관은 ‘지역연계중점학교’입니까?

① 그렇다 ② 아니다

설문 응답자 3,178명 중에서 1유형 중점학교 소속 응답자는 194명(6.1%), 2유형 중점학교 소속 응답자는 221명(7%), 중점학교 소속이 아닌 응답자는 2,763명(86.9%)이 설문에 응답하였음

```{r}
#| echo: false
#| message: false
#| warning: false
# 1. 라벨 정의
ques6_labels <- c(
  "1" = "1유형 중점학교",
  "2" = "2유형 중점학교",
  "3" = "아니다"
)

# 2. 기술통계 생성
ques6_freq <- dat %>%
  filter(!is.na(ques_6), ques_6 %in% names(ques6_labels)) %>%
  group_by(ques_6) %>%
  summarise(n = n(), .groups = "drop") %>%
  mutate(
    응답 = ques6_labels[ques_6],
    pct_raw = n / sum(n) * 100,
    pct = round(pct_raw, 1),
    pct_label = sprintf("%.1f", pct),    # ✅ 소숫점 1자리 고정
    label = paste0(응답, " ", n, "명 (", sprintf("%.1f", pct), "%)")
  ) %>%
  arrange(desc(n))

# 3. 기술통계 출력
ques6_freq %>%
  transmute(응답, n, pct_label) %>%
  bind_rows(
    tibble(
      응답 = "합계",
      n = sum(ques6_freq$n),
      pct_label = sprintf("%.1f", sum(ques6_freq$pct))
    )
  ) %>%
  print(n = Inf)
```

```{r}
#| echo: false
#| message: false
#| warning: false
ggplot(ques6_freq, aes(x = reorder(응답, -n), y = n, fill = 응답)) +
 geom_bar(stat = "identity", width = 0.6) +
 geom_text(aes(label = paste0(n, "명\n(", pct, "%)")), 
           vjust = -0.5, size = 7) +  # size 4 → 7
 labs(
   title = "지역연계중점학교 여부",
   x = "응답항목",
   y = "응답수",
   fill = "응답"
 ) +
 ylim(0, max(ques6_freq$n) * 1.4) +  # 이 줄 추가
 theme_minimal(base_size = 15) +  # base_size 13 → 15
 theme(
   plot.title = element_text(size = 32, face = "bold", hjust = 0.5),  # size 16 → 32
axis.text.x = element_text(size = 18, margin = margin(t = 10)),  # t = 10 추가 (x축 텍스트와 제목 간격)
axis.text.y = element_text(size = 18),
axis.title.x = element_text(size = 20, angle = 0, margin = margin(t = 15)),  # t = 15 추가 (x축 제목 위쪽 여백)
axis.title.y = element_text(size = 20, angle = 0, vjust = 0.5),  # size 20 추가
   legend.position = "none"
 )
```

### 문항7. 귀하의 직위(직급)를 선택해 주세요.

① 교장 ② 교감 ③ 교사 ④ 상담교사 ⑤ 보건교사 ⑥ 영양교사 ⑦ 행정실장 ⑧ 지역사회교육전문가 ⑨ 상담사 ⑩ 일반 교직원

설문 응답자 3,178명 중에서 교사는 1,469명(46.2%), 교감은 780명(24.5%), 학교장은 487명(15.3%), 상담교사는 156명(4.9%), 지역사회교육전문가는 125명(3.9%), 일반 교직원은 65명(2.0%), 상담사는 51명(1.6%), 보건교사는 41명(1.3%), 영양교사는 2명(0.1%), 행정실장은 2명(0.1%)이 설문에 응답하였음

```{r}
#| echo: false
#| message: false
#| warning: false
ques7_labels <- c(
  "1" = "학교장",
  "2" = "교감",
  "3" = "교사",
  "4" = "상담교사",
  "5" = "보건교사",
  "6" = "영양교사",
  "7" = "행정실장",
  "8" = "지역사회교육전문가",
  "9" = "상담사",
  "10" = "일반 교직원")

# 2. 기술통계 생성
ques7_freq <- dat %>%
  filter(!is.na(ques_7), ques_7 %in% names(ques7_labels)) %>%
  group_by(ques_7) %>%
  summarise(n = n(), .groups = "drop") %>%
  mutate(
    응답 = ques7_labels[ques_7],
    pct_raw = n / sum(n) * 100,
    pct = round(pct_raw, 2),
    pct_label = sprintf("%.1f", pct),           # ✅ 추가
    label = paste0(응답, " ", n, "명 (", pct_label, "%)")
  ) %>%
  arrange(desc(n)) # 내림차순 정렬

# 3. 기술통계 출력
ques7_freq %>%
  transmute(응답, n, pct_label) %>%
  bind_rows(
    tibble(
      응답 = "합계",
      n = sum(ques7_freq$n),
      pct_label = sprintf("%.1f", sum(ques7_freq$pct))
    )
  ) %>%
  print(n = Inf)
```

```{r}
#| echo: false
#| message: false
#| warning: false
ggplot(ques7_freq, aes(x = n, y = reorder(응답, n), fill = 응답)) +
  geom_bar(stat = "identity", width = 0.6) +
  geom_text(aes(label = paste0(n, "명 (", pct_label, "%)")), hjust = -0.1, size = 7) +
  labs(
    title = "응답자 직위(직급) 현황",
    x = "응답수",
    y = "직위(직급)",
    fill = "직위(직급)"
  ) +
  theme_minimal(base_size = 15) +
  theme(
    plot.title = element_text(size = 32, face = "bold", hjust = 0.5),
    axis.text.x = element_text(size = 18, margin = margin(t = 10)),
    axis.text.y = element_text(size = 18),
    axis.title.x = element_text(size = 20, angle = 0, margin = margin(t = 15)),
    axis.title.y = element_text(size = 20, angle = 0, vjust = 0.5),
    legend.position = "none"
  ) +
  xlim(0, max(ques7_freq$n) * 1.30)
```

### 문항8. 귀하가 보직교사일 경우 보직의 명칭을 적어주세요. (예: 수업연구부장 등)

설문 응답자 1,105명 중에서 교육복지부장은 345명(31.2%), 교무부장은 188명(17%), 생활부장은 161명(14.6%), 학년부장은 86명(7.8%), 연구부장은 77명(7%), 상담부장은 64명(5.8%), 진로교육부장은 38명(3.4%), 교육과정부장은 26명(2.4%), 기초학력부장은 17명(1.5%)이고 이외 기타 보직의 부장이 103명(9.3%)이었음

```{r}
#| echo: false
#| message: false
#| warning: false
# 1. NA 제거한 데이터만 사용
dat_clean <- dat %>%
  filter(!is.na(ques_8))

# 2. 상위 10개 항목 추출
top9 <- dat_clean %>%
  filter(!is.na(ques_8)) %>%           # NA 제거
  count(ques_8, sort = TRUE) %>%
  slice_head(n = 9) %>%
  pull(ques_8)

# 3. 대분류 열 생성 (상위 9개 그대로, 나머지는 기타)
dat_clean <- dat_clean %>%
  mutate(
    직책 = if_else(ques_8 %in% top9, ques_8, "기타")
  )

# 4. 기술통계 계산
ques8_summary <- dat_clean %>%
  filter(!is.na(직책)) %>%
  count(직책, sort = TRUE) %>%
  mutate(
    pct_raw = n / sum(n) * 100,
    pct = round(pct_raw, 1),
    label = paste0(n, "명 (", pct, "%)")
  )

ques8_summary %>%
  transmute(직책, n, pct) %>%
  bind_rows(
    tibble(
      직책 = "합계",
      n = sum(ques8_summary$n),
      pct = sum(ques8_summary$pct)
    )
  ) %>%
  print(n = Inf)
```

```{r}
#| echo: false
#| message: false
#| warning: false
# 1. 막대그래프 (수평)
ggplot(ques8_summary, aes(x = reorder(직책, n), y = n, fill = 직책)) +
  geom_bar(stat = "identity", width = 0.6) +
  geom_text(aes(label = label), hjust = -0.05, size = 7) +
  coord_flip() +  # 수평 막대
  labs(
    title = "응답자 보직(부장교사)",
    x = "응답자 직책",
    y = "응답수"
  ) +
  theme_minimal(base_size = 15) +
  theme(
    plot.title = element_text(size = 32, face = "bold", hjust = 0.5),
    legend.position = "none",
    axis.text.x = element_text(size = 18, margin = margin(t = 10)),
    axis.text.y = element_text(size = 18),
    axis.title.x = element_text(size = 20, angle = 0, margin = margin(t = 15)),
    axis.title.y = element_text(size = 20, angle = 0, vjust = 0.5)
  ) +  # 여기에 ) 추가
  scale_y_continuous(limits = c(0, max(ques8_summary$n) * 1.25))  # ylim 대신 scale_y_continuous 사용
```

# 3. 실태조사 (학생맞춤통합지원 정책에 대한 인식 조사)

### 문항9. 학생맞춤통합지원 정책에 대해 어느정도 알고 계십니까?

① 잘 알고 있다 ② 조금 알고 있다 ③ 보통이다 ④ 잘 모른다 ⑤ 전혀 모른다

학생맞춤통합지원 정책 인식도 문항에 총 응답자는 3,178명이며, 학생맞춤통합지원 정책을 잘 알고 있다는 답변한 응답자는 1,268명(39.9%), 조금 알고 있다고 답변한 응답자는 1,351명(42.5%), 보통이다고 답변한 응답자는 391명(12.3%), 잘 모른다고 답변한 응답는 153명(4.8%), 전혀 모른다고 답변한 응답는 15명(0.5%)으로 나타났음

```{r}
#| echo: false
#| message: false
#| warning: false
ques9_freq <- dat %>%
 filter(!is.na(ques_9), ques_9 %in% as.character(1:5)) %>%
 count(ques_9) %>%
 mutate(
   응답 = recode(ques_9,
                "1" = "잘 알고 있다",
                "2" = "조금 알고 있다", 
                "3" = "보통이다",
                "4" = "잘 모른다",
                "5" = "전혀 모른다"),
   pct = round(n / sum(n) * 100, 1)
 ) %>%
 arrange(desc(n)) %>%
 bind_rows(summarise(., 응답 = "합계", n = sum(n), pct = sum(pct)))
print(ques9_freq %>% select(응답, n, pct), n = Inf)
```

```{r}
#| echo: false
#| message: false
#| warning: false
ggplot(ques9_freq %>% filter(응답 != "합계"), aes(x = reorder(응답, -n), y = n, fill = 응답)) +
  geom_bar(stat = "identity", width = 0.5) +
  geom_text(aes(label = paste0(n, "명 (", pct, "%)")), 
            vjust = -0.5, size = 7) +
  labs(
    title = "학생맞춤통합지원 정책인식도",
    x = "정책인식도",
    y = "응답수"
  ) +
  theme_minimal(base_size = 12) +
  theme(
  plot.title = element_text(face = "bold", size = 32, hjust = 0.5),  # size 16 → 32
  strip.text = element_text(size = 20, face = "bold"),  # 그룹별 제목 크기 추가
  axis.text.x = element_text(size = 23, margin = margin(t = 10)),  # 추가
  axis.text.y = element_text(size = 25),  # 추가
  axis.title.x = element_text(size = 25, angle = 0, margin = margin(t = 15)),  # 추가
  axis.title.y = element_text(size = 20, angle = 0, vjust = 0.5),  # size 20 추가
  legend.position = "none"
) +
  ylim(0, max(ques9_freq$n[ques9_freq$응답 != "합계"]) * 1.15)  # ylim에서도 합계 제외 
```

분석과정

1\) 응답자 유형 분류: 직책별(학교장, 교감, 교사 등), 학교급별(초등학교, 중학교, 고등학교), 설립별(공립, 사립)으로 구분하였음. 유형별 비교를 위해 응답자 수가 적은 특수학교, 각종학교 및 공립학교는 조사대상자에서 제외하였음. 이와 같이 응답자 유형을 분류하고 응답자 집단 간의 답변 분포를 비교하였음.

2\) 인식도 점수 산출방법: ‘잘 알고 있다’는 5점을 부여하고 ‘조금 알고 있다’는 4점, ‘보통이다’는 3점, ‘잘 모른다’는 2점, ‘전혀 모른다’는 1점을 부여하여 인식도 점수를 산출하였음.

이와 같이 산출한 점수를 직책별(학교장, 교감, 교사 등), 학교급별(초등학교, 중학교, 고등학교), 설립별(공립, 사립)으로 구분하여 집단 간 평균 점수차이가 유의미한지 분석하였음

### 문항 9-1. 직책별 정책인식도 분석

직책별 응답자는 총 3,090명이며 이 중에서 학교장은 474명(15.34%), 교감은 761명(24.63%), 교사 등은 1,855명(60.03%)이 응답하였음.

학교장 응답 중에서 매우 그렇다는 222명(46.8%), 그렇다는 198명(41.8%), 보통이다는 51명(10.8%), 그렇지 않다는 3명(0.6%)이었음.

교감 응답 중에서 매우 그렇다는 295명(38.8%), 그렇다는 359명(47.2%), 보통이다는 87명(11.4%), 그렇지 않다는 18명(2.4%), 매우 그렇지 않다는 2명(0.3%)이었음

교사 등 응답 중에서 매우 그렇다는 698명(37.63%), 그렇다는 783명(42.21%), 보통이다는 312명(16.82%), 그렇지 않다는 47명(2.53%), 매우 그렇지 않다는 15명(0.81%)이었음

```{r}
#| echo: false
#| warning: false
#| message: false
dat_filtered <- dat %>%
  filter(ques_1 %in% c(1,2,3),
         ques_2 %in% c(1,2),
         !is.na(ques_7),
         !is.na(ques_9)) %>%
  mutate(
    학교급 = factor(recode(ques_1,
                         `1` = "초등학교",
                         `2` = "중학교",
                         `3` = "고등학교"),
                   levels = c("초등학교", "중학교", "고등학교")),
    설립 = factor(recode(ques_2,
                       `1` = "공립",
                       `2` = "사립"),
                 levels = c("공립", "사립")),
    직책 = factor(case_when(
      ques_7 == 1 ~ "학교장",
      ques_7 == 2 ~ "교감",
      ques_7 %in% 3:10 ~ "교사 등",
      TRUE ~ NA_character_
    ), levels = c("학교장", "교감", "교사 등")),
    정책인식도 = factor(as.character(ques_9),
                   levels = c("1","2","3","4","5"),
                   labels = c("잘 알고 있다","조금 알고 있다","보통이다","잘 모른다","전혀 모른다")),
    정책인식도점수 = case_when(
      ques_9 == 1 ~ 5,   # 잘 알고 있다
      ques_9 == 2 ~ 4,   # 조금 알고 있다
      ques_9 == 3 ~ 3,   # 보통이다
      ques_9 == 4 ~ 2,   # 잘 모른다
      ques_9 == 5 ~ 1,   # 전혀 모른다
      TRUE ~ NA_real_
    )
  )
# 1. 교차표 생성
summary_table <- dat_filtered %>%
  group_by(직책, 정책인식도) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  mutate(pct = round(n / sum(n) * 100, 1)) %>%  # 직책별 비율(%)
  ungroup()

# 2. 직책별 합계 행 추가
summary_with_total <- summary_table %>%
  group_by(직책) %>%
  summarise(
    n = sum(n),
    pct = sum(pct),
    정책인식도 = "합계"
  ) %>%
  bind_rows(summary_table) %>%
  arrange(
    factor(직책, levels = c("학교장","교감","교사 등")),
    정책인식도 == "합계",  # 합계가 마지막에
    if_else(정책인식도 != "합계", -n, 0)  # 합계가 아닌 경우만 빈도 역순
  )

# 3. 전체 합계 행 추가
summary_final <- summary_with_total %>%
  bind_rows(
    summary_with_total %>%
      summarise(
        직책 = "전체 합계",
        n = sum(n[정책인식도 == "합계"]),
        pct = 100,
        정책인식도 = "합계"
      )
  )
print(summary_final, n = Inf)

tab1 <- table(dat_filtered$직책, dat_filtered$정책인식도)
chisq_test1 <- chisq.test(tab1)
print(chisq_test1)
```

```{r}
#| echo: false
#| warning: false
#| message: false
summary_job <- dat_filtered %>%
 group_by(직책, 정책인식도) %>%
 summarise(n = n(), .groups = "drop_last") %>%
 mutate(pct = round(n / sum(n) * 100, 1)) %>%
 ungroup() %>%
 # 정책인식도 순서 지정 (긍정적인 순서대로)
 mutate(정책인식도 = factor(정책인식도, 
                       levels = c("잘 알고 있다", "조금 알고 있다", "보통이다", 
                                "잘 모른다", "전혀 모른다")))

p0 <- ggplot(summary_job, aes(x = factor(직책, levels = c("학교장", "교감", "교사 등")), 
                             y = pct, fill = 정책인식도)) +
 geom_bar(stat = "identity", width = 0.7) +
 labs(
   title = "직책별 정책인식도",
   x = "직책",
   y = "비율",
   fill = "정책인식도"
 ) +
 scale_y_continuous(limits = c(0, 100), expand = expansion(mult = c(0, 0.02))) +
 theme_minimal(base_size = 15) +
 theme(
   plot.title = element_text(face = "bold", size = 32, hjust = 0.5),
   axis.text.x = element_text(size = 20, face = "bold"),
   axis.text.y = element_text(size = 18),
   axis.title.x = element_text(size = 25, angle = 0, margin = margin(t = 15)),
   axis.title.y = element_text(size = 20, angle = 0, vjust = 0.5),
   legend.position = "right",
   legend.text = element_text(size = 14),
   legend.title = element_text(size = 16, face = "bold")
 )

print(p0)
```

학교장(4.6), 교감(4.51), 교사 등(3.94) 직책별로 정책인식도 평균점수를 비교한 결과, 학교장과 교감 간에는 유의미한 차이는 없었지만, 학교장-교사 등, 교감-교사 등 간에는 유의미한 인식도 차이가 있는 것으로 나타남

(정책인식도 평균점수는 학교장 \>교사 등, 교감 \> 교사 등 순으로 나타남)

```{r}
#| echo: false
#| warning: false
#| message: false
# 직책별 기술통계 (순서 지정)
job_summary <- dat_filtered %>%
  mutate(직책 = factor(직책, levels = c("학교장", "교감", "교사 등"))) %>%  # 순서 지정
  group_by(직책) %>%
  summarise(
    평균 = round(mean(정책인식도점수, na.rm = TRUE), 2),
    표준편차 = round(sd(정책인식도점수, na.rm = TRUE), 2),
    n = n(),
    .groups = "drop"
  ) %>%
  arrange(직책)  # factor 레벨 순서대로 정렬

print(job_summary)

# ANOVA (dat_filtered에서도 직책 순서 지정)
dat_filtered <- dat_filtered %>%
  mutate(직책 = factor(직책, levels = c("학교장", "교감", "교사 등")))

anova_job <- aov(정책인식도점수 ~ 직책, data = dat_filtered)
summary(anova_job)

# Tukey 사후검정
tukey_job <- TukeyHSD(anova_job)
print(tukey_job)
```

```{r}
#| echo: false
#| warning: false
#| message: false
# Tukey 그룹 레터 생성
tukey_letters_job <- multcompView::multcompLetters4(anova_job, tukey_job)
letters_df_job <- data.frame(
  직책 = names(tukey_letters_job$`직책`$Letters),
  group = tukey_letters_job$`직책`$Letters
)

job_summary_with_groups <- job_summary %>%
  left_join(letters_df_job, by = "직책")


# 직책별 박스플롯
ggplot(dat_filtered, aes(x = 직책, y = 정책인식도점수, fill = 직책)) +
  geom_boxplot(alpha = 0.7, width = 0.6, outlier.shape = 21) +
  stat_summary(fun = mean, geom = "point", shape = 23, size = 4, fill = "yellow", stroke = 1) +
  geom_text(data = job_summary_with_groups, 
            aes(x = 직책, y = 6, label = paste0(group, "\n(M=", 평균, ")")),
            inherit.aes = FALSE, fontface = "bold", size = 9, vjust = 0, lineheight =0.5) +
  labs(
    title = "직책별 정책인식도",
    x = "직책", 
    y = "정책인식도"
  ) +
  theme_minimal(base_size = 15) +
  theme(
    plot.title = element_text(face = "bold", size = 32, hjust = 0.5),
    plot.subtitle = element_text(size = 18, hjust = 0.5, color = "gray40"),
    axis.text.x = element_text(size = 20),
    axis.text.y = element_text(size = 20),
    axis.title.x = element_text(size = 20, margin = margin(t = 15)),
    axis.title.y = element_text(size = 20, angle = 0, vjust = 0.5),
    legend.position = "none"
  ) +
  scale_y_continuous(expand = expansion(mult = c(0.05, 0.30)))
```

### 문항 9-2. 학교급별 정책인식도 분석

학교급별 응답자는 총 3,090명이며, 초등학교 응답자는 1,277명(41.33%), 중학교 응답자는 1,100명(35.60%), 고등학교 응답자는 713명(23.07%)이 응답하였음

초등학교 응답 중에서 잘 알고 있다는 597명(46.8%), 조금 알고 있다는 507명(39.7%), 보통이다는 126명(9.87%), 잘 모른다는 44명(3.45%), 전혀 모른다는 3명(0.23%)이었음

중학교 응답 중에서 잘 알고 있다는 499명(45.4%), 조금 알고 있다는 427명(38.8%), 보통이다는 122명(11.1%), 잘 모른다는 48명(4.36%), 전혀 모른다는 4명(0.36%)이었음

고등학교 응답 중에서 잘 알고 있다는 306명(42.9%), 조금 알고 있다는 227명(31.8%), 보통이다는 132명(18.5%), 잘 모른다는 42명(5.89%), 전혀 모른다는 6명(0.84%)이었음

```{r}
#| echo: false
#| warning: false
#| message: false
# 학교급별 정책 인식도 분포
summary_school <- dat_filtered %>%
  group_by(학교급, 정책인식도) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  mutate(pct = round(n / sum(n) * 100,2)) %>%
  ungroup() %>%
  mutate(정책인식도 = factor(정책인식도, 
                        levels = c("잘 알고 있다", "조금 알고 있다", "보통이다", 
                                 "잘 모른다", "전혀 모른다")))


# 학교급별 합계 추가
summary_school_with_total <- summary_school %>%
  group_by(학교급) %>%
  summarise(n = sum(n), pct = sum(pct), 정책인식도 = "합계") %>%
  bind_rows(summary_school) %>%
  arrange(
    factor(학교급, levels = c("초등학교", "중학교", "고등학교", "특수학교", "각종학교")),
    정책인식도 == "합계",
    if_else(정책인식도 != "합계", -n, 0)
  )

print(summary_school_with_total, n = Inf)
tab_school <- table(dat_filtered$학교급, dat_filtered$정책인식도)

chisq_test_school <- chisq.test(tab_school)
print(chisq_test_school)
```

```{r}
#| echo: false
#| warning: false
#| message: false
# 학교급별 정책 인식도 분포
summary_school <- dat_filtered %>%
  group_by(학교급, 정책인식도) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  mutate(pct = n / sum(n) * 100) %>%
  ungroup() %>%
  mutate(정책인식도 = factor(정책인식도, 
                        levels = c("잘 알고 있다", "조금 알고 있다", "보통이다", 
                                 "잘 모른다", "전혀 모른다")))

# 100% 누적 비율 막대그래프
ggplot(summary_school, aes(x = 학교급, y = pct, fill = 정책인식도)) +
  geom_bar(stat = "identity", width = 0.7) +
  labs(
    title = "학교급별 학생맞춤통합지원 정책 인식도",
    x = "학교급",
    y = "비율",
    fill = "정책인식도"
  ) +
  scale_y_continuous(limits = c(0, 100), expand = expansion(mult = c(0, 0.02))) +
  theme_minimal(base_size = 15) +
  theme(
    plot.title = element_text(size = 32, face = "bold", hjust = 0.5),
    axis.text.x = element_text(size = 18, margin = margin(t = 10)),
    axis.text.y = element_text(size = 18),
    axis.title.x = element_text(size = 20, angle = 0, margin = margin(t = 15)),
    axis.title.y = element_text(size = 20, angle = 0, vjust = 0.5),
    legend.position = "right",
    legend.text = element_text(size = 15)
  )
```

초등학교(4.29), 중학교(4.18), 고등학교(3.99) 학교급별 정책인식도 평균점수를 비교한 결과, 초등학교, 중학교, 고등학교 정책인식도 평균 점수에는 유의미한 차이가 있는 것으로 나타남 (초등학교 \> 중학교 \> 고등학교)

```{r}
#| echo: false
#| warning: false
#| message: false
# 1) 분석용 데이터 만들기 (초/중/고만, likert 1~5 → 점수화 5~1)
dat_score <- dat_filtered %>%
  filter(ques_1 %in% 1:3, !is.na(ques_9)) %>%       # ← 다른 문항이면 ques_9를 바꾸세요
  mutate(
    학교급 = factor(recode(as.character(ques_1),
                           "1"="초등학교","2"="중학교","3"="고등학교"),
                    levels = c("초등학교","중학교","고등학교")),
    정책인식도점수 = recode(as.character(ques_9),  # 1=매우 긍정 → 5점
                       "1"=5,"2"=4,"3"=3,"4"=2,"5"=1) |> as.numeric()
  ) %>%
  select(학교급, 정책인식도점수)

# 안전장치
stopifnot(nrow(dat_score) > 0, all(!is.na(dat_score$정책인식도점수)))

# 2) 학교급별 기술통계 (factor 순서대로)
school_summary <- dat_score %>%
  group_by(학교급) %>%
  summarise(
    평균 = round(mean(정책인식도점수), 2),
    표준편차 = round(sd(정책인식도점수), 2),
    n = n(),
    .groups = "drop"
  )
print(school_summary, n = Inf)

# ANOVA
anova_school <- aov(정책인식도점수 ~ 학교급, data = dat_score)
summary(anova_school)

# Tukey 사후검정
tukey_school <- TukeyHSD(anova_school)
print(tukey_school)
```

```{r}
#| echo: false
#| warning: false
#| message: false
# Tukey 그룹 레터 생성 및 기술통계와 결합
tukey_letters_school <- multcompView::multcompLetters4(anova_school, tukey_school)
school_summary_final <- school_summary %>%
  left_join(
    data.frame(
      학교급 = names(tukey_letters_school$`학교급`$Letters),
      group = tukey_letters_school$`학교급`$Letters
    ), 
    by = "학교급"
  )

print(school_summary_final)
# 학교급별 박스플롯

ggplot(dat_filtered, aes(x = 학교급, y = 정책인식도점수, fill = 학교급)) +
  geom_boxplot(alpha = 0.7, width = 0.6, outlier.shape = 21) +
  stat_summary(fun = mean, geom = "point", shape = 23, size = 4, fill = "yellow", stroke = 1) +
  geom_text(data = school_summary_final, 
            aes(x = 학교급, y = 6, label = paste0(group, "\n(M=", 평균, ")")),
            inherit.aes = FALSE, fontface = "bold", size = 9, vjust = 0, lineheight=0.5) +
  labs(
    title = "학교급별 정책인식도",
    x = "학교급", 
    y = "정책인식도"
  ) +
  theme_minimal(base_size = 15) +
  theme(
    plot.title = element_text(face = "bold", size = 32, hjust = 0.5),
    plot.subtitle = element_text(size = 18, hjust = 0.5, color = "gray40"),
    axis.text.x = element_text(size = 18),
    axis.text.y = element_text(size = 18),
    axis.title.x = element_text(size = 20, margin = margin(t = 15)),
    axis.title.y = element_text(size = 20, angle = 0, vjust = 0.5),
    legend.position = "none"
  ) +
  scale_y_continuous(expand = expansion(mult = c(0.05, 0.30)))
```

### 문항 9-3. 설립별 정책인식도 분석

설립별 응답자는 총 3,090명이며 이 중에서 공립학교 응답자는 2,317명(74.5%), 사립학교 응답자는 761명(25.5%)이 응답하였음.

공립학교 응답 중에서 매우 그렇다는 1,660명(71.6%), 그렇다는 582명(25.1%), 보통이다는 63명(2.72%), 그렇지 않다는 8명(0.35%), 매우 그렇지 않다는 4명(0.17%)이었음

사립학교 응답 중에서 매우 그렇다는 532명(68.8%), 그렇다는 215명(27.8%), 보통이다는 19명(2.46%), 그렇지 않다는 4명(0.52%), 매우 그렇지 않다는 3명(0.39%)이었음

```{r}
#| echo: false
#| warning: false
#| message: false
# 1. 설립별 데이터 준비
dat_found <- dat_filtered %>%
  filter(설립 %in% c("공립", "사립")) %>%  # 국립 제외
  mutate(설립 = factor(설립, levels = c("공립", "사립")))

# 2. 설립별 교차표
summary_found <- dat_found %>%
  group_by(설립, 정책인식도) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  mutate(pct = round(n / sum(n) * 100, 1)) %>%
  ungroup()

summary_found_total <- summary_found %>%
  group_by(설립) %>%
  summarise(n = sum(n), pct = 100, 정책인식도 = "합계", .groups = "drop") %>%
  bind_rows(summary_found) %>%
  arrange(설립, 정책인식도 == "합계", desc(n))

print(summary_found_total, n = Inf)

# 3. 카이제곱 검정
tab_found <- table(dat_found$설립, dat_found$정책인식도)
chisq_test_found <- chisq.test(tab_found)
print(chisq_test_found)
```

```{r}
#| echo: false
#| warning: false
#| message: false
# 4. 설립별 누적막대그래프
# 정책인식도 순서 지정
summary_found_plot <- summary_found %>%
  mutate(정책인식도 = factor(정책인식도, 
                        levels = c("잘 알고 있다", "조금 알고 있다", "보통이다", 
                                 "잘 모른다", "전혀 모른다")))

ggplot(summary_found_plot, aes(x = 설립, y = pct, fill = 정책인식도)) +
  geom_bar(stat = "identity", width = 0.7) +
  labs(
    title = "설립별 정책인식도",
    x = "설립",
    y = "비율",
    fill = "정책인식도"
  ) +
  scale_y_continuous(limits = c(0, 100), expand = expansion(mult = c(0, 0.02))) +
  theme_minimal(base_size = 15) +
  theme(
    plot.title = element_text(size = 32, face = "bold", hjust = 0.5),
    axis.text.x = element_text(size = 18, margin = margin(t = 10)),
    axis.text.y = element_text(size = 18),
    axis.title.x = element_text(size = 20, angle = 0, margin = margin(t = 15)),
    axis.title.y = element_text(size = 20, angle = 0, vjust = 0.5),
    legend.position = "right",
    legend.text = element_text(size = 18),
    legend.title = element_text(size = 16, face = "bold")
  )
```

공립학교(4.68), 사립학교(4.64) 평균점수를 비교한 결과, 공립학교와 사립학교 간에는 정책인식도 평균 점수에는 유의미한 차이가 있는 것으로 나타남

```{r}
#| echo: false
#| warning: false
#| message: false
# 설립별 기술통계
summary_found_stats <- dat_found %>%
  group_by(설립) %>%
  summarise(
    평균 = round(mean(정책인식도점수, na.rm = TRUE), 2),
    표준편차 = round(sd(정책인식도점수, na.rm = TRUE), 2),
    n = n(),
    .groups = "drop"
  )

print(summary_found_stats)

# 정규성 검정 (Shapiro-Wilk test)
normality_test <- dat_found %>%
  group_by(설립) %>%
  summarise(
    shapiro_p = shapiro.test(정책인식도점수)$p.value,
    .groups = "drop"
  )

print(normality_test)

# T-test (Welch's t-test - 등분산 가정하지 않음)
t_test_result <- t.test(정책인식도점수 ~ 설립, data = dat_found, var.equal = FALSE)
print(t_test_result)
```

```{r}
#| echo: false
#| warning: false
#| message: false
tukey_letters_school <- list(
  `설립` = list(
    Letters = setNames(
      if (t_test_result$p.value < 0.05) c("a","b") else c("a","a"),
      c("공립","사립")
    )
  )
)

school_summary_final <- summary_found_stats %>%
  dplyr::left_join(
    data.frame(
      설립 = names(tukey_letters_school$`설립`$Letters),
      group = unname(tukey_letters_school$`설립`$Letters)
    ),
    by = "설립"
  )


## 레터/평균 표식을 올릴 y좌표(위 여백) — 데이터 범위에 맞게 자동
y_top_estab <- max(dat_found$정책인식도점수, na.rm = TRUE) + 0.25

ggplot(dat_found, aes(x = 설립, y = 정책인식도점수, fill = 설립)) +
  geom_boxplot(alpha = 0.7, width = 0.6, outlier.shape = 21) +
  stat_summary(fun = mean, geom = "point", shape = 23, size = 4,
               fill = "yellow", stroke = 1) +
  ## ▼ 레터 + 평균(M=) 표시 (school_summary_final 사용)
  geom_text(data = school_summary_final,
            aes(x = 설립, y = y_top_estab,
                label = paste0(group, "\n(M=", 평균, ")")),
            inherit.aes = FALSE, fontface = "bold", size = 9, vjust = 0, lineheight=0.5) +
  labs(title = "설립별 정책인식도 비교",
       x = "설립", y = "정책인식도") +
  theme_minimal(base_size = 15) +
  theme(plot.title = element_text(face = "bold", size = 32, hjust = 0.5),
        axis.text.x = element_text(size = 20),
        axis.text.y = element_text(size = 20),
        axis.title.x = element_text(size = 23, margin = margin(t = 15)),
        axis.title.y = element_text(size = 23, angle = 0, vjust = 0.5),
        legend.position = "none") +
  ## 레터가 잘 보이도록 상단 여백/리밋
  scale_y_continuous(limits = c(min(dat_found$정책인식도점수, na.rm=TRUE),
                                y_top_estab + 0.1),
                     expand = expansion(mult = c(0.05, 0.15)))
```

### 문항10. \[9번 문항에서 ①번 혹은 ②번을 선택한 분들만 답변해 주시기 바랍니다.\] 학생맞춤통합지원 제도를 인지하게 된 경로는 무엇입니까?

① 교육부또는 교육(지원)청 공문(기본계획 안내 공문 등) ② 연수 또는 회의 ③ 뉴스 등 미디어 보도 및 홍보자료 ④ 주변 다른 교직원들을 통해서 ⑤ 기타

학생맞춤통합지원에 대해 인지하게 된 경로에 대한 문항에 2,619명이 응답하였고, 연수 또는 회의를 통해서 알게되었다는 응답자가 1,379명(52.7%)이고 교육부 또는 교육청 공문을 통해서라고 답변한 응답자는 1,135명(43.3%)이고 다음으로 주변 교직원을 통해 인지하게 되었다고 답변한 응답자는 60명(2.2%) 등 순으로 나타났음

```{r}
#| echo: false
#| warning: false
#| message: false
dat_q10 <- dat %>%
  filter(ques_9 %in% c(1,2), !is.na(ques_10)) %>% 
  mutate(
    학교급 = recode(as.character(ques_1),
                 "1" = "초등학교",
                 "2" = "중학교",
                 "3" = "고등학교",
                 "4" = "특수학교",
                 "5" = "각종학교"),
    학교급 = factor(학교급, levels = c("초등학교","중학교","고등학교","특수학교", "각종학교")),
    응답10 = factor(ques_10,
                  levels = 1:5,
                  labels = c(
                    " 교육부/교육청 공문",
                    " 연수 또는 회의",
                    " 뉴스 등 미디어",
                    " 주변 교직원",
                    " 기타"
                  )
    )
  )
    
summary_q10 <- dat_q10 %>%
  group_by(응답10) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  arrange(응답10, desc(n)) %>% 
  mutate(pct = round(n / sum(n) * 100, 1)) %>%
  ungroup()

# 합계 행 추가
summary_q10_total <- summary_q10 %>%
  summarise(
    응답10 = "합계",
    n = sum(n),
    pct = 100,
    .groups = "drop"
  ) %>%
  bind_rows(summary_q10) %>%
  arrange(if_else(응답10 == "합계", 2, 1),
          desc(n)
)  # 🔹 합계는 마지막에

print(summary_q10_total, n = Inf)
```

```{r}
#| echo: false
#| warning: false
#| message: false
# 3) 시각화
ggplot(summary_q10, aes(x = reorder(응답10, -n), y = n, fill = 응답10)) +
  geom_bar(stat="identity", width=0.7) +
  geom_text(aes(label = paste0(n,"명\n(",pct,"%)")), 
            vjust=-0.25, size= 8, lineheight=0.5)  +
  labs(
    title = "학생맞춤통합지원 인지 경로",
    x = "응답항목",
    y = "응답수"
  ) +
  theme_minimal(base_size = 13) +
  theme(
    plot.title = element_text(face="bold", size=32, hjust=0.5),
    legend.position = "none",
    axis.title.x = element_text(margin = margin(t = 15), size = 18),
    axis.text.x = element_text(angle=0, vjust=0.8, size = 18),
    strip.text = element_text(face="bold", size=18),
    axis.title.y = element_text(angle = 0, vjust = 0.5, size =18)  # y축 제목 가로 표시
  ) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.6)))
```

### 문항11. 학생맞춤통합지원 제도가 충분히 안내 및 홍보되고 있다고 보십니까?

① 매우 그렇다 ② 그렇다 ③ 보통이다 ④ 그렇지 않다 ⑤ 매우 그렇지 않다

학생맞춤통합지원 홍보의 충분성 문항에 총 응답자는 3,178명이며 매우 그렇다고 답변한 응답자는 401명(12.6%), 그렇다고 답변한 응답자는 1,247명(39.2%), 보통이다고 답변한 응답자는 1,117명(35.1%), 그렇지 않다고 답변한 응답자는 351명(11%), 매우 그렇지 않다고 답변한 응답자는 62명(2%)로 나타났음

```{r}
#| echo: false
#| warning: false
#| message: false
# 11번 문항 전처리
dat_q11 <- dat %>%
  filter(ques_1 %in% 1:5, !is.na(ques_11)) %>%    # 초·중·고, 응답 NA 제외
  mutate(
    응답11 = factor(
      ques_11,
      levels = 1:5,
      labels = c("매우 그렇다","그렇다","보통이다","그렇지 않다","매우 그렇지 않다")
    ))
    
# 기술통계 (빈도, 비율)
summary_q11 <- dat_q11 %>%
  group_by(응답11) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  mutate(pct = round(n / sum(n) * 100, 1)) %>%
  ungroup() %>%
  arrange(desc(n)) %>%  # 빈도수 내림차순 정렬
  bind_rows(summarise(., 응답11 = "합계", n = sum(n), pct = sum(pct)))

# ✅ 기술통계 출력
print(summary_q11, n = Inf)
```

```{r}
#| echo: false
#| warning: false
#| message: false
ggplot(summary_q11 %>% filter(응답11 != "합계") , aes(x = reorder(응답11, -n), y = n, fill = 응답11)) +
  geom_bar(stat="identity", width=0.7) +
  geom_text(aes(label = paste0(n,"명\n(",pct,"%)")), 
            vjust=-0.5, size=4.5, fontface="bold") +
  labs(
    title = "학생맞춤통합지원 홍보의 충분성",
    x = "응답항목",
    y = "응답수"
  ) +
  theme_minimal(base_size = 13) +
  theme(
    plot.title = element_text(face="bold", size=24, hjust=0.5, margin = margin(b = 18)),
    legend.position = "none",
    axis.text.x = element_text(angle=0, hjust=0.5, size=18, lineheight=0.8),
    axis.text.y = element_text(size=18),
    axis.title.x = element_text(size=18, margin = margin(t = 12)),
    axis.title.y = element_text(angle = 0, vjust = 0.5, size=18),
    strip.text = element_text(face="bold", size=15, margin = margin(t = 6, b = 6)),
    panel.spacing = unit(1.2, "lines"),  # 패널 간격 조금 증가
    plot.margin = margin(18, 18, 18, 18)
  ) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.5))) +
  coord_cartesian(clip = "off")
```

분석과정

1\) 응답자 유형 분류: 직책별(학교장, 교감, 교사 등), 학교급별(초등학교, 중학교, 고등학교), 설립별(공립, 사립)으로 구분하였음. 유형별 비교를 위해 응답자 수가 적은 특수학교, 각종학교 및 공립학교는 조사대상자에서 제외하였음. 이와 같이 응답자 유형을 분류하고 응답자 집단 간의 답변 분포를 비교하였음

2\) 응답점수 산출방법: ‘매우 그렇다’는 5점을 부여하고 ‘그렇다’는 4점, ‘보통이다’는 3점, ‘그렇지 않다’는 2점, ‘매우 그렇지 않다’는 1점을 부여하여 인식도 점수를 산출하였음

### 문항 11-1. 직책별 홍보충분성 분석

직책별 응답자는 총 3,090명이며 이 중에서 학교장은 474명(15.34%), 교감은 761명(24.63%), 교사 등은 1,855명(60.03%)이 응답하였음.

학교장 응답 중에서 매우 그렇다는 90명(19%), 그렇다는 228명(48.1%), 보통이다는 128명(27%), 그렇지 않다는 26명(5.5%), 매우 그렇지 않다는 2명(0.4%)이었음.

교감 응답 중에서 매우 그렇다는 113명(14.8%), 그렇다는 369명(48.5%), 보통이다는 236명(31%), 그렇지 않다는 37명(4.9%), 매우 그렇지 않다는 6명(0.8%)이었음.

교사 등 응답 중에서 매우 그렇다는 194명(10.5%), 그렇다는 627명(33.8%), 보통이다는 718명(38.7%), 그렇지 않다는 268명(14.4%), 매우 그렇지 않다는 48명(2.6%)이었음.

```{r}
#| echo: false
#| warning: false
#| message: false
# =============================================================================
# 문항 11: 학생맞춤통합지원 제도 홍보의 충분성 분석
# =============================================================================

# 1. 기본 빈도분석
ques11_freq <- dat_filtered %>%
  filter(!is.na(ques_11), as.character(ques_11) %in% c("1","2","3","4","5")) %>%
  count(ques_11) %>%
  mutate(
    응답 = recode(as.character(ques_11),
                 "1" = "매우 그렇다",
                 "2" = "그렇다",
                 "3" = "보통이다",
                 "4" = "그렇지 않다",
                 "5" = "매우 그렇지 않다"),
    pct = round(n / sum(n) * 100, 1)
  ) %>%
  arrange(desc(n)) %>%
  bind_rows(summarise(., 응답 = "합계", n = sum(n), pct = sum(pct)))


# =============================================================================
# 3. 분석을 위한 데이터 준비
# =============================================================================

dat_filtered <- dat_filtered %>%
  mutate(
    홍보충분성 = factor(as.character(ques_11),
                     levels = c("1","2","3","4","5"),
                     labels = c("매우 그렇다","그렇다","보통이다","그렇지 않다","매우 그렇지 않다")),
    홍보충분성점수 = case_when(
      ques_11 == 1 ~ 5,   # 매우 그렇다
      ques_11 == 2 ~ 4,   # 그렇다
      ques_11 == 3 ~ 3,   # 보통이다
      ques_11 == 4 ~ 2,   # 그렇지 않다
      ques_11 == 5 ~ 1,   # 매우 그렇지 않다
      TRUE ~ NA_real_
    )
  )
# =============================================================================
# 4. 직책별 분석
# =============================================================================

# 직책별 교차표
summary_table_11 <- dat_filtered %>%
  group_by(직책, 홍보충분성) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  mutate(pct = round(n / sum(n) * 100, 1)) %>%
  ungroup()

summary_with_total_11 <- summary_table_11 %>%
  group_by(직책) %>%
  summarise(n = sum(n), pct = sum(pct), 홍보충분성 = "합계") %>%
  bind_rows(summary_table_11) %>%
  arrange(
    factor(직책, levels = c("학교장","교감","교사 등")),
    홍보충분성 == "합계",
    if_else(홍보충분성 != "합계", -n, 0)
  )

print(summary_with_total_11, n = Inf)

# 직책별 카이제곱 검정
tab1_11 <- table(dat_filtered$직책, dat_filtered$홍보충분성)
chisq_test1_11 <- chisq.test(tab1_11)
print(chisq_test1_11)
```

```{r}
#| echo: false
#| warning: false
#| message: false
# 직책별 누적막대그래프
summary_job_11 <- dat_filtered %>%
  group_by(직책, 홍보충분성) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  mutate(pct = round(n / sum(n) * 100, 1)) %>%
  ungroup() %>%
  mutate(홍보충분성 = factor(홍보충분성, 
                        levels = c("매우 그렇다", "그렇다", "보통이다", 
                                 "그렇지 않다", "매우 그렇지 않다")))

p0_11 <- ggplot(summary_job_11, aes(x = factor(직책, levels = c("학교장", "교감", "교사 등")), 
                                    y = pct, fill = 홍보충분성)) +
  geom_bar(stat = "identity", width = 0.7) +
  labs(
    title = "직책별 홍보충분성",
    x = "직책",
    y = "비율",
    fill = "홍보충분성"
  ) +
  scale_y_continuous(limits = c(0, 100), expand = expansion(mult = c(0, 0.02))) +
  theme_minimal(base_size = 15) +
  theme(
    plot.title = element_text(face = "bold", size = 32, hjust = 0.5),
    axis.text.x = element_text(size = 20, face = "bold"),
    axis.text.y = element_text(size = 20),
    axis.title.x = element_text(size = 25, angle = 0, margin = margin(t = 15)),
    axis.title.y = element_text(size = 20, angle = 0, vjust = 0.5),
    legend.position = "right",
    legend.text = element_text(size = 20),
    legend.title = element_text(size = 20, face = "bold")
  )
print(p0_11)
```

학교장(3.8), 교감(3.72), 교사 등(3.35) 간 홍보충분성 대한 평균점수를 비교한 결과, 학교장과 교감 간에는 유의미한 차이는 없었지만, 학교장-교사 등, 교감-교사 등 간에는 유의미한 인식도 차이가 있는 것으로 나타남 (학생맞춤통합지원 홍보가 충분한지에 대해 학교장 \>교사 등, 교감 \> 교사 등 순으로 나타남)

```{r}
#| echo: false
#| warning: false
#| message: false
# 직책별 기술통계 및 ANOVA
job_summary_11 <- dat_filtered %>%
  mutate(직책 = factor(직책, levels = c("학교장", "교감", "교사 등"))) %>%
  group_by(직책) %>%
  summarise(
    평균 = round(mean(홍보충분성점수, na.rm = TRUE), 2),
    표준편차 = round(sd(홍보충분성점수, na.rm = TRUE), 2),
    n = n(),
    .groups = "drop"
  ) %>%
  arrange(직책)

print(job_summary_11)

anova_job_11 <- aov(홍보충분성점수 ~ 직책, data = dat_filtered)
summary(anova_job_11)

tukey_job_11 <- TukeyHSD(anova_job_11)
print(tukey_job_11)
```

```{r}
#| echo: false
#| warning: false
#| message: false
# 직책별 Tukey 그룹 레터 생성
tukey_letters_job_11 <- multcompView::multcompLetters4(anova_job_11, tukey_job_11)
letters_df_job_11 <- data.frame(
  직책 = names(tukey_letters_job_11$`직책`$Letters),
  group = tukey_letters_job_11$`직책`$Letters
)

job_summary_with_groups_11 <- job_summary_11 %>%
  left_join(letters_df_job_11, by = "직책")

# 직책별 박스플롯
ggplot(dat_filtered, aes(x = factor(직책, levels = c("학교장", "교감", "교사 등")), y = 홍보충분성점수, fill = 직책)) +
  geom_boxplot(alpha = 0.7, width = 0.6, outlier.shape = 21) +
  stat_summary(fun = mean, geom = "point", shape = 23, size = 4, fill = "yellow", stroke = 1) +
  geom_text(data = job_summary_with_groups_11, 
            aes(x = 직책, y = 6, label = paste0(group, "\n(M=", 평균, ")")),
            inherit.aes = FALSE, fontface = "bold", size = 9, vjust = 0, lineheight=0.5) +
  labs(
    title = "직책별 홍보충분성",
    x = "직책", 
    y = "홍보충분성"
  ) +
  theme_minimal(base_size = 15) +
  theme(
    plot.title = element_text(face = "bold", size = 32, hjust = 0.5),
    axis.text.x = element_text(size = 18),
    axis.text.y = element_text(size = 18),
    axis.title.x = element_text(size = 20, margin = margin(t = 15)),
    axis.title.y = element_text(size = 20, angle = 0, vjust = 0.5),
    legend.position = "none"
  ) +
  scale_y_continuous(expand = expansion(mult = c(0.1, 0.2)))
```

### 문항 11-2. 학교급별 홍보충분성 분석

학교급별 응답자는 총 3,090명이며, 초등학교 응답자는 1,277명(41.33%), 중학교 응답자는 1,100명(35.60%), 고등학교 응답자는 713명(23.07%)이 응답하였음.

초등학교 응답 중에서 매우 그렇다는 194명(15.2%), 그렇다는 527명(41.3%), 보통이다는 425명(33.3%), 그렇지 않다는 104명(8.1%), 매우 그렇지 않다는 27명(2.1%)이었음.

중학교 응답 중에서 매우 그렇다는 153명(13.9%), 그렇다는 436명(39.6%), 보통이다는 373명(33.9%), 그렇지 않다는 123명(11.2%), 매우 그렇지 않다는 15명(1.4%)이었음.

고등학교 응답 중에서 매우 그렇다는 50명(7%), 그렇다는 261명(36.6%), 보통이다는 284명(39.8%), 그렇지 않다는 104명(14.6%), 매우 그렇지 않다는 14명(2%)이었음.

```{r}
#| echo: false
#| warning: false
#| message: false
# 학교급별 기술통계
summary_table_11 <- dat_filtered %>%
  group_by(학교급, 홍보충분성) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  mutate(pct = round(n / sum(n) * 100, 1)) %>%
  ungroup()

summary_with_total_11 <- summary_table_11 %>%
  group_by(학교급) %>%
  summarise(n = sum(n), pct = sum(pct), 홍보충분성 = "합계") %>%
  bind_rows(summary_table_11) %>%
  arrange(
    factor(학교급, levels = c("초등학교","중학교","고등학교")),
    홍보충분성 == "합계",
    if_else(홍보충분성 != "합계", -n, 0)
  )

print(summary_with_total_11, n = Inf)

# 학교급별 카이제곱 검정
tab_school_11 <- table(dat_filtered$학교급, dat_filtered$홍보충분성)
chisq_test_school_11 <- chisq.test(tab_school_11)
print(chisq_test_school_11)
```

```{r}
#| echo: false
#| warning: false
#| message: false
# 5. 학교급별 분포 (pct 변수 추가)
summary_school_11 <- dat_filtered %>%
  group_by(학교급, 홍보충분성) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  mutate(pct = round(n / sum(n) * 100, 1)) %>%  # 이 줄이 누락되었었음
  ungroup() %>%
  mutate(홍보충분성 = factor(홍보충분성, 
                        levels = c("매우 그렇다", "그렇다", "보통이다", 
                                 "그렇지 않다", "매우 그렇지 않다")))

# 5. 학교급별 누적막대그래프
ggplot(summary_school_11, aes(x = factor(학교급, levels = c("초등학교", "중학교", "고등학교")), y = pct, fill = 홍보충분성)) +
  geom_bar(stat = "identity", width = 0.7) +
  labs(
    title = "학교급별 학생맞춤통합지원 홍보 충분성",
    x = "학교급",
    y = "비율",
    fill = "홍보충분성"
  ) +
  scale_y_continuous(limits = c(0, 100), expand = expansion(mult = c(0, 0.02))) +
  theme_minimal(base_size = 15) +
  theme(
    plot.title = element_text(size = 32, face = "bold", hjust = 0.5),
    axis.text.x = element_text(size = 23, margin = margin(t = 10)),
    axis.text.y = element_text(size = 23),
    axis.title.x = element_text(size = 23, angle = 0, margin = margin(t = 15)),
    axis.title.y = element_text(size = 23, angle = 0, vjust = 0.5),
    legend.position = "right",
    legend.text = element_text(size = 23),
    legend.title = element_text(size = 23, face = "bold")
  )
```

초등학교(3.59), 중학교(3.54), 고등학교(3.32) 간 홍보충분성 평균점수를 비교한 결과, 초등학교-고등학교, 중학교-고등학교 학교급 간 정책인식도 평균 점수에는 유의미한 차이가 있는 것으로 나타났으며, 초등학교와 중학교 평균섬수 차이는 유의미하게 나타나지 않음 (초등학교 \> 중학교 \> 고등학교)undefined

```{r}
#| echo: false
#| warning: false
#| message: false
school_summary_11 <- dat_filtered %>%
  mutate(학교급 = factor(학교급, levels = c("초등학교", "중학교", "고등학교"))) %>%
  group_by(학교급) %>%
  summarise(
    평균 = round(mean(홍보충분성점수, na.rm = TRUE), 2),
    표준편차 = round(sd(홍보충분성점수, na.rm = TRUE), 2),
    n = n(),
    .groups = "drop"
  ) %>%
  arrange(학교급)  # factor 순서대로 정렬

print(school_summary_11)

# ANOVA (학교급별)
anova_school_11 <- aov(홍보충분성점수 ~ 학교급, data = dat_filtered)
summary(anova_school_11)

tukey_school_11 <- TukeyHSD(anova_school_11)
print(tukey_school_11)
```

```{r}
#| echo: false
#| warning: false
#| message: false
# 학교급별 Tukey 그룹 레터 생성
tukey_letters_school_11 <- multcompView::multcompLetters4(anova_school_11, tukey_school_11)
letters_df_school_11 <- data.frame(
  학교급 = names(tukey_letters_school_11$`학교급`$Letters),
  group = tukey_letters_school_11$`학교급`$Letters
)

school_summary_with_groups_11 <- school_summary_11 %>%
  left_join(letters_df_school_11, by = "학교급")

# 학교급별 박스플롯
ggplot(dat_filtered, aes(x = factor(학교급, levels = c("초등학교", "중학교", "고등학교")), y = 홍보충분성점수, fill = 학교급)) +
  geom_boxplot(alpha = 0.7, width = 0.6, outlier.shape = 21) +
  stat_summary(fun = mean, geom = "point", shape = 23, size = 8, fill = "yellow", stroke = 1) +
  geom_text(data = school_summary_with_groups_11, 
            aes(x = 학교급, y = 6, label = paste0(group, "\n(M=", 평균, ")"), lineheight = 0.8),
            inherit.aes = FALSE, fontface = "bold", size = 9, vjust = 0.2, lineheight =0.5) +
  labs(
    title = "학교급별 홍보 충분성",
    x = "학교급", 
    y = "홍보충분성"
  ) +
  theme_minimal(base_size = 15) +
  theme(
    plot.title = element_text(face = "bold", size = 32, hjust = 0.5),
    axis.text.x = element_text(size = 22),
    axis.text.y = element_text(size = 22),
    axis.title.x = element_text(size = 23, margin = margin(t = 15)),
    axis.title.y = element_text(size = 23, angle = 0, vjust = 0.5),
    legend.position = "none"
  ) +
  scale_y_continuous(expand = expansion(mult = c(0.05, 0.15)))
```

### 문항 11-3. 설립별 홍보충분성 분석

설립별 응답자는 총 3,090명이며 이 중에서 공립학교 응답자는 2,317명(74.5%), 사립학교 응답자는 761명(25.5%)이 응답하였음

공립학교 응답건수 중에서 매우 그렇다는 991명(42.8%), 그렇다는 965명(41.6%), 보통이다는 310명(13.4%), 그렇지 않다는 41명(1.8%), 매우 그렇지 않다는 10명(0.4%)이었음

사립학교 응답건수 중에서 매우 그렇다는 224명(29%), 그렇다는 375명(27.8%), 보통이다는 140명(18.1%), 그렇지 않다는 27명(3.5%), 매우 그렇지 않다는 7명(0.9%)이었음

```{r}
#| echo: false
#| warning: false
#| message: false
# 설립별 데이터 준비
dat_found_11 <- dat_filtered %>%
  filter(설립 %in% c("공립", "사립")) %>%
  mutate(설립 = factor(설립, levels = c("공립", "사립")))

# 설립별 교차표
summary_found_11 <- dat_found_11 %>%
  group_by(설립, 홍보충분성) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  mutate(pct = round(n / sum(n) * 100, 1)) %>%
  ungroup()

summary_found_total_11 <- summary_found_11 %>%
  group_by(설립) %>%
  summarise(n = sum(n), pct = 100, 홍보충분성 = "합계", .groups = "drop") %>%
  bind_rows(summary_found_11) %>%
  arrange(설립, 홍보충분성 == "합계", desc(n))

print(summary_found_total_11, n = Inf)

# 설립별 카이제곱 검정
tab_found_11 <- table(dat_found_11$설립, dat_found_11$홍보충분성)
chisq_test_found_11 <- chisq.test(tab_found_11)
print(chisq_test_found_11)
```

```{r}
#| echo: false
#| warning: false
#| message: false
# 설립별 누적막대그래프
summary_found_plot_11 <- summary_found_11 %>%
  mutate(홍보충분성 = factor(홍보충분성, 
                        levels = c("매우 그렇다", "그렇다", "보통이다", 
                                 "그렇지 않다", "매우 그렇지 않다")))

ggplot(summary_found_plot_11, aes(x = 설립, y = pct, fill = 홍보충분성)) +
  geom_bar(stat = "identity", width = 0.7) +
  labs(
    title = "설립별 학생맞춤통합지원 홍보 충분성",
    x = "설립",
    y = "비율",
    fill = "홍보충분성"
  ) +
  scale_y_continuous(limits = c(0, 100), expand = expansion(mult = c(0, 0.02))) +
  theme_minimal(base_size = 15) +
  theme(
    plot.title = element_text(size = 32, face = "bold", hjust = 0.5),
    axis.text.x = element_text(size = 20, margin = margin(t = 10)),
    axis.text.y = element_text(size = 20),
    axis.title.x = element_text(size = 20, angle = 0, margin = margin(t = 15)),
    axis.title.y = element_text(size = 20, angle = 0, vjust = 0.5),
    legend.position = "right",
    legend.text = element_text(size = 20),
    legend.title = element_text(size = 20, face = "bold")
  )
```

공립학교(3.55), 사립학교(3.4) 간 홍보충분성 평균점수를 비교한 결과, 공립학교와 사립학교 간에는 정책인식도 평균 점수에는 유의미한 차이가 있는 것으로 나타남

```{r}
#| echo: false
#| warning: false
#| message: false
# T-test 분석을 위한 기술통계
summary_found_stats_11 <- dat_found_11 %>%
  group_by(설립) %>%
  summarise(
    평균 = round(mean(홍보충분성점수, na.rm = TRUE), 2),
    표준편차 = round(sd(홍보충분성점수, na.rm = TRUE), 2),
    n = n(),
    .groups = "drop"
  )

print(summary_found_stats_11)

# 정규성 검정
normality_test_11 <- dat_found_11 %>%
  group_by(설립) %>%
  summarise(
    shapiro_p = shapiro.test(홍보충분성점수)$p.value,
    .groups = "drop"
  )

print(normality_test_11)

# T-test
t_test_result_11 <- t.test(홍보충분성점수 ~ 설립, data = dat_found_11, var.equal = FALSE)
print(t_test_result_11)
```

```{r}
#| echo: false
#| warning: false
#| message: false
# 설립별 박스플롯
# ── 3) t-test 결과로 '가짜 Tukey' 레터 만들기 (a/b 또는 a/a)
tukey_letters_school_11 <- list(
  `설립` = list(
    Letters = setNames(
      if (t_test_result_11$p.value < 0.05) c("a","b") else c("a","a"),
      c("공립","사립")
    )
  )
)

# ── 4) 기술통계와 레터 결합 (플롯에 쓸 표)
school_summary_final_11 <- summary_found_stats_11 %>%
  dplyr::left_join(
    data.frame(
      설립 = names(tukey_letters_school_11$`설립`$Letters),
      group = unname(tukey_letters_school_11$`설립`$Letters)
    ),
    by = "설립"
  )

# ── 5) 박스플롯 + 레터/평균 표식(자동 y좌표)
y_top_estab_11 <- max(dat_found_11$홍보충분성점수, na.rm = TRUE) + 0.25

ggplot(dat_found_11, aes(x = 설립, y = 홍보충분성점수, fill = 설립)) +
  geom_boxplot(alpha = 0.7, width = 0.6, outlier.shape = 21) +
  stat_summary(fun = mean, geom = "point", shape = 23, size = 4,
               fill = "yellow", stroke = 1) +
  geom_text(data = school_summary_final_11,
            aes(x = 설립, y = y_top_estab_11,
                label = paste0(group, "\n(M=", 평균, ")"), lineheight =0.5),
            inherit.aes = FALSE, fontface = "bold", size = 9, vjust = 0) +
  labs(title = "설립별 홍보충분성",
       x = "설립", y = "홍보충분성") +
  theme_minimal(base_size = 15) +
  theme(plot.title = element_text(face = "bold", size = 32, hjust = 0.5),
        axis.text.x = element_text(size = 22),
        axis.text.y = element_text(size = 22),
        axis.title.x = element_text(size = 22, margin = margin(t = 15)),
        axis.title.y = element_text(size = 22, angle = 0, vjust = 0.5),
        legend.position = "none") +
  scale_y_continuous(limits = c(min(dat_found_11$홍보충분성점수, na.rm = TRUE),
                                y_top_estab_11 + 0.1),
                     expand = expansion(mult = c(0.05, 0.15)))
```

# 4. 실태조사 (학생맞춤통합지원 운영현황 조사)

## \* 응답자 선정에 관항

운영 현황조사 문항들은 중복응답을 방지하기 위해 학교별 1명씩만 응답자를 선별함. 응답자는 교감을 우선 선별하고, 다음으로 학교장, 교사 등 순으로 학교별 응답자를 추출하였음.

### 문항12. 학교 내에 학생맞춤통합지원팀이 구성되어 있습니까?

① 그렇다 ② 아니다

학생맞춤통합지원팀 구성여부 문항에 대한 응답자는 총 1,155명이며 초등학교 응답자는 518명(44.8%), 중학교 응답자는 347명(30%), 고등학교 응답자는 264명(22.9%), 특수학교 응답자는 17명(1.5%), 각종학교 응답자는 9명(0.8%)이었음

초등학교 응답 중에서 학생맞춤통합지원팀이 구성되어 있다는 응답은 472명(91.1%), 구성되어 있지 않다는 46명(8.9%)으로 나타났음

중학교 응답자 중에서 학생맞춤통합지원팀이 구성되어 있다는 응답은 311명(89.6%), 구성되어 있지 않다는 36명(10.4%)으로 나타났음

고등학교 응답 중에서 학생맞춤통합지원팀이 구성되어 있다는 응답은 208명(78.8%), 구성되어 있지 않다는 56명(21.2%)으로 나타났음

특수학교 응답 중에서 학생맞춤통합지원팀이 구성되어 있다는 응답은 12명(70.6%), 구성되어 있지 않다는 5명(29.4%)으로 나타났음

각종학교 응답 중에서 학생맞춤통합지원팀이 구성되어 있다는 응답은 5명(55.6%), 구성되어 있지 않다는 4명(44.4%)으로 나타났음

```{r}
#| echo: false
#| warning: false
#| message: false
dat_trimed <- dat %>%
  filter(!is.na(ques_12)) %>%   # 12번 문항 응답만 추출
  # 우선순위 컬럼 생성
  mutate(
    우선순위 = case_when(
      ques_7 == "2" ~ 1,
      ques_7 == "1" ~ 2,
      ques_7 == "3" ~ 3,
      ques_7 == "4" ~ 4,
      ques_7 == "8" ~ 5,
      ques_7 == "9" ~ 6,
      ques_7 == "5" ~ 7,
      TRUE ~ 8
    )
  ) %>%
  group_by(학교아이디) %>%   # ⚠ 학교 식별 컬럼명으로 변경 필요
  arrange(우선순위) %>%  # 우선순위 낮은 값(교감) 먼저
  slice(1) %>%           # 최종적으로 1명만 선택
  ungroup() %>%
  mutate(
    학교급 = recode(as.character(ques_1),
                 "1" = "초등학교",
                 "2" = "중학교",
                 "3" = "고등학교",
                 "4" = "특수학교",
                 "5" = "각종학교"),
    문항12 = factor(
      ques_12,
      levels = 1:2,
      labels = c("구성되어 있다", "구성되어 있지 않다")
    ),
    학교급 = factor(학교급, 
                 levels = c("초등학교","중학교","고등학교","특수학교","각종학교"))
  )
dat_q12 <- dat_trimed
summary_q12 <- dat_q12 %>%
  group_by(학교급, 문항12) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  mutate(pct = round(n / sum(n) * 100, 1)) %>%
  arrange(desc(n)) %>%
  ungroup()
# 합계 추가
summary_q12_total <- summary_q12 %>%
  group_by(학교급) %>%
  summarise(n = sum(n), pct = 100, 문항12 = "합계", .groups = "drop") %>%
  bind_rows(summary_q12) %>%
  mutate(문항12 = factor(문항12, levels = c("구성되어 있다","구성되어 있지 않다","합계"))) %>%
  arrange(factor(학교급, 
                 levels=c("초등학교","중학교","고등학교","특수학교","각종학교")),
          if_else(문항12=="합계", 2, 1),  # 합계를 마지막으로
          desc(n))
print(summary_q12_total, n = Inf)
```

```{r}
#| echo: false
#| warning: false
#| message: false
ggplot(summary_q12 %>% filter(문항12 != "합계"), aes(x = 문항12, y = n, fill = 문항12)) +
  geom_bar(stat="identity", width=0.7) +
  geom_text(aes(label = paste0(n,"명\n(",pct,"%)")), 
            vjust=-0.2, size=6.5, lineheight = 0.5, fontface="bold") +
  facet_wrap(~학교급, ncol = 3, nrow = 2) +  # 2행 3열 배치
  labs(
    title = "학생맞춤통합지원팀\n구성 여부(학교급별)",
    x = "구성여부",
    y = "응답수"
  ) +
  scale_x_discrete(labels = c("구성되어\n있다", "구성되어\n있지 않다")) +
  theme_minimal(base_size = 13) +
  theme(
    plot.title = element_text(face="bold", size=24, hjust=0.5, margin = margin(b = 18)),
    legend.position = "none",
    axis.text.x = element_text(angle=0, hjust=0.5, size=15, lineheight=0.5),
    axis.text.y = element_text(size=13),
    axis.title.x = element_text(size=15, margin = margin(t = 12)),
    axis.title.y = element_text(angle = 0, vjust = 0.5, size=15),
    strip.text = element_text(face="bold", size=18, margin = margin(t = 6, b = 6)),
    panel.spacing = unit(1.2, "lines"),  # 패널 간격 조금 증가
    plot.margin = margin(18, 18, 18, 18)
  ) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.4))) +
  coord_cartesian(clip = "off")
```

### 문항13. 학생맞춤통합지원팀이 구성방법은?

① 기존 위원회 활용 ② 별도로 팀을 구성하여 운영

학생맞춤통합지원팀 구성방법에 대한 응답자는 총 1,001명이며 초등학교 응답자는 472명(47.15%), 중학교 응답자는 311명(31.07%), 고등학교 응답자는 208명(20.78%), 특수학교 응답자는 5명(0.5%), 각종학교 응답자는 5명(0.5%)이었음

초등학교 응답 중에서 기존 위원회를 활용한다는 응답자는 275명(58.3%), 별도로 팀을 구성하여 운영한다는 응답자는 197명(41.7%)으로 나타났음

중학교 응답 중에서 기존 위원회를 활용한다는 응답자는 210명(67.5%), 별도로 팀을 구성하여 운영한다는 응답자는 101명(32.5%)로 나타났음

고등학교 응답 중에서 기존 위원회를 활용한다는 응답자는 129명(62%), 별도로 팀을 구성하여 운영한다는 응답자는 79명(38%)으으로 나타났음

특수학교 응답 중에서 기존 위원회 활용은 5명(100%)으로 나타났음

각종학교 응답 중에서 기존 위원회 활용은 5명(100%)으로 나타났음

```{r}
#| echo: false
#| warning: false
#| message: false
dat_q13 <- dat_trimed %>%
  filter(ques_12 != 2, !is.na(ques_13)) %>%   # 12번 응답자 제외 & 결측 제거
  mutate(문항13 = factor(
      ques_13,
      levels = 1:2,
      labels = c("기존 위원회 활용","별도로 팀을 구성하여 운영")
    )
  )
summary_q13 <- dat_q13 %>%
  group_by(학교급, 문항13) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  mutate(pct = round(n / sum(n) * 100, 1)) %>%
  ungroup()
# 합계 추가 (학교급별)
summary_q13_total <- summary_q13 %>%
  group_by(학교급) %>%
  summarise(
    n = sum(n),
    pct = 100,
    문항13 = "합계",
    .groups = "drop"
  ) %>%
  bind_rows(summary_q13) %>%
  arrange(
    factor(학교급, levels = c("초등학교","중학교","고등학교","특수학교","각종학교")),
    if_else(문항13 == "합계", 2, 1),
    desc(n)
  )
print(summary_q13_total, n = Inf)
```

```{r}
#| echo: false
#| warning: false
#| message: false
ggplot(summary_q13, aes(x = 문항13, y = n, fill = 문항13)) +
  geom_bar(stat="identity", width=0.7) +
  geom_text(aes(label = paste0(n,"명\n(",pct,"%)")), 
            vjust=-0.2, size=6, fontface="bold", lineheight =0.6) +
  facet_wrap(~학교급, ncol = 3, nrow = 2) +  # 2행 3열 배치
  labs(
    title = "학생맞춤통합지원팀\n 구성 방법(학교급별)",
    x = "구성방법",
    y = "응답수"
  ) +
  scale_x_discrete(labels = c("기존 위원회\n활용", "별도로 팀을\n구성하여 운영")) +
  theme_minimal(base_size = 13) +
  theme(
    plot.title = element_text(face="bold", size=32, hjust=0.5, margin = margin(b = 18), lineheight = 0.5),
    legend.position = "none",
    axis.text.x = element_text(size= 16, angle=0, hjust=0.5, lineheight=0.5),
    axis.text.y = element_text(size=16),
    axis.title.x = element_text(size=18, margin = margin(t = 12)),
    axis.title.y = element_text(angle = 0, vjust = 0.5, size=18),
    strip.text = element_text(face="bold", size=18, margin = margin(t = 6, b = 6)),
    panel.spacing = unit(1.2, "lines"),  # 패널 간격 조금 증가
    plot.margin = margin(18, 18, 18, 18)
  ) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.4))) +
  coord_cartesian(clip = "off")
```

### 문항14.\[13번 문항에 ①로 답변한 경우만 응답\] 기존 위원회를 활용한 경우는 어떤 위원회를 주로 활용하였습니까? (중복응답)

① 교육복지위원회(교육복지통합지원팀) ② 생명존중위원회(위기관리위원회) ③ 학습지원대상학생지원협의회 ④ 기타

기존위원회를 학생맞춤통합지원팀으로 활용한다는 응답건수는 744명이며 초등학교 응답건수는 309건(41.5%), 중학교 응답건수는 241건(32.4%), 고등학교 응답건수는 173건(23.3%), 특수학교 응답건수는 13건(1.7%), 각종학교 응답건수는 8건(1.1%)이었음

초등학교 응답 중에서 교육복지위원회를 활용한다는 응답건수는 223건(72.2%), 생명존중위원회를 활용한다는 응답건수는 46건(14.9%), 학급지원대상 학생지원협의회를 활용한다는 응답건수는21건(6.8%), 기타는 19건(6.1%)으로 나타났음

중학교 응답 중에서 교육복지위원회를 활용한다는 응답건수는 155건(64.3%), 생명존중위원회를 활용한다는 응답건수는 59건(24.5%), 학급지원대상 학생지원협의회를 활용한다는 응답건수는 12건(5%), 기타는 15건(6.2%)으로 나타났음

고등학교 응답 중에서 교육복지위원회를 활용한다는 응답건수는 105건(60.7%), 생명존중위원회를 활용한다는 응답건수는 54건(31.2%), 학급지원대상 학생지원협의회를 활용한다는 응답건수는 5건(2.9%), 기타는 9건(5.2%)으로 나타났음

특수학교 응답 중에서 교육복지위원회를 활용한다는 응답건수는 1건(7.7%), 생명존중위원회를 활용한다는 응답건수는 7건(53.8%), 기타는 5건(38.5%)으로 나타났음

각종학교 응답 중에서 교육복지위원회를 활용한다는 응답건수는 2건(25%), 생명존중위원회를 활용한다는 응답건수는 2건(25%), 학급지원대상 학생지원협의회를 활용한다는 응답건수는 2건(25%), 기타는 2건(25%)으로 나타났음

```{r}
#| echo: false
#| warning: false
#| message: false
dat_q14 <- dat_trimed %>%
  filter(ques_13 == 1) %>%   # 2번 응답자 제외 & 결측 제거
  mutate(
    문항14 = factor(
      ques_14,
      levels = 1:4,
      labels = c("교육복지위원회","생명존중위원회", "학급지원대상학생지원협의회","기타")
    )
  )

summary_q14 <- dat_q14 %>%
  group_by(학교급, 문항14) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  mutate(pct = round(n / sum(n) * 100, 1))%>%
  arrange(desc(n)) %>% 
  ungroup()

summary_q14_total <- summary_q14 %>%
  group_by(학교급) %>%
  summarise(
    n = sum(n),
    pct = 100,
    문항14 = "합계",
    .groups = "drop"
  ) %>%
  bind_rows(summary_q14) %>%
  arrange(
    factor(학교급, levels = c("초등학교","중학교","고등학교","특수학교","각종학교")),
    if_else(문항14 == "합계", 2, 1),
    desc(n)
  )

print(summary_q14_total, n = Inf)
```

```{r}
#| echo: false
#| warning: false
#| message: false
ggplot(summary_q14, aes(x = 문항14, y = n, fill = 문항14)) +
  geom_bar(stat="identity", width=0.7) +
  geom_text(aes(label = paste0(n,"건\n(",pct,"%)")), 
            vjust= -0.25, size=4.5, fontface="bold", lineheight=0.5) +
  facet_wrap(~학교급, ncol = 3, nrow = 2) +  # 2행 3열 배치
  labs(
    title = "활용하는 기존 위원회",
    x = "위원회 유형",
    y = "응답수"
  ) +
  scale_x_discrete(labels = c("교육\n복지\n위원회", "생명\n존중\n위원회", "학급지원\n대상학생\n지원\n협의회", "기타")) +
  theme_minimal(base_size = 13) +
  theme(
    plot.title = element_text(face="bold", size=32, hjust=0.5, margin = margin(b = 18)),
    legend.position = "none",
    axis.text.x = element_text(angle=0, hjust=0.5, size=16, lineheight=0.5),
    axis.text.y = element_text(size=16),
    axis.title.x = element_text(size=20, margin = margin(t = 12)),
    axis.title.y = element_text(angle = 0, vjust = 0.5, size=20),
    strip.text = element_text(face="bold", size=20, margin = margin(t = 6, b = 6)),
    panel.spacing = unit(1.2, "lines"),  # 패널 간격 조금 증가
    plot.margin = margin(18, 18, 18, 18)
  ) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.4))) +
  coord_cartesian(clip = "off")
```

### 문항15.학생맞춤통합지원팀 구성원은 누구입니까? (중복응답)

① 교장 ② 교감 ③ 담당부장교사 또는 담당업무교사 ④ 담임교사 ⑤ 상담교사 ⑥ 보건교사 ⑦ 영양교사 ⑧ 지역사회교육전문가 ⑨ 상담사 ⑩ 행정실장 ⑪ 기타

학생맞춤통합지원팀 구성원에 대한 응답건수는 6,135건이며 초등학교 응답건수는 2,759건(45%), 중학교 응답건수는 1,933건(31.5%), 고등학교 응답건수는 1,323건(21.6%), 특수학교 응답건수는 77건(1.3%), 각종학교 응답건수는 43건(0.7%)이었음

초등학교 응답 중에서 학생맞춤통합지원팀 주요 구성원 문항에 교감은 507건(18.4%), 담당부장 또는 담당교사는 507건(18.4%), 보건교사는 349건(12.8%), 담임교사는 349건(12.6%), 교장은 303건(11%), 상담교사는 268건(9.7%), 지역사회교육전문가는 183건(6.6%), 상담사는 169건(6.1%) 등으로 나타났음

중학교 응답 중에서 학생맞춤통합지원팀 주요 구성원 문항에 담당부장 또는 담당교사는 341건(17.6%), 교감은 336건(17.4%), 보건교사는 249건(12.9%), 상담교사는 245건(12.7%), 담임교사는 199건(10.3%), 교장은 186건(9.6%), 지역사회교육전문가는 146건(7.6%), 상담사는 133건(6.9%) 등으로 나타났음

고등학교 응답 중에서 학생맞춤통합지원팀 주요 구성원 문항에 교감은 258건(19.5%), 담당부장 또는 담당교사는 257건(19.4%), 상담교사는 205건(15.5%), 보건교사는 172건(13%), 담임교사는 151건(11.4%), 교장은 108건(8.2%), 상담사는 55건(4.2%), 지역사회교육전문가는 43건(3.3%) 등으로 나타났음

특수학교 응답 중에서 학생맞춤통합지원팀 주요 구성원 문항에 교감은 15건(19.5%), 담당부장 또는 담당교사는 15건(19.5%), 담임교사는 12건(15.6%), 보건교사는 11건(14.3%), 교장은 10건(13%), 교장은 10건(13%) 등으로 나타났음

각종학교 응답 중에서 학생맞춤통합지원팀 주요 구성원 문항에 담당부장 또는 담당교사는 9건(20.9%), 교감은 8건(18.6%), 보건교사는 6건(14%), 상담교사는 5건(11.6%), 행정실장은 5건(11.6%), 교장은 4건(9.3%), 담임교사는 4건(9.3%) 등으로 나타났음

```{r}
#| echo: false
#| warning: false
#| message: false
# 문항15 데이터 처리 
dat_q15_long <- dat_trimed %>%  
  filter(!is.na(ques_15)) %>%
  separate_rows(ques_15, sep = ",\\s*") %>%
  mutate(
    ques_15 = str_trim(as.character(ques_15)),
    문항15 = recode(ques_15,
                   "1" = "교장",
                   "2" = "교감",
                   "3" = "담당부장 또는 담당교사",
                   "4" = "담임교사",
                   "5" = "상담교사",
                   "6" = "보건교사",
                   "7" = "영양교사",
                   "8" = "지역사회교육전문가",
                   "9" = "상담사",
                   "10" = "행정실장",
                   "11" = "기타",
                   .default = "기타")
  )

# 기술통계
summary_q15 <- dat_q15_long %>%
  group_by(학교급, 문항15) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  mutate(pct = round(n / sum(n) * 100, 1)) %>%
  ungroup()

# 합계 추가
summary_q15_total <- summary_q15 %>%
  group_by(학교급) %>%
  summarise(n = sum(n), pct = 100, 문항15 = "합계", .groups = "drop") %>%
  bind_rows(summary_q15) %>%
  arrange(학교급,
          if_else(문항15 == "합계", 2, 1),
          desc(n))

print(summary_q15_total, n = Inf)
```

```{r}
#| echo: false
#| warning: false
#| message: false
# 전체 데이터에 대한 기술통계 생성 
ggplot(summary_q15 %>% filter(문항15 != "합계"), aes(x = n, y = reorder(문항15, n), fill = 문항15)) +
  geom_bar(stat = "identity", width = 0.6) +
  geom_text(aes(label = paste0(n, "건 (", pct, "%)")), hjust = -0.1, size = 5) +  # size 줄임
  facet_wrap(~학교급, ncol = 2, nrow = 3) +  # 5행 1열
  labs(
    title = "학교급별 학생맞춤통합지원팀 구성원 현황",
    x = "응답수",
    y = "구성원",
    fill = "구성원"
  ) +
  theme_minimal(base_size = 12) +  # base_size 줄임
  theme(
    plot.title = element_text(size = 28, face = "bold", hjust = 0.5, margin = margin(b = 18)),
    axis.text.x = element_text(size = 14, margin = margin(t = 8)),
    axis.text.y = element_text(size = 12),  # y축 텍스트 크기 줄임
    axis.title.x = element_text(size = 16, angle = 0, margin = margin(t = 12)),
    axis.title.y = element_text(size = 16, angle = 0, vjust = 0.5),
    strip.text = element_text(face = "bold", size = 14, margin = margin(t = 6, b = 6)),
    legend.position = "none",
    panel.spacing = unit(1.2, "lines"),
    plot.margin = margin(18, 18, 18, 18)
  ) +
   scale_x_continuous(expand = expansion(mult = c(0, 0.30))) +  # 이 줄 추가
  coord_cartesian(clip = "off")
```

### 문항16.학생맞춤통합지원팀(위원회)의 위원장은 누구입니까?

① 교장② 교감

학생맞춤통합지원팀 위원장이 누구인지에 대한 문항에 응답자수는 총 1,155명이며 초등학교 응답자수는 518명(50.4%), 중학교 응답자수는 347명(30%), 고등학교 응답자수는 264명(22.9%), 특수학교 응답자수는 17명(1.5%), 각종학교 응답건수는 9명(0.8%)이었음

초등학교 응답 중에서 학생맞춤통합지원팀 위원장이 교감이라는 응답자는 261명(50.4%), 교장이라는 응답자는 257명(49.6%)로 나타남

중학교 응답 중에서 학생맞춤통합지원팀 위원장이 교감이라는 응답자는 191명(55%), 교장이라는 응답자는 156명(45%)로 나타남

고등학교 응답 중에서 학생맞춤통합지원팀 위원장이 교감이라는 응답자는 174명(65.9%), 교장이라는 응답자는 90명(34.1%)로 나타남

특수학교 응답 중에서 학생맞춤통합지원팀 위원장이 교감이라는 응답자는 10명(58.8%), 교장이라는 응답자는 7명(41.2%)로 나타남

각종학교 응답 중에서 학생맞춤통합지원팀 위원장이 교감이라는 응답자는 5명(55.6%), 교장이라는 응답자는 4명(44.4%)로 나타남

```{r}
#| echo: false
#| warning: false
#| message: false
dat_q16 <- dat_trimed %>%
  filter(!is.na(ques_16)) %>%
  mutate(
    문항16 = recode(as.character(ques_16),
                  "1" = "교장",
                  "2" = "교감")
  )

# 기술통계
summary_q16 <- dat_q16 %>%
  group_by(학교급, 문항16) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  mutate(pct = round(n / sum(n) * 100, 1)) %>%
  ungroup()

# 합계 추가
summary_q16_total <- summary_q16 %>%
  group_by(학교급) %>%
  summarise(n = sum(n), pct = 100, 문항16 = "합계", .groups = "drop") %>%
  bind_rows(summary_q16) %>%
  arrange(학교급,
          if_else(문항16 == "합계", 2, 1),
          desc(n))

print(summary_q16_total, n = Inf)
```

```{r}
#| echo: false
#| warning: false
#| message: false
# 기술통계
summary_q16 <- dat_q16 %>%
  group_by(학교급, 문항16) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  mutate(pct = round(n / sum(n) * 100, 1)) %>%
  ungroup()

summary_q16_total <- summary_q16 %>%
  group_by(학교급) %>%
  summarise(
    n = sum(n),
    pct = 100,
    문항16 = "합계",
    .groups = "drop"
  ) %>%
  bind_rows(summary_q16) %>%
  arrange(factor(학교급),
          if_else(문항16 == "합계", 2, 1),
          desc(n))

# 시각화
ggplot(summary_q16, aes(x = 문항16, y = n, fill = 문항16)) +
  geom_bar(stat="identity", width=0.7) +
  geom_text(aes(label = paste0(n,"명\n(",pct,"%)")), 
            vjust=-0.3, size=6.5, fontface="bold", lineheight =0.5) +
  facet_wrap(~학교급, ncol = 3, nrow = 2) +  # 2행 3열 배치
  labs(
    title = "학생맞춤통합지원팀\n위원장",
    x = "위원장",
    y = "응답수"
  ) +
  scale_x_discrete(labels = c("교장", "교감")) +
  theme_minimal(base_size = 13) +
  theme(
    plot.title = element_text(face="bold", size=32, hjust=0.5, margin = margin(b = 18), lineheight = 0.6),
    legend.position = "none",
    axis.text.x = element_text(angle=0, hjust=0.5, size=18, lineheight=0.6),
    axis.text.y = element_text(size=18),
    axis.title.x = element_text(size=20, margin = margin(t = 12)),
    axis.title.y = element_text(angle = 0, vjust = 0.5, size=20),
    strip.text = element_text(face="bold", size=18, margin = margin(t = 6, b = 6)),
    panel.spacing = unit(1.2, "lines"),  # 패널 간격 조금 증가
    plot.margin = margin(18, 18, 18, 18)
  ) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.4))) +
  coord_cartesian(clip = "off")
```

### 문항17.학생맞춤통합지원팀 회의에서 주된 역할을 수행하는 구성원은 누구입니까?

① 교장② 교감 ③ 담당부장 또는 담당교사 ④ 상담(교)사 ⑤ 지역사회교육전문가 ⑥ 기타

학생맞춤통합지원팀 회의에서 주된 역할을 수행하는 구성원 설문에 대한 응답자수는 총 1,155명이며 초등학교 응답자수는 518명(50.4%), 중학교 응답자수는 347명(30%), 고등학교 응답자수는 264명(22.9%), 특수학교 응답자수는 17명(1.5%), 각종학교 응답건수는 9명(0.8%)이었음

초등학교의 경우 학생맞춤통합지원팀 회의에서 주된 역할을 수행하는 구성원은 담당부장 또는 담당교사라고 답변한 응답자가 357명(68.9%) 교감은 82명(15.8%), 지역사회교육전문가는 42명(12.1%), 교감은 82명(15.8%), 지역사회교육전문가는 42명(8.1%), 교장은 16명(3.1%), 상담(교)사는 14명(2.7%) 등으로 나타났음

중학교의 경우 학생맞춤통합지원팀 회의에서 주된 역할을 수행하는 구성원은 담당부장 또는 담당교사라고 답변한 응답자가 232명(66.9%), 지역사회교육전문가는 42명(12.1%), 상담(교)사는 36명(10.4%), 교감은 26명(7.5%), 교장은 6명(1.7%) 등으로 나타났음

고등학교의 경우 학생맞춤통합지원팀 회의에서 주된 역할을 수행하는 구성원은 담당부장 또는 담당교사라고 답변한 응답자가 195명(73.9%), 상담(교)사는 37명(14%), 교감은 24명(9.1%), 교감은 24명(7.5%), 교장은 4명(1.5%), 지역사회교육전문가는 2명(0.8%) 등으로 나타났음

특수학교의 경우 학생맞춤통합지원팀 회의에서 주된 역할을 수행하는 구성원은 담당부장 또는 담당교사라고 답변한 응답자가 12명(70.6%), 교장은 2명(11.8%), 상담(교)사는 1명(5.9%) 등으로 나타났음

각종학교의 경우 학생맞춤통합지원팀 회의에서 주된 역할을 수행하는 구성원은 담당부장 또는 담당교사라고 답변한 응답자가 8명(88.9%), 상담(교)사는 1명(11.1%)로 나타났음

```{r}
#| echo: false
#| warning: false
#| message: false
# 문항17 데이터 처리 (통합 코드)
dat_q17_long <- dat_trimed %>%
  filter(!is.na(ques_17)) %>%
  separate_rows(ques_17, sep = ",\\s*") %>%
  mutate(
    코드17 = str_trim(as.character(ques_17)),
    문항17 = recode(코드17,
                   "1" = "교장",
                   "2" = "교감", 
                   "3" = "담당부장 또는 담당교사",
                   "4" = "상담(교)사",
                   "5" = "지역사회교육전문가",
                   "6" = "기타",
                   .default = "기타")
  )
# 기술통계(학교급별 빈도/비율) + 합계 행
summary_q17 <- dat_q17_long %>%
  group_by(학교급, 문항17) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  mutate(pct = round(n / sum(n) * 100, 1)) %>%
  ungroup()

summary_q17_total <- summary_q17 %>%
  group_by(학교급) %>%
  summarise(n = sum(n), pct = 100, 문항17 = "합계", .groups = "drop") %>%
  bind_rows(summary_q17) %>%
  arrange(factor(학교급),
          if_else(문항17 == "합계", 2, 1),
          desc(n))

print(summary_q17_total, n = Inf)
```

```{r}
#| echo: false
#| warning: false
#| message: false
ggplot(summary_q17, aes(x = 문항17, y = n, fill = 문항17)) +
  geom_bar(stat="identity", width=0.7) +
  geom_text(aes(label = paste0(n,"명\n(",pct,"%)"),
                y = n),  # 막대 바로 위에 위치
            hjust=0.5, vjust=-0.1, size=4.5, fontface="bold", lineheight=0.4) +  # 줄간격 좁게, vjust로 미세조정
  facet_wrap(~학교급, ncol = 2, nrow = 3) +  # 3행 2열 배치
  labs(
    title = "학생맞춤통합지원팀\n구성원",
    x = "구성원",
    y = "응답수"
  ) +
  scale_x_discrete(labels = c("담당부장\n또는\n담당교사", "교감", "지역\n사회\n교육전문가","상담(교)사","교장", "기타")) +
  theme_minimal(base_size = 13) +
  theme(
    plot.title = element_text(face="bold", size=32, hjust=0.5, margin = margin(b = 18), lineheight = 0.5),
    legend.position = "none",
    axis.text.x = element_text(angle=0, hjust=0.5, size=18, lineheight=0.5,margin = margin(b = 10)),  # x축 텍스트 줄간격 더 좁게
    axis.text.y = element_text(size=18),
    axis.title.x = element_text(size=20, margin = margin(t = 18)),  # x축 제목 여백 적절히
    axis.title.y = element_text(angle = 0, vjust = 0.5, size=20),
    strip.text = element_text(face="bold", size=15, margin = margin(t = 6, b = 6)),
    panel.spacing = unit(1.5, "lines"),
    plot.margin = margin(20, 20, 20, 20)
  ) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.25))) +  # 상단 여백 적당히
  coord_cartesian(clip = "off")
```

### 문항18. 학생맞춤통합지원을 위해 주로 어느 부서와 협업합니까? (중복응답)

① 교무부 ② 연구부 ③ 생활지도부 ④ 교육복지부 ⑤ 진로부 ⑥ 상담부(위클래스) ⑦ 보건실 ⑧ 기타

학생맞춤통합지원을 위해 주로 협업하는 부서에 설문 응답건수는 총 2,765건이며 초등학교 응답건수는 1,302건(47.1%), 중학교 응답건수는 817건(29.5%), 고등학교 응답건수는 601건(21.7%), 특수학교 응답건수는 25건(0.9%), 각종학교 응답건수는 20건(0.7%)이었음

초등학교 응답 중에서 학생맞춤통합지원을 위해 주로 협업하는 부서로 교육복지부는 324건(24.9%), 생활지도부는 317건(24.3%), 상담부(위클래스)는 228건(17.5%), 교무부는 157건(12.1%), 연구부는 103건(7.9%), 보건실은 79건(6.1%), 진로부는 79건(6.1%) 등으로 나타났음

중학교 응답 중에서 학생맞춤통합지원을 위해 주로 협업하는 부서로 상담부(위클래스)는 267건(32.7%), 교육복지부는 215건(26.3%), 생활지도부는 132건(16.2%), 보건실은 61건(7.5%), 진로부는 59건(7.2%), 교무부는 38건(4.7%) 등으로 나타났음

고등학교 응답 중에서 학생맞춤통합지원을 위해 주로 협업하는 부서로 상담부(위클래스)는 183건(30.4%), 생활지도부는 142건(23.6%), 교육복지부는 68건(11.3%), 교무부는 42건(7%), 연구부는 32건(5.3%) 등으로 나타났음

특수학교 응답 중에서 학생맞춤통합지원을 위해 주로 협업하는 부서로 생활지도부는 11건(44%), 교무부는 7건(28%), 보건실은 2건(8%), 교육복지부, 연구부, 상담부(위클래스)가 각 1건(4%) 등으로 나타났음

각종학교 응답 중에서 학생맞춤통합지원을 위해 주로 협업하는 부서로 생활지도부는 7건(35%), 생활지도부는 4건(20%), 연구부는 3건(15%), 교무부는 2건(10%) 등으로 나타났음

```{r}
#| echo: false
#| warning: false
#| message: false
# 문항18 데이터 처리 
dat_q18_long <- dat_trimed %>%
  filter(!is.na(ques_18)) %>%
  separate_rows(ques_18, sep = ",\\s*") %>%
  mutate(
    ques_18 = str_trim(as.character(ques_18)),
    문항18 = recode(ques_18,
                   "1" = "교무부",
                   "2" = "연구부", 
                   "3" = "생활지도부",
                   "4" = "교육복지부",
                   "5" = "진로부",
                   "6" = "상담부(위클래스)",
                   "7" = "보건실",
                   "8" = "기타",
                   .default = "기타")
  )

# 기술통계
summary_q18 <- dat_q18_long %>%
  group_by(학교급, 문항18) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  mutate(pct = round(n / sum(n) * 100, 1)) %>%
  ungroup()

# 합계 추가 (필요한 경우)
summary_q18_total <- summary_q18 %>%
  group_by(학교급) %>%
  summarise(n = sum(n), pct = 100, 문항18 = "합계", .groups = "drop") %>%
  bind_rows(summary_q18) %>%
  arrange(학교급, 
          if_else(문항18 == "합계", 2, 1),
          desc(n))

print(summary_q18_total, n = Inf)
```

```{r}
#| echo: false
#| warning: false
#| message: false
ggplot(
  summary_q18 %>%
    mutate(문항18 = reorder(문항18, -n)),   # n 기준 내림차순 정렬
  aes(x = 문항18, y = n, fill = 문항18)
) +
  geom_bar(stat = "identity", width = 0.7) +
  geom_text(aes(label = paste0(n,"건\n(",pct,"%)"), 
                y = n + max(n) * 0.05),  # 최대값의 5%만큼 위에 위치
            vjust = 0.1, hjust = 0.5, size = 5.5, lineheight = 0.4) +
  facet_wrap(~학교급, ncol = 1, scales = "free_y") +
  labs(
    title = "학생맞춤통합지원팀 협력부서",
    x = "협력부서",
    y = "응답수"
  ) +
  scale_x_discrete(labels = c("교무부", "연구부", "생활지도부", "교육복지부", "진로부", "상담부\n(위클래스)", "보건실", "기타")) +
  theme_minimal(base_size = 13) +
  theme(
    plot.title = element_text(face = "bold", size = 32, hjust = 0.5),
    legend.position = "none",
    axis.text.x = element_text(angle = 0, vjust = 0.8, lineheight = 0.5, size = 17, margin = margin(t = 40)),  # 중복 제거 및 통합
    axis.text.y = element_text(size = 15),
    strip.text = element_text(face = "bold", size = 20),
    axis.title.x = element_text(size = 20, margin = margin(t = 18)),
    axis.title.y = element_text(angle = 0, vjust = 0.5, size = 20)  # y축 제목 크기 추가
  ) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.15))) +
  coord_cartesian(clip = "off")
```

### 문항19. 2025년도 상반기(1월\~6월)에 학생맞춤통합지원팀은 몇 회 운영하였습니까?

① 1회 ② 2회 ③ 3회 ④ 4회 ⑤ 5회 이상 ⑥ 미실시

2025년도 상반기 동안 학생맞춤통합지원팀을 운영한 횟수에 대한 문항에 응답자는 총 1,155명이며 초등학교 응답자는 518명(44.8%), 중학교 응답자는 347명(30%), 고등학교 응답자는 264명(22.9%), 특수학교 응답자는 17명(1.5%), 각종학교 응답자는 9명(0.8%)이었음

초등학교 응답 중에서 1회 운영했다는 응답은 171명(33%), 2회는 122명(23.6%), 3회는 73명(14.1%), 4회는 16명(3.1%), 5회 이상은 43명(8.3%), 미실시는 93명(18%)으로 나타났음

중학교 응답 중에서 1회 운영했다는 응답은 75명(21.6%), 2회는 78명(22.5%), 3회는 66명(19%), 4회는 28명(8.1%), 5회 이상은 44명(12.7%), 미실시는 56명(16.1%)으로 나타났음

고등학교 응답 중에서 1회 운영했다는 응답은 85명(32.1%), 2회는 58명(22%), 3회는 23명(8.7%), 4회는 9명(3.4%), 5회 이상은 17명(6.4%), 미실시는 72명(27.3%)으로 나타났음

특수학교 응답 중에서 1회 운영했다는 응답은 2명(11.8%), 2회는 1명(5.9%), 4회는 2명(14.1%), 5회 이상은 1명(5.9%), 미실시는 11명(64.7%)으로 나타났음

각종학교 응답 중에서 1회 운영했다는 응답은 2명(22.2%), 2회는 2명(22.2%), 미실시는 5명(55.6%)으로 나타났음

```{r}
#| echo: false
#| warning: false
#| message: false
# 문항19 데이터 처리 
dat_q19 <- dat_trimed %>%  # dat_q16 → dat_trimed로 변경
  filter(!is.na(ques_19)) %>%
  mutate(
    문항19 = recode(as.character(ques_19),
                   "1" = "1회",
                   "2" = "2회",
                   "3" = "3회", 
                   "4" = "4회",
                   "5" = "5회 이상",
                   "6" = "미실시",
                   .default = "기타"),
    문항19 = factor(문항19, levels = c("1회", "2회", "3회", "4회", "5회 이상", "미실시"))
  )

# 기술통계
summary_q19 <- dat_q19 %>%
  group_by(학교급, 문항19) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  mutate(pct = round(n / sum(n) * 100, 1)) %>%
  ungroup()

# 합계 추가
summary_q19_total <- summary_q19 %>%
  group_by(학교급) %>%
  summarise(n = sum(n), pct = 100, 문항19 = "합계", .groups = "drop") %>%
  bind_rows(summary_q19) %>%
  arrange(학교급,  # school_levels5 의존성 제거
          if_else(문항19 == "합계", 2, 1))

print(summary_q19_total, n = Inf)
```

```{r}
#| echo: false
#| warning: false
#| message: false
ggplot(
  summary_q19 %>%
    mutate(문항19 = reorder(문항19, -n)),   # n 기준 내림차순 정렬
  aes(x = 문항19, y = n, fill = 문항19)
) +
  geom_bar(stat = "identity", width = 0.7) +
  geom_text(aes(label = paste0(n,"교\n(",pct,"%)"), 
                y = n + max(n) * 0.05),  # 최대값의 5%만큼 위에 위치
            vjust = -0.2, hjust = 0.5, size = 5, lineheight = 0.4) +
  facet_wrap(~학교급, ncol = 1, scales = "free_y") +
  labs(
    title = "학생맞춤통합지원팀 회의 개최 횟수",
    x = "회의횟수",
    y = "응답수"
  ) +
  scale_x_discrete(labels = c("1회", "2회", "3회", "4회", "5회 이상", "미실시")) +
  theme_minimal(base_size = 13) +
  theme(
    plot.title = element_text(face = "bold", size = 32, hjust = 0.5),
    legend.position = "none",
    axis.text.x = element_text(angle = 0, vjust = 0.8, lineheight = 0.7, size = 15),
    axis.text.y = element_text(size = 15),
    strip.text = element_text(face = "bold", size = 20),
    axis.title.x = element_text(size = 20, margin = margin(t = 18)),
    axis.title.y = element_text(angle = 0, vjust = 0.5, size = 20)
  ) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.15))) +
  coord_cartesian(clip = "off")
```

### 문항20. 2025년도 상반기(1월\~6월)에 학생맞춤통합지원팀에서 지원한 학생은 몇 명입니까?

① 1명 ② 2명 ③ 3명 ④ 4명 ⑤ 5명 이상 ⑥ 없음

2025년도 상반기 동안 학생맞춤통합지원팀이 지원한 학생수에 대한 문항에 응답자는 총 1,155명이며 초등학교 응답자는 518명(44.8%), 중학교 응답자는 347명(30%), 고등학교 응답자는 264명(22.9%), 특수학교 응답자는 17명(1.5%), 각종학교 응답자는 9명(0.8%)이었음

초등학교 응답 중에서 1명을 지원했다는 응답은 83명(16%), 2명 지원은 81명(15.6%), 3명 지원은 54명(10.4%), 4명 지원은 141명(27.2%), 5명 이상은 141명(27.2%), 미지원은 124명(23.9%)으로 나타났음

중학교 응답 중에서 1명을 지원했다는 응답은 47명(13.5%), 2명 지원은 43명(12.4%), 3명 지원은 40명(11.5%), 4명 지원은 23명(6.6%), 5명 이상은 119명(34.3%), 미지원은 75명(21.6%)으로 나타났음

고등학교 응답 중에서 1명을 지원했다는 응답은 32명(12.1%), 2명 지원은 26명(9.8%), 3명 지원은 17명(6.4%), 4명 지원은 11명(4.2%), 5명 이상은 79명(29.9%), 미지원은 99명(37.5%)으로 나타났음

특수학교 응답 중에서 4명을 지원했다는 응답은 1명(5.9%), 5명 이상은 2명(11.8%), 미지원은 14명(82.4%)으로 나타났음

각종학교 응답 중에서 1명을 지원했다는 응답은 1명(11.1%), 3명 지원은 1명(11.1%), 5명 이상은 141명(22.2%), 미지원은 5명(55.6%)으로 나타났음

```{r}
# 문항20 데이터 처리 (간소화된 버전)
dat_q20 <- dat_trimed %>%  # dat_q19 → dat_trimed로 변경
  filter(!is.na(ques_20)) %>%
  mutate(
    문항20 = recode(as.character(ques_20),
                   "1" = "1명",
                   "2" = "2명",
                   "3" = "3명", 
                   "4" = "4명",
                   "5" = "5명 이상",
                   "6" = "없음",
                   .default = "기타"),
    문항20 = factor(문항20, levels = c("1명", "2명", "3명", "4명", "5명 이상", "없음"))
  )

# 기술통계
summary_q20 <- dat_q20 %>%
  group_by(학교급, 문항20) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  mutate(pct = round(n / sum(n) * 100, 1)) %>%
  ungroup()

# 합계 추가
summary_q20_total <- summary_q20 %>%
  group_by(학교급) %>%
  summarise(n = sum(n), pct = 100, 문항20 = "합계", .groups = "drop") %>%
  bind_rows(summary_q20) %>%
  arrange(학교급,  # school_levels5 의존성 제거
          if_else(문항20 == "합계", 2, 1))

print(summary_q20_total, n = Inf)
```

```{r}
# 시각화
ggplot(
  summary_q20 %>%
    mutate(문항20 = reorder(문항20, -n)),   # n 기준 내림차순 정렬
  aes(x = 문항20, y = n, fill = 문항20)
) +
  geom_bar(stat = "identity", width = 0.7) +
  geom_text(aes(label = paste0(n,"교\n(",pct,"%)"), 
                y = n + max(n) * 0.05),  # 최대값의 5%만큼 위에 위치
            vjust = -0.2, hjust = 0.5, size = 5, lineheight = 0.4) +
  facet_wrap(~학교급, ncol = 1, scales = "free_y") +
  labs(
    title = "학생맞춤통합지원팀\n 지원한 학생수",
    x = "지원학생수",
    y = "응답수"
  ) +
  scale_x_discrete(labels = c("1명", "2명", "3명", "4명", "5명 이상", "없음")) +
  theme_minimal(base_size = 13) +
  theme(
    plot.title = element_text(face = "bold", size = 32, hjust = 0.5),
    legend.position = "none",
    axis.text.x = element_text(angle = 0, vjust = 0.8, lineheight = 0.7, size = 15),
    axis.text.y = element_text(size = 15),
    strip.text = element_text(face = "bold", size = 20),
    axis.title.x = element_text(size = 20, margin = margin(t = 18)),
    axis.title.y = element_text(angle = 0, vjust = 0.5, size = 20)
  ) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.15))) +
  coord_cartesian(clip = "off")
```

### 문항21. 학생맞춤통합지원팀에 의뢰된 지원요청은 어느 분야입니까? \[20번 문항에 ① \~ ⑤항으로 답변한 경우만 응답\] (중복응답)

① 경제적 지원 ② 심리정서 지원 ③ 학업 및 진로지원 ④ 안전지원(학교폭력, 아동학대, 성희롱ㆍ성폭력, 게임중독, 약물중독 등) ⑤ 건강지원(위생관리, 영양관리, 운동관리, 스트레스 관리, 수면관리, 스마트폰 사용 시간 관리 등)

학생맞춤통합지원팀에 의뢰된 지원요청 분야에 대한 설문 응답건수는 총 1,594건이며 초등학교 응답건수는 722건(45.3%), 중학교 응답건수는 544건(34.1%), 고등학교 응답건수는 315건(19.8%), 특수학교 응답건수는 7건(0.4%), 각종학교 응답건수는 6건(0.4%)이었음

초등학교 응답 중에서 심리정서 지원 요청건수는 346건(47.9%), 경제적 지원 요청건수는 151건(20.9%), 학업 및 진로지원 요청건수는 112건(15.5%), 안전지원 요청건수는 63건(8.7%), 건강지원 요청건수는 50건(6.9%)으로 나타났음

중학교 응답 중에서 심리정서 지원 요청건수는 223건(41%), 경제적 지원 요청건수는 150건(27.6%), 학업 및 진로지원 요청건수는 73건(13.4%), 안전지원 요청건수는 54건(9.9%), 건강지원 요청건수는 44건(8.1%)으로 나타났음

고등학교 응답 중에서 심리정서 지원 요청건수는 127건(40.3%), 경제적 지원 요청건수는 88건(27.9%), 학업 및 진로지원 요청 건수는 66건(21%), 건강지원 요청건수는 17건(5.4%), 안전지원 요청건수는 17건(5.4%)으로 나타났음

특수학교 응답 중에서 심리정서 지원 요청건수는 3건(47.9%), 안전지원 요청건수는 3건(42.9%), 경제적 지원 요청건수는 1건(14.3%)으로 나타났음

각종학교 응답 중에서 경제적 지원 요청건수는 2건(33.3%), 심리정서 지원 요청건수는 3건(33.3%), 안전지원 요청 건수는 1건(16.7%), 학업 및 진로지원 요청건수는 1건(16.7%)으로 나타났음

```{r}
#| echo: false
#| warning: false
#| message: false
# 문항21 데이터 처리 
dat_q21_long <- dat_trimed %>%
  filter(!is.na(ques_20), !is.na(ques_21)) %>%
  filter(as.character(ques_20) %in% as.character(1:5)) %>%  # 문항20이 1~5인 경우만
  separate_rows(ques_21, sep = ",\\s*") %>%
  mutate(ques_21 = str_trim(as.character(ques_21))) %>%
  filter(ques_21 %in% as.character(1:5)) %>%  # 문항21이 1~5인 경우만
  mutate(
    문항21 = recode(ques_21,
                   "1" = "경제적 지원",
                   "2" = "심리정서 지원",
                   "3" = "학업 및 진로지원",
                   "4" = "안전지원",
                   "5" = "건강지원",
                   .default = "기타")
  )

# 기술통계
summary_q21 <- dat_q21_long %>%
  group_by(학교급, 문항21) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  mutate(pct = round(n / sum(n) * 100, 1)) %>%
  ungroup()

# 합계 추가
summary_q21_total <- summary_q21 %>%
  group_by(학교급) %>%
  summarise(n = sum(n), pct = 100, 문항21 = "합계", .groups = "drop") %>%
  bind_rows(summary_q21) %>%
  arrange(학교급,  # school_levels5 의존성 제거
          if_else(문항21 == "합계", 2, 1),
          desc(n))

print(summary_q21_total, n = Inf)
```

```{r}
#| echo: false
#| warning: false
#| message: false
ggplot(
  summary_q21 %>%
    mutate(문항21 = reorder(문항21, -n)),   # n 기준 내림차순 정렬
  aes(x = 문항21, y = n, fill = 문항21)
) +
  geom_bar(stat = "identity", width = 0.7) +
  geom_text(aes(label = paste0(n,"건\n(",pct,"%)"), 
                y = n + max(n) * 0.05),  # 최대값의 5%만큼 위에 위치
            vjust = 0.1, hjust = 0.5, size = 4.5, lineheight = 0.4) +
  facet_wrap(~학교급, ncol = 1, scales = "free_y") +
  labs(
    title = "학생맞춤통합지원 제공 영역",
    x = "지원영역",
    y = "응답수"
  ) +
  scale_x_discrete(labels = c("경제적 지원", "심리정서 지원", "학업 및\n진로지원", "안전지원", "건강지원")) +
  theme_minimal(base_size = 13) +
  theme(
    plot.title = element_text(face = "bold", size = 32, hjust = 0.5),
    legend.position = "none",
    axis.text.x = element_text(angle = 0, vjust = 0.8, lineheight = 0.7, size = 15),
    axis.text.y = element_text(size = 15),
    strip.text = element_text(face = "bold", size = 20),
    axis.title.x = element_text(size = 20, margin = margin(t = 18)),
    axis.title.y = element_text(angle = 0, vjust = 0.5, size = 20)
  ) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.15))) +
  coord_cartesian(clip = "off")
```

### 문항22. 학생맞춤통합지원팀 운영과정에서 겪는 어려움은 어떤 영역입니까? (중복응답)

① 명확한 운영 방침 부재 ② 학생 관리 시스템 부재 ③ 교사의 인식 부족 ④ 교육구성원 간 협력부족 ⑤ 학생 지원 방안의 복잡성 ⑥ 외부기관과의 연계 어려움 ⑦ 기타 (주관식: (예시) 전문가의 자문 및 학교상황에 맞는 지도방법 등)

학생맞춤통합지원팀 운영과정의 어려움에 대한 설문에 총 응답건수는 1,473건이며 초등학교 응답건수는 680명(46.16%), 중학교 응답건수는 472건(32.04%)이고 고등학교 응답건수는 306건(20.78%)이고, 특수학교 응답건수는 7건(0.48%)이고 각종학교 응답건수는 8건(0.54%)으로 나타남

초등학교 응답 중에서 통합지원팀 운영 과정에서 어려움을 겪는 분야에 대해 학생 지원 방안의 복잡성으로 응답한 건수가 194건(28.5%)이고 명확한 운영 방침 부재라고 응답한 건수는 141건(20.7%), 외부기관과의 연계 어려움으로 131건(19.3%), 학생 관리 시스템 부재라는 응답건수는 92건(13.5%), 교육구성원 간 협력부족은 37건(5.4%), 교사의 인식 부족은 31건(4.6%) 등으로 응답하였음

중학교 응답 중에서 통합지원팀 운영 과정에서 어려움을 겪는 분야에 대해 학생 지원 방안의 복잡성으로 응답한 건수가 132건(28%)이고 명확한 운영 방침 부재라고 응답한 건수는 95건(20.1%), 외부기관과의 연계 어려움으로 86건(18.2%), 학생 관리 시스템 부재라는 응답건수는 56건(11.9%), 교육구성원 간 협력부족은 34건(7.2%), 교사의 인식 부족은 33건(7%) 등이라고 응답하였음

고등학교 응답 중에서 통합지원팀 운영 과정에서 어려움을 겪는 분야에 대해 학생 지원 방안의 복잡성으로 응답한 건수가 97건(31.7%)이고 명확한 운영 방침 부재라고 응답한 건수는 64건(20.9%), 외부기관과의 연계 어려움으로 41건(13.4%), 학생 관리 시스템 부재라는 응답건수는 29건(9.5%), 교육구성원 간 협력부족은 25건(8.2%) 등이라고 응답하였음

특수학교 응답 중에서 통합지원팀 운영 과정에서 어려움을 겪는 분야에 대해 외부기관과의 연계 어려움이라고 응답한 건수가 3건(42.9%)이고 교사의 인식부족으로 응답한 건수는 1건(14.3%), 교육구성원 간 협력부족으로 응답한 건수는 1건(14.33%), 명확한 운영 방침 부재라고 응답한 건수는 1건(14.3%), 학생 지원 방안의 복잡성이라고 응답한 건수가 1건(14.3%)라고 응답하였음

각종학교 응답 중에서 통합지원팀 운영 과정에서 어려움을 겪는 분야에 대해 교육구성원 간 협력부족이라는 응답건수는 2건(25%), 학생 관리 시스템 부재라는 응답건수는 2건(25%), 교사의 인식부족으로 응답한 건수가 1건(12.5%), 명확한 운영 방침 부재라고 응답한 건수는 1건(12.5%), 외부기관과의 연계 어려움이라고 응답한 건수는 1건(12.5%), 학생 지원 방안의 복잡성이라고

```{r}
#| echo: false
#| warning: false
#| message: false
dat_q22_long <- dat_trimed %>%
  filter(!is.na(ques_20), !is.na(ques_21), !is.na(ques_22)) %>%
  filter(as.character(ques_20) %in% as.character(1:5)) %>%  # 문항20 조건 유지
  separate_rows(ques_22, sep = ",\\s*") %>%
  mutate(ques_22 = str_trim(as.character(ques_22))) %>%
  filter(ques_22 %in% as.character(1:7)) %>%  # 문항22가 1~7인 경우만
  mutate(
    문항22 = recode(ques_22,
                   "1" = "명확한 운영 방침 부재",
                   "2" = "학생 관리 시스템 부재",
                   "3" = "교사의 인식 부족",
                   "4" = "교육구성원 간 협력부족",
                   "5" = "학생 지원 방안의 복잡성",
                   "6" = "외부기관과의 연계 어려움",
                   "7" = "기타",
                   .default = "기타")
  )

# 기술통계
summary_q22 <- dat_q22_long %>%
  group_by(학교급, 문항22) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  mutate(pct = round(n / sum(n) * 100, 1)) %>%
  ungroup()

# 합계 추가
summary_q22_total <- summary_q22 %>%
  group_by(학교급) %>%
  summarise(n = sum(n), pct = 100, 문항22 = "합계", .groups = "drop") %>%
  bind_rows(summary_q22) %>%
  arrange(학교급,  # school_levels5 의존성 제거
          if_else(문항22 == "합계", 2, 1),
          desc(n))

print(summary_q22_total, n = Inf)
```

```{r}
#| echo: false
#| warning: false
#| message: false
# 시각화
ggplot(
  summary_q22 %>%
    mutate(문항22 = reorder(문항22, -n)),   # n 기준 내림차순 정렬
  aes(x = 문항22, y = n, fill = 문항22)
) +
  geom_bar(stat = "identity", width = 0.7) +
  geom_text(aes(label = paste0(n,"건(",pct,"%)"), 
                y = n + max(n) * 0.05),  # 최대값의 5%만큼 위에 위치
            vjust = 0.15, hjust = 0.5, size = 4.5, lineheight = 0.4) +
  facet_wrap(~학교급, ncol = 1, scales = "free_y") +
  labs(
    title = "학생맞춤통합지원 운영의 어려움",
    x = "운영과정의 어려움 유형",
    y = "응답수"
  ) +
  scale_x_discrete(labels = c("명확한 운영\n방침 부재", "학생 관리\n시스템 부재", "교사의\n인식 부족", "교육구성원 간\n협력부족", "학생 지원 방안의\n복잡성", "외부기관과의\n연계 어려움", "기타")) +
  theme_minimal(base_size = 13) +
  theme(
    plot.title = element_text(face = "bold", size = 32, hjust = 0.5),
    legend.position = "none",
    axis.text.x = element_text(angle = 0, vjust = 0.8, lineheight = 0.4, size = 15),
    axis.text.y = element_text(size = 15),
    strip.text = element_text(face = "bold", size = 20),
    axis.title.x = element_text(size = 20, margin = margin(t = 18)),
    axis.title.y = element_text(angle = 0, vjust = 0.5, size = 20)
  ) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.15))) +
  coord_cartesian(clip = "off")
```

### 문항23. 학생맞춤통합지원팀과 지역기관(교육지원청 운영 각종센터 등 포함)이 연계하여 학생을 지원한 적이 있습니까?

① 그렇다 ② 아니다

학생맞춤통합지원팀이 지역기관과 연계하여 학생을 지원한 적이 있는지에 대한 설문에 총 응답자는 838명이고 초등학교 응답자는 394명(47%) 중학교 응답자는 272명(32.4%)이고 고등학교 응답자는 165명(19.7%)이고, 특수학교 응답자는 3명(0.4%)이고 각종학교 응답자는 4명(0.5%)으로 나타남

초등학교에서 통합지원팀이 지역기관과 연계해서 지원한 적이 있다고 답변한 응답자는 296명(75.1%)이고 지원하지 않았다는 응답자는 98명(24.9%)였음

중학교에서 통합지원팀이 지역기관과 연계해서 지원한 적이 있다고 답변한 응답자는 202명(74.3%)이고 지원하지 않았다는 응답지는 70명(25.7%)였음

고등학교에서 통합지원팀이 지역기관과 연계해서 지원한 적이 있다고 답변한 응답자는 91명(55.2%)이고 지원하지 않았다는 응답자는 74명(44.8%)였음

특수학교에서 통합지원팀이 지역기관과 연계해서 지원한 적이 있다고 답변한 응답자는 1명(33.3%)이고 지원하지 않았다는 응답자는 2명6.6%)였음

각종학교에서 통합지원팀이 지역기관과 연계해서 지원한 적이 있다고 답변한 응답자 3명5%)이고 지원하지 않았다는 응답자 1명5%)였음

```{r}
#| echo: false
#| warning: false
#| message: false
# 문항23 데이터 처리 (간소화된 버전)
dat_q23 <- dat_trimed %>%
  filter(!is.na(ques_20), !is.na(ques_21), !is.na(ques_22), !is.na(ques_23)) %>%
  filter(as.character(ques_20) %in% as.character(1:5)) %>%  # 문항20 조건 유지
  mutate(
    문항23 = recode(as.character(ques_23),
                   "1" = "그렇다",
                   "2" = "아니다",
                   .default = "기타"),
    문항23 = factor(문항23, levels = c("그렇다", "아니다"))
  )

# 기술통계
summary_q23 <- dat_q23 %>%
  group_by(학교급, 문항23) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  mutate(pct = round(n / sum(n) * 100, 1)) %>%
  ungroup()

# 합계 추가
summary_q23_total <- summary_q23 %>%
  group_by(학교급) %>%
  summarise(n = sum(n), pct = 100, 문항23 = "합계", .groups = "drop") %>%
  bind_rows(summary_q23) %>%
  arrange(학교급,  # school_levels5 의존성 제거
          if_else(문항23 == "합계", 2, 1),
          desc(n))

print(summary_q23_total, n = Inf)
```

```{r}
#| echo: false
#| warning: false
#| message: false
# 시각화 (3행 2열)
ggplot(summary_q23, aes(x = 문항23, y = n, fill = 문항23)) +
  geom_bar(stat="identity", width=0.7) +
  geom_text(aes(label = paste0(n,"명\n(",pct,"%)"),
                y = n),  # 막대 바로 위에 위치
            hjust=0.5, vjust=-0.1, size=6, fontface="bold", lineheight=0.5) +
  facet_wrap(~학교급, ncol = 2, nrow = 3) +  # 3행 2열 배치
  labs(
    title = "학생맞춤통합지원팀\n 지역기관 연계여부",
    x = "연계여부",
    y = "응답수"
  ) +
  scale_x_discrete(labels = c("그렇다", "아니다")) +
  theme_minimal(base_size = 13) +
  theme(
    plot.title = element_text(face="bold", size=32, hjust=0.5, margin = margin(b = 18), lineheight = 0.5),
    legend.position = "none",
    axis.text.x = element_text(angle=0, hjust=0.5, size=18, lineheight=0.6),
    axis.text.y = element_text(size=18),
    axis.title.x = element_text(size=20, margin = margin(t = 18)),
    axis.title.y = element_text(angle = 0, vjust = 0.5, size=20),
    strip.text = element_text(face="bold", size=18, margin = margin(t = 6, b = 6)),
    panel.spacing = unit(1.5, "lines"),
    plot.margin = margin(20, 20, 20, 20)
  ) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.25))) +
  coord_cartesian(clip = "off")
```

### 문항24.\[23번 문항에 ①로 답변한 응답자만 응답\] 학생지원을 위해 연계ㆍ협력하는 기관은 어떤 기관입니까? (중복응답)

① 지역교육복지센터 ② 위(Wee)센터 ③ 지역학습진단성장센터 ④ 구청 ⑤ 동주민센터 ⑥ 복지관 ⑦ 청소년상담복지센터 ⑧ 청소년센터 ⑨ 가족센터 ⑩ 기타

학생지원을 위해 연계ㆍ협력하는 기관에 대한 설문에 총 응답건수는 1,436건이고 초등학교 응답건수는 712건(49.6%) 중학교 응답건수는 490건(34.1%)이고 고등학교 응답건수는 223건(15.5%)이고, 특수학교 응답건수는 3건(0.2%)이고 각종학교 응답건수는 8건(0.6%)으로 나타남

초등학교 응답 중에서 학생지원을 위해 연계ㆍ협력한 지역기관으로 지역교육복지센터라고 답변한 응답건수는 226건(31.7%), 위(Wee)센터라고 답변한 응답건수는 168건(23.6%), 청소년상담복지센터라고 답변한 응답건수는 89건(12.5%), 구청이라고 답변한 응답건수는 49건(6.9%), 지역학습진단성장센터라고 답변한 응답건수는 44건(6.2%) 복지관이라고 답변한 응답건수는 43건(6%), 주민센터라고 답변한 응답건수는 36건(5.1%) 등으로 나타났음

중학교 응답 중에서 학생지원을 위해 연계ㆍ협력한 지역기관으로 지역교육복지센터라고 답변한 응답건수는 136건(27.8%), 위(Wee)센터라고 답변한 응답건수는 109건(22.2%), 청소년상담복지센터라고 답변한 응답건수는 96건(19.6%), 구청이라고 답변한 응답건수는 34건(6.9%), 복지관이라고 답변한 응답건수는 33건(6.7%) 주민센터라고 답변한 응답건수는 29건(5.9%), 지역학습진단성장센터라고 답변한 응답건수는 20건(4.1%) 등으로 나타났음

고등학교 응답 중에서 학생지원을 위해 연계ㆍ협력한 지역기관으로 지역교육복지센터라고 답변한 응답건수는 79건(35.4%), 위(Wee)센터라고 답변한 응답건수는 54건(24.2%), 청소년상담복지센터라고 답변한 응답건수는 46건(20.6%), 청소년센터라고 답변한 응답건수는 11건(4.9%), 복지관이라고 답변한 응답건수는 9건(4%), 지역학습진단성장센터라고 답변한 응답건수는 5건(2.2%) 등으로 나타났음

특수학교 응답 중에서 교학생지원을 위해 연계ㆍ협력한 지역기관으로 가족센터센터라고 답변한 응답건수는 1건(33.3%), 위(Wee)센터라고 답변한 응답건수는 1건(33.3%), 지역교육복지센터라고 답변한 응답건수는 1건(33.3%)로 나타났음

각종학교 응답 중에서 학생지원을 위해 연계ㆍ협력한 지역기관으로 위(Wee)센터라고 답변한 응답건수는 3건(37.5%), 주민센터라고 답변한 응답건수는 1건(12.5%), 복지관이라고 답변한 응답건수는 1건(12.5%), 지역교육복지센터라고 답변한 응답건수는 1건(12.5%), 지역학습진단성장센터라고 답변한 응답건수는 1건(12.5%), 청소년상담복지센터라고 응답한 건수는 1건(12.5%)로 나타났음

```{r}
#| echo: false
#| warning: false
#| message: false
dat_q24_long <- dat_trimed %>%
  filter(!is.na(ques_23), !is.na(ques_24)) %>%
  filter(as.character(ques_23) == "1") %>%  # 문항23에서 "그렇다"인 경우만
  separate_rows(ques_24, sep = ",\\s*") %>%
  mutate(ques_24 = str_trim(as.character(ques_24))) %>%
  filter(ques_24 %in% as.character(1:10)) %>%
  mutate(
    문항24 = recode(ques_24,
                   "1" = "지역교육복지센터",
                   "2" = "위(Wee)센터",
                   "3" = "지역학습진단성장센터",
                   "4" = "구청",
                   "5" = "동주민센터",
                   "6" = "복지관",
                   "7" = "청소년상담복지센터",
                   "8" = "청소년센터",
                   "9" = "가족센터",
                   "10" = "기타",
                   .default = "기타")
  )

# 기술통계
summary_q24 <- dat_q24_long %>%
  group_by(학교급, 문항24) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  mutate(pct = round(n / sum(n) * 100, 1)) %>%
  ungroup()

summary_q24_total <- summary_q24 %>%
  group_by(학교급) %>%
  summarise(n = sum(n), pct = 100, 문항24 = "합계", .groups = "drop") %>%
  bind_rows(summary_q24) %>%
  arrange(학교급, if_else(문항24 == "합계", 2, 1), desc(n))

print(summary_q24_total, n = Inf)
```

```{r}
#| echo: false
#| warning: false
#| message: false
ggplot(summary_q24 %>% mutate(문항24 = reorder(문항24, -n)), aes(x = 문항24, y = n, fill = 문항24)) +
  geom_bar(stat = "identity", width = 0.7) +
  geom_text(aes(label = paste0(n,"건\n(",pct,"%)"), y = n + max(n) * 0.05),
            vjust = 0, hjust = 0.5, size = 5, lineheight = 0.4) +
  facet_wrap(~학교급, ncol = 1, scales = "free_y") +
  labs(title = "연계협력 기관", x = "기관 유형", y = "응답수") +
  scale_x_discrete(labels = c("지역교육\n복지센터", "위(Wee)\n센터", "지역학습\n진단성장\n센터", "구청", "동주민\n센터", "복지관", "청소년\n상담복지\n센터","청소년\n센터","가족센터","기타")) +
  theme_minimal(base_size = 13) +
  theme(
    plot.title = element_text(face = "bold", size = 32, hjust = 0.5),
    legend.position = "none",
    axis.text.x = element_text(angle = 0, vjust = 0.8, lineheight = 0.7, size = 15),
    axis.text.y = element_text(size = 15),
    strip.text = element_text(face = "bold", size = 20),
    axis.title.x = element_text(size = 20, margin = margin(t = 18)),
    axis.title.y = element_text(angle = 0, vjust = 0.5, size = 20)
  ) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.15))) +
  coord_cartesian(clip = "off")
```

### 문항25. 2025년 상반기(1월\~6월 현재)에 학생맞춤통합지원에 대한 교직원 연수는 몇 회 실시하였습니까?

① 1회 ② 2회 ③ 3회이상 ④ 미실시

2025년도 상반기 동안 실시한 교직원 연수 횟수에 대한 설문에 응답자는 총 1,155명이며 초등학교 응답자는 518명(44.8%), 중학교 응답자는 347명(30%), 고등학교 응답자는 264명(22.9%), 특수학교 응답자는 17명(1.5%), 각종학교 응답자는 9명(0.8%)이었음

초등학교 응답 중에서 1회 실시했다는 응답은 278명(53.7%), 2회 실시했다는 응답은 27명(5.2%), 3회 이상 실시했다는 응답은 6명(1.2%), 미실시는 207명(40%)으로 나타났음

중학교 응답 중에서 1회 실시했다는 응답은 197명(56.8%), 2회 실시했다는 응답은 24명(6.9%), 3회 이상 실시했다는 응답은 6명(1.7%), 미실시는 120명(34.6%)으로 나타났음

고등학교 응답 중에서 1회 실시했다는 응답은 278명(46.2%), 2회 실시했다는 응답은 6명(2.3%), 미실시는 136명(51.5%)으로 나타났음

특수학교 응답 중에서 1회 실시했다는 응답은 1명(5.9%), 2회 실시했다는 응답은 1명(5.9%), 3회 이상 실시했다는 응답은 1명(5.9%), 미실시는 14명(82.3%)으로 나타났음

각종학교 응답 중에서 1회 실시했다는 응답은 1명(11.1%), 2회 실시했다는 응답은 1건(11.1%), 미실시는 7명(77.8%)으로 나타났음

```{r}
#| echo: false
#| warning: false
#| message: false
# 데이터 처리
dat_q25 <- dat_trimed %>%
  filter(!is.na(ques_25)) %>%
  mutate(
    문항25 = recode(as.character(ques_25),
                   "1" = "1회",
                   "2" = "2회",
                   "3" = "3회 이상",
                   "4" = "미실시",
                   .default = "기타"),
    문항25 = factor(문항25, levels = c("1회", "2회", "3회 이상", "미실시"))
  )

# 기술통계
summary_q25 <- dat_q25 %>%
  group_by(학교급, 문항25) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  mutate(pct = round(n / sum(n) * 100, 1)) %>%
  ungroup()

summary_q25_total <- summary_q25 %>%
  group_by(학교급) %>%
  summarise(n = sum(n), pct = 100, 문항25 = "합계", .groups = "drop") %>%
  bind_rows(summary_q25) %>%
  arrange(학교급, if_else(문항25 == "합계", 2, 1), desc(n))

print(summary_q25_total, n = Inf)
```

```{r}
#| echo: false
#| warning: false
#| message: false

# 시각화
ggplot(summary_q25 %>% mutate(문항25 = reorder(문항25, -n)), aes(x = 문항25, y = n, fill = 문항25)) +
  geom_bar(stat = "identity", width = 0.7) +
  geom_text(aes(label = paste0(n,"명\n(",pct,"%)"), y = n + max(n) * 0.05),
            vjust = -0.2, hjust = 0.5, size = 6.5, lineheight = 0.4) +
  facet_wrap(~학교급, ncol = 1, scales = "free_y") +
  labs(title = "교직원 연수 실시 횟수", x = "연수 횟수", y = "응답수") +
  scale_x_discrete(labels = c("1회", "2회", "3회 이상", "미실시")) +
  theme_minimal(base_size = 13) +
  theme(
    plot.title = element_text(face = "bold", size = 32, hjust = 0.5),
    legend.position = "none",
    axis.text.x = element_text(angle = 0, vjust = 0.8, lineheight = 0.7, size = 20),
    axis.text.y = element_text(size = 20),
    strip.text = element_text(face = "bold", size = 20),
    axis.title.x = element_text(size = 20, margin = margin(t = 18)),
    axis.title.y = element_text(angle = 0, vjust = 0.5, size = 20)
  ) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.15))) +
  coord_cartesian(clip = "off")
```

### 문항26. 교직원 연수를 실시했다면, 연수내용은 무엇이었습니까? (중복응답)

① 학생맞춤통합지원 정책이해 ② 학생맞춤통합지원팀 운영절차 ③ 학생맞춤통합지원 지원사례 ④ 기타(주관식)

교직원 연수를 실시한 경우 연수내용에 대한 설문에 응답건수는 총 895건이며 초등학교 응답건수는 415건(46.4%), 중학교 응답건수는 313건(35%), 고등학교 응답건수는 161건(18%), 특수학교 응답건수는 4건(0.4%), 각종학교 응답건수는 2건(0.2%)이었음

초등학교 응답 중에서 정책이해라는 응답은 234건(56.4%), 운영절차라는 응답은 122건(29.4%), 지원사례라는 응답은 53건(12.8%) 등으로 나타났음

중학교 응답 중에서 정책이해라는 응답은 172건(55%), 운영절차라는 응답은 103건(32.9%), 지원사례라는 응답은 33건(10.5%) 등으로 나타났음

고등학교 응답 중에서 정책이해라는 응답은 98건(60.9%), 운영절차라는 응답은 46건(28.6%), 지원사례라는 응답은 15건(9.3%) 등으로 나타났음

특수학교 응답 중에서 운영절차라는 응답은 2건(50%), 기타가 2건(50%)로 나타났음

각종학교 응답 중에서 운영절차라는 응답은 2건(100%)로 나타났음

```{r}
#| echo: false
#| warning: false
#| message: false

# 데이터 처리 (복수응답)
dat_q26_long <- dat_trimed %>%
  filter(!is.na(ques_25), !is.na(ques_26)) %>%
  filter(as.character(ques_25) %in% as.character(1:3)) %>%  # 문항25에서 1~3인 경우만
  separate_rows(ques_26, sep = ",\\s*") %>%
  mutate(ques_26 = str_trim(as.character(ques_26))) %>%
  filter(ques_26 %in% as.character(1:4)) %>%
  mutate(
    문항26 = recode(ques_26,
                   "1" = "정책이해",
                   "2" = "운영절차",
                   "3" = "지원사례",
                   "4" = "기타",
                   .default = "기타")
  )

# 기술통계
summary_q26 <- dat_q26_long %>%
  group_by(학교급, 문항26) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  mutate(pct = round(n / sum(n) * 100, 1)) %>%
  ungroup()

summary_q26_total <- summary_q26 %>%
  group_by(학교급) %>%
  summarise(n = sum(n), pct = 100, 문항26 = "합계", .groups = "drop") %>%
  bind_rows(summary_q26) %>%
  arrange(학교급, if_else(문항26 == "합계", 2, 1), desc(n))

print(summary_q26_total, n = Inf)
```

```{r}
#| echo: false
#| warning: false
#| message: false

# 시각화
ggplot(summary_q26 %>% mutate(문항26 = reorder(문항26, -n)), aes(x = 문항26, y = n, fill = 문항26)) +
  geom_bar(stat = "identity", width = 0.7) +
  geom_text(aes(label = paste0(n,"건\n(",pct,"%)"), y = n + max(n) * 0.05),
            vjust = -0.2, hjust = 0.5, size = 6.5, lineheight = 0.6) +
  facet_wrap(~학교급, ncol = 1, scales = "free_y") +
  labs(title = "교직원 연수 내용", x = "연수 내용", y = "응답수") +
  scale_x_discrete(labels = c("정책이해", "운영절차", "지원사례", "기타")) +
  theme_minimal(base_size = 13) +
  theme(
    plot.title = element_text(face = "bold", size = 32, hjust = 0.5),
    legend.position = "none",
    axis.text.x = element_text(angle = 0, vjust = 0.8, lineheight = 0.7, size = 20),
    axis.text.y = element_text(size = 20),
    strip.text = element_text(face = "bold", size = 20),
    axis.title.x = element_text(size = 20, margin = margin(t = 18)),
    axis.title.y = element_text(angle = 0, vjust = 0.5, size = 20)
  ) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.15))) +
  coord_cartesian(clip = "off")
```

### 문항27. 교육부 또는 교육(지원)청에서 ‘교직원 대상 학생맞춤통합지원 찾아가는 연수’를 실시한다면 연수를 신청할 의향이 있으십니까?

① 그렇다 ② 아니다

교육청이나 교육지원청이 찾아가는 연수를 시행하는 경우 연수에 참여할 의향이 있는지에 대한 설문에 응답자는 총 1,155명이며 초등학교 응답자는 518명(44.8%), 중학교 응답자는 347건(30%), 고등학교 응답자는 264건(22.9%), 특수학교 응답자는 17건(1.5%), 각종학교 응답자는 9건(0.8%)이었음

초등학교 응답 중에서 그렇다는 응답은 265명(51.2%), 아니오라는 응답은 253명(48.8%)으로 나타났음

중학교 응답 중에서 그렇다는 응답은 201명(57.9%), 아니오라는 응답은 146명(42.1%)으로 나타났음

고등학교 응답 중에서 그렇다는 응답은 148명(56.1%), 아니오라는 응답은 116명(43.9%)으로 나타났음

특수학교 응답 중에서 그렇다는 응답은 10명(58.8%), 아니오라는 응답은 7명(41.2%)으로 나타났음

각종학교 응답 중에서 그렇다는 응답은 6명(66.7%), 아니오라는 응답은 3명(33.3%)으로 나타났음

```{r}
#| echo: false
#| warning: false
#| message: false
# 데이터 처리
dat_q27 <- dat_trimed %>%
  filter(!is.na(ques_27)) %>%
  mutate(
    문항27 = recode(as.character(ques_27),
                   "1" = "그렇다",
                   "2" = "아니다",
                   .default = "기타"),
    문항27 = factor(문항27, levels = c("그렇다", "아니다"))
  )

# 기술통계
summary_q27 <- dat_q27 %>%
  group_by(학교급, 문항27) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  mutate(pct = round(n / sum(n) * 100, 1)) %>%
  ungroup()

summary_q27_total <- summary_q27 %>%
  group_by(학교급) %>%
  summarise(n = sum(n), pct = 100, 문항27 = "합계", .groups = "drop") %>%
  bind_rows(summary_q27) %>%
  arrange(학교급, if_else(문항27 == "합계", 2, 1), desc(n))

print(summary_q27_total, n = Inf)
```

```{r}
#| echo: false
#| warning: false
#| message: false
ggplot(summary_q27, aes(x = 문항27, y = n, fill = 문항27)) +
  geom_bar(stat="identity", width=0.7) +
  geom_text(aes(label = paste0(n,"명\n(",pct,"%)"), y = n),
            hjust=0.5, vjust=0, size=6, fontface="bold", lineheight=0.5) +
  facet_wrap(~학교급, ncol = 2, nrow = 3) +
  labs(title = "찾아가는 연수 신청 의향\n(학교급별)", x = "신청의향", y = "응답수") +
  scale_x_discrete(labels = c("그렇다", "아니다")) +
  theme_minimal(base_size = 13) +
  theme(
    plot.title = element_text(face="bold", size=32, hjust=0.5, margin = margin(b = 18), lineheight = 0.5),
    legend.position = "none",
    axis.text.x = element_text(angle=0, hjust=0.5, size=20, lineheight=0.6),
    axis.text.y = element_text(size=18),
    axis.title.x = element_text(size=18, margin = margin(t = 18)),
    axis.title.y = element_text(angle = 0, vjust = 0.5, size=20),
    strip.text = element_text(face="bold", size=23, margin = margin(t = 6, b = 6)),
    panel.spacing = unit(1.5, "lines"), plot.margin = margin(20, 20, 20, 20)
  ) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.25))) +
  coord_cartesian(clip = "off")
```

# 5. 실태조사 (학생맞춤통합지원을 위한 교육구성원의 협력 필요성 인식 조사)

### 문항28. 학교 내 도움이 필요한 학생을 지원하기 위해 학교 구성원 간 협력이 중요하다고 생각하십니까?

① 매우 그렇다 ② 그렇다 ③ 보통이다 ④ 그렇지 않다 ⑤ 매우 그렇지 않다

학교 내 도움이 필요한 학생을 지원하기 위해 학교 구성원 간 협력의 중요성 문항에 총 응답자는 3,178명이며 매우 그렇다고 답변한 응답자는 2,253명(70.9%), 그렇다고 답변한 응답 821명(25.8%), 보통이다라고 답변한 응답은 85명(2.7%), 그렇지 않다고 답변한 응답은 12명(0.4%), 매우 그렇지 않다고 답변한 응답자는 7명(0.2%)로 나타났음

```{r}
#| echo: false
#| warning: false
#| message: false
ques28_freq <- dat %>%
  filter(!is.na(ques_28), ques_28 %in% as.character(1:5)) %>%
  count(ques_28) %>%
  mutate(
    응답 = recode(ques_28,
                 "1" = "매우 그렇다",
                 "2" = "그렇다", 
                 "3" = "보통이다",
                 "4" = "그렇지 않다",
                 "5" = "매우 그렇지 않다"),
    pct = round(n / sum(n) * 100, 1)
  ) %>%
  arrange(desc(n)) %>%
  bind_rows(summarise(., 응답 = "합계", n = sum(n), pct = sum(pct)))

print(ques28_freq %>% select(응답, n, pct), n = Inf)
```

```{r}
#| echo: false
#| warning: false
#| message: false
ggplot(ques28_freq %>% filter(응답 != "합계"), aes(x = reorder(응답, -n), y = n, fill = 응답)) +
  geom_bar(stat = "identity", width = 0.5) +
  geom_text(aes(label = paste0(n, "명 (", pct, "%)")), 
            vjust = -0.5, size = 7) +
  labs(
    title = "학교 구성원 간 협력중요성 인식",
    x = "협력중요성 인식",
    y = "응답수"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    plot.title = element_text(size = 32, face = "bold", hjust = 0.5),
    legend.position = "none",
    axis.text.x = element_text(angle=0, hjust=0.5, size=20, lineheight=0.6),
    axis.text.y = element_text(size=20),
    axis.title.x = element_text(size=20, margin = margin(t = 18)),
    axis.title.y = element_text(angle = 0, vjust = 0.5, size=20),
    strip.text = element_text(face="bold", size=23, margin = margin(t = 6, b = 6)),
    panel.spacing = unit(1.5, "lines"), plot.margin = margin(20, 20, 20, 20)
  ) +
  ylim(0, max(ques28_freq$n) * 1.15)
```

분석과정

1\) 응답자 유형 분류: 직책별(학교장, 교감, 교사 등), 학교급별(초등학교, 중학교, 고등학교), 설립별(공립, 사립)으로 구분하였음. 유형별 비교를 위해 응답자 수가 적은 특수학교, 각종학교 및 공립학교는 조사대상자에서 제외하였음. 이와 같이 응답자 유형을 분류하고 응답자 집단 간의 답변 분포를 비교하였음.

2\) 응답점수 산출방법: ‘매우 그렇다’는 5점을 부여하고 ‘그렇다’는 4점, ‘보통이다’는 3점, ‘그렇지 않다’는 2점, ‘매우 그렇지 않다’는 1점을 부여하여 인식도 점수를 산출하였음.

### 문항 28-1. 직책별 협력중요성 분석

직책별 응답자는 총 3,090명이고 이 중에서 학교장은 474명(15.34%), 교감은 761명(24.63%), 교사 등은 1,855명(60.03%)이었음

학교장 응답 중에서 매우 그렇다는 390명(82.3%), 그렇다는 82명(17.3%), 보통이다는 2명(0.4%)이었음.

교감 응답 중에서 매우 그렇다는 592명(77.8%), 그렇다는 153명(20.1%), 보통이다는 13명(1.7%), 그렇지 않다는 3명(0.4%)이었음

교사 등 응답 중에서 매우 그렇다는 1,210명(65.2%), 그렇다는 562명(30.3%), 보통이다는 67명(3.6%), 그렇지 않다는 9명(0.5%), 매우 그렇지 않다는 7명(0.4%)이었음

```{r}
#| echo: false
#| warning: false
#| message: false
## 2. 직책별 분석

dat_filtered <- dat_filtered %>%
  mutate(협력중요성 = factor(as.character(ques_28),
                   levels = c("1","2","3","4","5"),
                   labels = c("매우 그렇다","그렇다","보통이다","그렇지 않다","매우 그렇지 않다"))
  )

# 직책별 교차표
summary_table_28 <- dat_filtered %>%
  group_by(직책, 협력중요성) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  mutate(pct = round(n / sum(n) * 100, 1)) %>%
  ungroup()

summary_with_total_28 <- summary_table_28 %>%
  group_by(직책) %>%
  summarise(n = sum(n), pct = sum(pct), 협력중요성 = "합계") %>%
  bind_rows(summary_table_28) %>%
  arrange(
    factor(직책, levels = c("학교장","교감","교사 등")),
    협력중요성 == "합계",
    if_else(협력중요성 != "합계", -n, 0)
  )

summary_final_28 <- summary_with_total_28 %>%
  bind_rows(
    summary_with_total_28 %>%
      summarise(직책 = "전체 합계", n = sum(n[협력중요성 == "합계"]), pct = 100, 협력중요성 = "합계")
  )

print(summary_final_28, n = Inf)

# 카이제곱 검정
tab1_28 <- table(dat_filtered$직책, dat_filtered$협력중요성)
chisq_test1_28 <- chisq.test(tab1_28)
print(chisq_test1_28)
```

```{r}
#| echo: false
#| warning: false
#| message: false
# 누적막대그래프
summary_job_28 <- dat_filtered %>%
  group_by(직책, 협력중요성) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  mutate(pct = round(n / sum(n) * 100, 1)) %>%
  ungroup() %>%
  mutate(협력중요성 = factor(협력중요성, 
                        levels = c("매우 그렇다", "그렇다", "보통이다", 
                                 "그렇지 않다", "매우 그렇지 않다")))

p0_28 <- ggplot(summary_job_28, aes(x = factor(직책, levels = c("학교장", "교감", "교사 등")), 
                                    y = pct, fill = 협력중요성)) +
  geom_bar(stat = "identity", width = 0.7) +
  labs(
    title = "직책별 협력중요성 인식",
    x = "직책",
    y = "비율",
    fill = "협력중요성"
  ) +
  scale_y_continuous(limits = c(0, 100), expand = expansion(mult = c(0, 0.02))) +
  theme_minimal(base_size = 15) +
  theme(
    plot.title = element_text(face = "bold", size = 32, hjust = 0.5),
    axis.text.x = element_text(size = 20, face = "bold"),
    axis.text.y = element_text(size = 18),
    axis.title.x = element_text(size = 25, angle = 0, margin = margin(t = 15)),
    axis.title.y = element_text(size = 20, angle = 0, vjust = 0.5),
    legend.position = "right",
    legend.text = element_text(size = 14),
    legend.title = element_text(size = 16, face = "bold")
  )
print(p0_28)
```

학교구성원 간 협력 중요성 인식에 대한 직책별 평균점수를 비교한 결과, 학교장(4.82), 교감(4.75), 교사 등(4.6)으로 학교장-교사 등, 교감-교사 등 간에는 학교구성원 간 협력중요성에 대한 인식차이가 있는 것으로 나타났으며, 학교장과 교감 간에는 유의미한 인식치아가 있지는 않았음

```{r}
#| echo: false
#| warning: false
#| message: false
# ANOVA 분석
dat_score_28 <- dat_filtered %>%
  filter(!is.na(ques_28)) %>%
  mutate(
    협력중요성점수 = case_when(
      ques_28 == 1 ~ 5,   # 매우 그렇다
      ques_28 == 2 ~ 4,   # 그렇다
      ques_28 == 3 ~ 3,   # 보통이다
      ques_28 == 4 ~ 2,   # 그렇지 않다
      ques_28 == 5 ~ 1,   # 매우 그렇지 않다
      TRUE ~ NA_real_
    ),
    직책 = factor(직책, levels = c("학교장", "교감", "교사 등"))
  )

job_summary_28 <- dat_score_28 %>%
  group_by(직책) %>%
  summarise(
    평균 = round(mean(협력중요성점수, na.rm = TRUE), 2),
    표준편차 = round(sd(협력중요성점수, na.rm = TRUE), 2),
    n = n(),
    .groups = "drop"
  )
print(job_summary_28)

anova_job_28 <- aov(협력중요성점수 ~ 직책, data = dat_score_28)
summary(anova_job_28)

tukey_job_28 <- TukeyHSD(anova_job_28)
print(tukey_job_28)
```

```{r}
#| echo: false
#| warning: false
#| message: false
# 박스플롯
tukey_letters_job_28 <- multcompView::multcompLetters4(anova_job_28, tukey_job_28)
letters_df_job_28 <- data.frame(
  직책 = names(tukey_letters_job_28$`직책`$Letters),
  group = tukey_letters_job_28$`직책`$Letters
)

job_summary_with_groups_28 <- job_summary_28 %>%
  left_join(letters_df_job_28, by = "직책")

ggplot(dat_score_28, aes(x = factor(직책, levels = c("학교장", "교감", "교사 등")), y = 협력중요성점수, fill = 직책)) +
  geom_boxplot(alpha = 0.7, width = 0.6, outlier.shape = 21) +
  stat_summary(fun = mean, geom = "point", shape = 23, size = 10, fill = "yellow", stroke = 1) +
  geom_text(data = job_summary_with_groups_28, 
            aes(x = 직책, y = 8, label = paste0(group, "\n(M=", 평균, ")")),
            inherit.aes = FALSE, fontface = "bold", size = 8, vjust = 0.2, lineheight=0.5) +
  labs(
    title = "직책별 협력중요성 인식",
    x = "직책", 
    y = "협력중요성\n인식도"
  ) +
  theme_minimal(base_size = 15) +
  theme(
    plot.title = element_text(face = "bold", size = 32, hjust = 0.5),
    axis.text.x = element_text(size = 18),
    axis.text.y = element_text(size = 18, lineheight = 0.4),
    axis.title.x = element_text(size = 20, margin = margin(t = 15)),
    axis.title.y = element_text(size = 20, angle = 0, vjust = 0.5, lineheight=0.5),
    legend.position = "none"
  ) +
  scale_y_continuous(expand = expansion(mult = c(0.05, 0.15)))
```

### 문항 28-2. 학교급별 협력중요성 분석

학교급별 응답자는 총 3,090명이며, 초등학교 응답자는 1,277명(41.33%), 중학교 응답자는 1,100명(35.60%), 고등학교 응답자는 713명(23.07%)이 응답하였음.

초등학교 응답 중에서 매우 그렇다는 940명(73.6%), 그렇다는 289명(22.6%), 보통이다는 39명(3.1%), 그렇지 않다는 6명(0.5%), 매우 그렇지 않다는 3명(0.2%)이었음

중학교 응답건수 중에서 매우 그렇다는 821명(74.6%), 그렇다는 257명(23.4%), 보통이다는 17명(1.5%), 그렇지 않다는 4명(0.4%), 매우 그렇지 않다는 1명(0.1%)이었음

고등학교 응답건수 중에서 매우 그렇다는 431명(60.5%), 그렇다는 251명(35.2%), 보통이다는 26명(3.6%), 그렇지 않다는 3명(0.4%), 매우 그렇지 않다는 2명(0.3%)이었음

```{r}
#| echo: false
#| warning: false
#| message: false
summary_school_table_28 <- dat_filtered %>%
  group_by(학교급, 협력중요성) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  mutate(pct = round(n / sum(n) * 100, 2)) %>%
  ungroup()

summary_school_with_total_28 <- summary_school_table_28 %>%
  group_by(학교급) %>%
  summarise(n = sum(n), pct = sum(pct), 협력중요성 = "합계") %>%
  bind_rows(summary_school_table_28) %>%
  arrange(
    factor(학교급, levels = c("초등학교","중학교","고등학교")),
    협력중요성 == "합계",
    if_else(협력중요성 != "합계", -n, 0)
  )

summary_school_final_28 <- summary_school_with_total_28 %>%
  bind_rows(
    summary_school_with_total_28 %>%
      summarise(학교급 = "전체 합계", n = sum(n[협력중요성 == "합계"]), pct = 100, 협력중요성 = "합계")
  )

print(summary_school_final_28, n = Inf)

# 카이제곱 검정
tab_school_28 <- table(dat_filtered$학교급, dat_filtered$협력중요성)
chisq_test_school_28 <- chisq.test(tab_school_28)
print(chisq_test_school_28)
```

```{r}
#| echo: false
#| warning: false
#| message: false
# 학교급별 교차표
school_summary_28 <- dat_score_28 %>%
  group_by(학교급) %>%
  summarise(
    평균 = round(mean(협력중요성점수, na.rm = TRUE), 2),
    표준편차 = round(sd(협력중요성점수, na.rm = TRUE), 2),
    n = n(),
    .groups = "drop"
  )

summary_school_28 <- dat_filtered %>%
  group_by(학교급, 협력중요성) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  mutate(pct = round(n / sum(n) * 100, 1)) %>%
  ungroup()

# 누적막대그래프 (수정된 코드)
summary_school_plot_28 <- summary_school_28 %>%  # ← 여기가 중요!
  mutate(협력중요성 = factor(협력중요성, 
                        levels = c("매우 그렇다", "그렇다", "보통이다", 
                                 "그렇지 않다", "매우 그렇지 않다")))

ggplot(summary_school_plot_28, aes(x = factor(학교급, levels = c("초등학교", "중학교", "고등학교")), y = pct, fill = 협력중요성)) +
  geom_bar(stat = "identity", width = 0.7) +
  labs(
    title = "학교급별 협력중요성 인식",
    x = "학교급",
    y = "비율",
    fill = "협력중요성"
  ) +
  scale_y_continuous(limits = c(0, 100), expand = expansion(mult = c(0, 0.02))) +
  theme_minimal(base_size = 15) +
  theme(
    plot.title = element_text(size = 32, face = "bold", hjust = 0.5),
    axis.text.x = element_text(size = 18, margin = margin(t = 10)),
    axis.text.y = element_text(size = 18),
    axis.title.x = element_text(size = 20, angle = 0, margin = margin(t = 15)),
    axis.title.y = element_text(size = 20, angle = 0, vjust = 0.5),
    legend.position = "right",
    legend.text = element_text(size = 14),
    legend.title = element_text(size = 16, face = "bold")
  )
```

학교구성원 간 협력 중요성 인식에 대한 학교급별 평균점수를 비교한 결과, 초등학교(4.69), 중학교(4.72), 고등학교(4.55)으로 초등학교-고등학교, 중학교-고등학교 간에는 학교구성원 간 협력중요성에 대한 인식 차이가 있는 것으로 나타났으며, 초등학교-중학교 간에는 유의미한 인식차이가 있지는 않았음

```{r}
#| echo: false
#| warning: false
#| message: false
print(school_summary_28)

anova_school_28 <- aov(협력중요성점수 ~ 학교급, data = dat_score_28)
summary(anova_school_28)

tukey_school_28 <- TukeyHSD(anova_school_28)
print(tukey_school_28)
```

```{r}
#| echo: false
#| warning: false
#| message: false
# 박스플롯
tukey_letters_school_28 <- multcompView::multcompLetters4(anova_school_28, tukey_school_28)
letters_df_school_28 <- data.frame(
  학교급 = names(tukey_letters_school_28$`학교급`$Letters),
  group = tukey_letters_school_28$`학교급`$Letters
)

school_summary_with_groups_28 <- school_summary_28 %>%
  left_join(letters_df_school_28, by = "학교급")

ggplot(dat_score_28, aes(x = factor(학교급, levels = c("초등학교", "중학교", "고등학교")), y = 협력중요성점수, fill = 학교급)) +
  geom_boxplot(alpha = 0.7, width = 0.6, outlier.shape = 21) +
  stat_summary(fun = mean, geom = "point", shape = 23, size = 10, fill = "yellow", stroke = 1) +
  geom_text(data = school_summary_with_groups_28, 
            aes(x = 학교급, y = 8, label = paste0(group, "\n(M=", 평균, ")")),
            inherit.aes = FALSE, fontface = "bold", size = 8, vjust = 0, lineheight=0.5) +
  labs(
    title = "학교급별 협력중요성 인식",
    x = "학교급", 
    y = "협력중요성\n인식도"
  ) +
  theme_minimal(base_size = 15) +
  theme(
    plot.title = element_text(face = "bold", size = 32, hjust = 0.5, lineheight = 0.7),
    axis.text.x = element_text(size = 20),
    axis.text.y = element_text(size = 20),
    axis.title.x = element_text(size = 20, margin = margin(t = 15)),
    axis.title.y = element_text(size = 20, angle = 0, vjust = 0.5, lineheight = 0.5),
    legend.position = "none"
  ) +
  scale_y_continuous(expand = expansion(mult = c(0.05, 0.15)))
```

### 문항 28-3. 설립별 협력중요성 분석

설립별 응답자는 3,090건이고 공립학교 응답건수는 2,317명(74.5%), 사립학교 응답건수는 761명(25.5%)이 응답하였음.

공립학교 응답건수 중에서 매우 그렇다는 1,660명(71.6%), 그렇다는 582명(25.1%), 보통이다는 63명(2.72%), 그렇지 않다는 8명(0.35%), 매우 그렇지 않다는 4명(0.17%)이었음

사립학교 응답건수 중에서 매우 그렇다는 532명(68.8%), 그렇다는 215명(27.8%), 보통이다는 19명(2.46%), 그렇지 않다는 4명(0.52%), 매우 그렇지 않다는 3명(0.39%)이었음

```{r}
#| echo: false
#| warning: false
#| message: false
# 4. 설립별 분석


# 설립별 기술통계 (합계 포함)
summary_found_table_28 <- dat_filtered %>%
  group_by(설립, 협력중요성) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  mutate(pct = round(n / sum(n) * 100, 2)) %>%
  ungroup()

summary_found_with_total_28 <- summary_found_table_28 %>%
  group_by(설립) %>%
  summarise(n = sum(n), pct = sum(pct), 협력중요성 = "합계") %>%
  bind_rows(summary_found_table_28) %>%
  arrange(설립, 협력중요성 == "합계", desc(n))

summary_found_final_28 <- summary_found_with_total_28 %>%
  bind_rows(
    summary_found_with_total_28 %>%
      summarise(설립 = "전체 합계", n = sum(n[협력중요성 == "합계"]), pct = 100, 협력중요성 = "합계")
  )

print(summary_found_final_28, n = Inf)


# 카이제곱 검정
tab_found_28 <- table(dat_filtered$설립, dat_filtered$협력중요성)
print(tab_found_28)
chisq_test_found_28 <- chisq.test(tab_found_28)
print(chisq_test_found_28)
```

```{r}
#| echo: false
#| warning: false
#| message: false
# 누적막대그래프
summary_found_plot_28 <- summary_found_table_28 %>%
  mutate(협력중요성 = factor(협력중요성, 
                        levels = c("매우 그렇다", "그렇다", "보통이다", 
                                 "그렇지 않다", "매우 그렇지 않다")))

ggplot(summary_found_plot_28, aes(x = 설립, y = pct, fill = 협력중요성)) +
  geom_bar(stat = "identity", width = 0.7) +
  labs(
    title = "설립별 협력중요성 인식",
    x = "설립",
    y = "비율",
    fill = "협력중요성"
  ) +
  scale_y_continuous(limits = c(0, 100), expand = expansion(mult = c(0, 0.02))) +
  theme_minimal(base_size = 15) +
  theme(
    plot.title = element_text(size = 32, face = "bold", hjust = 0.5),
    axis.text.x = element_text(size = 18, margin = margin(t = 10)),
    axis.text.y = element_text(size = 18),
    axis.title.x = element_text(size = 20, angle = 0, margin = margin(t = 15)),
    axis.title.y = element_text(size = 20, angle = 0, vjust = 0.5),
    legend.position = "right",
    legend.text = element_text(size = 14),
    legend.title = element_text(size = 16, face = "bold")
  )
```

학교구성원 간 협력 중요성 인식에 대한 설립별 평균점수를 비교한 결과, 공립학교(4.68), 사립학교(4.64)에서 학교구성원 간 협력중요성에 대해 유의미한 차이가 있지는 않았음

```{r}
#| echo: false
#| warning: false
#| message: false
# T-test 분석
dat_score_found_28 <- dat_filtered %>%
  mutate(
    협력중요성점수 = case_when(
      ques_28 == 1 ~ 5,   # 매우 그렇다
      ques_28 == 2 ~ 4,   # 그렇다
      ques_28 == 3 ~ 3,   # 보통이다
      ques_28 == 4 ~ 2,   # 그렇지 않다
      ques_28 == 5 ~ 1,   # 매우 그렇지 않다
      TRUE ~ NA_real_
    )
  )

summary_found_stats_28 <- dat_score_found_28 %>%
  group_by(설립) %>%
  summarise(
    평균 = round(mean(협력중요성점수, na.rm = TRUE), 2),
    표준편차 = round(sd(협력중요성점수, na.rm = TRUE), 2),
    n = n(),
    .groups = "drop"
  )

print(summary_found_stats_28)

# T-test
t_test_result_28 <- t.test(협력중요성점수 ~ 설립, data = dat_score_found_28, var.equal = FALSE)
print(t_test_result_28)
```

```{r}
#| echo: false
#| warning: false
#| message: false
# T-test
t_test_result_28 <- t.test(협력중요성점수 ~ 설립, data = dat_score_found_28, var.equal = FALSE)
print(t_test_result_28)

# 박스플롯
if(t_test_result_28$p.value < 0.05) {
  establishment_groups_28 <- data.frame(
    설립 = c("공립", "사립"),
    group = c("a", "b")
  )
} else {
  establishment_groups_28 <- data.frame(
    설립 = c("공립", "사립"),
    group = c("a", "a")
  )
}

summary_found_with_groups_28 <- summary_found_stats_28 %>%
  left_join(establishment_groups_28, by = "설립")

ggplot(dat_score_found_28, aes(x = 설립, y = 협력중요성점수, fill = 설립)) +
  geom_boxplot(alpha = 0.7, width = 0.6, outlier.shape = 21) +
  stat_summary(fun = mean, geom = "point", shape = 23, size = 10, fill = "yellow", stroke = 1) +
  geom_text(data = summary_found_with_groups_28, 
            aes(x = 설립, y = 8, label = paste0(group, "\n(M=", 평균, ")")),
            inherit.aes = FALSE, fontface = "bold", size = 8, vjust = 0, lineheight=0.5) +
  labs(
    title = "설립별 협력중요성 인식",
    x = "설립", 
    y = "협력중요성\n인식도"
  ) +
  theme_minimal(base_size = 15) +
  theme(
    plot.title = element_text(face = "bold", size = 32, hjust = 0.5),
    axis.text.x = element_text(size = 20),
    axis.text.y = element_text(size = 20),
    axis.title.x = element_text(size = 20, margin = margin(t = 15)),
    axis.title.y = element_text(size = 20, angle = 0, vjust = 0.5, lineheight = 0.4),
    legend.position = "none"
  ) +
  scale_y_continuous(expand = expansion(mult = c(0.05, 0.15)))
```

### 문항29. 학교 내에서 학생 지원을 위해서 교육구성원 간 협력이 원활히 이루어지고 있습니까?

① 매우 그렇다 ② 그렇다 ③ 보통이다 ④ 그렇지 않다 ⑤ 매우 그렇지 않다

학교 내에서 학생 지원을 위해서 교육구성원 간 협력이 원활한지에 대한 문항의 총 응답자는 3,178명이며 매우 그렇다고 답변한 응답자는 1,252명(43.1%), 그렇다고 답변한 응답자는 1,371명(39.4%), 보통이다라고 답변한 응답자는 464명(14.6%), 그렇지 않다고 답변한 응답자는 74명(2.33%), 매우 그렇지 않다고 답변한 응답자는 17명(0.53%)으로 나타났음

```{r}
#| echo: false
#| warning: false
#| message: false
ques29_freq <- dat %>%
  filter(!is.na(ques_29), ques_29 %in% as.character(1:5)) %>%
  count(ques_29) %>%
  mutate(
    응답 = recode(ques_29,
                 "1" = "매우 그렇다",
                 "2" = "그렇다", 
                 "3" = "보통이다",
                 "4" = "그렇지 않다",
                 "5" = "매우 그렇지 않다"),
    pct = round(n / sum(n) * 100, 2)
  ) %>%
  bind_rows(summarise(., 응답 = "합계", n = sum(n), pct = sum(pct)))

print(ques29_freq %>% select(응답, n, pct), n = Inf)
```

```{r}
#| echo: false
#| warning: false
#| message: false
ggplot(ques29_freq %>% filter(응답 != "합계"), aes(x = reorder(응답, -n), y = n, fill = 응답)) +
  geom_bar(stat = "identity", width = 0.5) +
  geom_text(aes(label = paste0(n, "명 (", pct, "%)")), 
            vjust = -0.3, size = 7) +
  labs(
    title = "교육구성원 간\n 협력 원활성",
    x = "협력 원활성",
    y = "응답수"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    plot.title = element_text(size = 32, face = "bold", hjust = 0.5, lineheight = 0.5),
    axis.text.x = element_text(size = 20, face = "bold"),
    axis.text.y = element_text(size = 20),
    axis.title.x = element_text(size = 20, angle = 0, margin = margin(t = 15)),
    axis.title.y = element_text(size = 20, angle = 0, vjust = 0.5),
    legend.text = element_text(size = 14),
    legend.title = element_text(size = 16, face = "bold"),
    legend.position = "none",
    panel.spacing = unit(1.5, "lines"), plot.margin = margin(20, 20, 20, 20)
  ) +
  ylim(0, max(ques29_freq$n) * 1.15)
```

분석과정

1\) 응답자 유형 분류: 직책별(학교장, 교감, 교사 등), 학교급별(초등학교, 중학교, 고등학교), 설립별(공립, 사립)으로 구분하였음. 유형별 비교를 위해 응답자 수가 적은 특수학교, 각종학교 및 공립학교는 조사대상자에서 제외하였음. 이와 같이 응답자 유형을 분류하고 응답자 집단 간의 답변 분포를 비교하였음

2\) 응답점수 산출방법: ‘매우 그렇다’는 5점을 부여하고 ‘그렇다’는 4점, ‘보통이다’는 3점, ‘그렇지 않다’는 2점, ‘매우 그렇지 않다’는 1점을 부여하여 인식도 점수를 산출하였음

### 문항 29-1. 직책별 협력원활성 분석

직책별 응답자는 총 3,090명이고 이 중에서 학교장은 474명(15.34%), 교감은 761명(24.63%), 교사 등은 1,855명(60.03%)이었음

학교장 응답건수 중에서 매우 그렇다는 222건(46.8%), 그렇다는 198건(41.8%), 보통이다는 51건(10.8%), 그렇지 않다는 3건(0.6%)이었음.

교감 응답건수 중에서 매우 그렇다는 295건(38.8%), 그렇다는 359건(47.2%), 보통이다는 87건(11.4%), 그렇지 않다는 18건(2.4%), 매우 그렇지 않다는 2건(0.3%)이었음

교사 등 응답건수 중에서 매우 그렇다는 698건(37.63%), 그렇다는 783건(42.21%), 보통이다는 312건(16.82%), 그렇지 않다는 47건(2.53%), 매우 그렇지 않다는 15건(0.81%)이었음

```{r}
#| echo: false
#| warning: false
#| message: false
dat_filtered_29 <- dat_filtered %>%
  mutate(
    협력원활성 = factor(as.character(ques_29),
                   levels = c("1","2","3","4","5"),
                   labels = c("매우 그렇다","그렇다","보통이다","그렇지 않다","매우 그렇지 않다"))
  )

# 직책별 기술통계 (합계 포함)
summary_table_29 <- dat_filtered_29 %>%
  group_by(직책, 협력원활성) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  mutate(pct = round(n / sum(n) * 100, 2)) %>%
  ungroup()

summary_with_total_29 <- summary_table_29 %>%
  group_by(직책) %>%
  summarise(n = sum(n), pct = sum(pct), 협력원활성 = "합계") %>%
  bind_rows(summary_table_29) %>%
  arrange(
    factor(직책, levels = c("학교장","교감","교사 등")),
    협력원활성 == "합계",
    if_else(협력원활성 != "합계", -n, 0)
  )

summary_final_29 <- summary_with_total_29 %>%
  bind_rows(
    summary_with_total_29 %>%
      summarise(직책 = "전체 합계", n = sum(n[협력원활성 == "합계"]), pct = 100, 협력원활성 = "합계")
  )

print(summary_final_29, n = Inf)

# 카이제곱 검정
tab1_29 <- table(dat_filtered_29$직책, dat_filtered_29$협력원활성)
chisq_test1_29 <- chisq.test(tab1_29)
print(chisq_test1_29)
```

```{r}
#| echo: false
#| warning: false
#| message: false
# 누적막대그래프
summary_job_29 <- dat_filtered_29 %>%
  group_by(직책, 협력원활성) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  mutate(pct = round(n / sum(n) * 100, 1)) %>%
  ungroup() %>%
  mutate(협력원활성 = factor(협력원활성, 
                        levels = c("매우 그렇다", "그렇다", "보통이다", 
                                 "그렇지 않다", "매우 그렇지 않다")))

p0_29 <- ggplot(summary_job_29, aes(x = factor(직책, levels = c("학교장", "교감", "교사 등")), 
                                    y = pct, fill = 협력원활성)) +
  geom_bar(stat = "identity", width = 0.7) +
  labs(
    title = "직책별 협력원활성 인식",
    x = "직책",
    y = "비율",
    fill = "협력원활성"
  ) +
  scale_y_continuous(limits = c(0, 100), expand = expansion(mult = c(0, 0.02))) +
  theme_minimal(base_size = 15) +
  theme(
    plot.title = element_text(face = "bold", size = 32, hjust = 0.5),
    axis.text.x = element_text(size = 20, face = "bold"),
    axis.text.y = element_text(size = 18),
    axis.title.x = element_text(size = 25, angle = 0, margin = margin(t = 15)),
    axis.title.y = element_text(size = 20, angle = 0, vjust = 0.5),
    legend.position = "right",
    legend.text = element_text(size = 14),
    legend.title = element_text(size = 16, face = "bold")
  )
print(p0_29)
```

학교 내에서 학생 지원을 위해서 교육구성원 간 협력이 원활한지에 대한 직책별 인식도 평균점수를 비교한 결과, 학교장(4.35), 교감(4.22), 교사 등(4.13)으로 학교장-교감, 학교장-교사 등, 교감-교사 등 간에는 협력 원활성에 대한 인식도에 유의미한 차이가 있는 것으로 나타났음

```{r}
#| echo: false
#| warning: false
#| message: false
# ANOVA 분석
dat_score_29 <- dat_filtered_29 %>%
  filter(!is.na(ques_29)) %>%
  mutate(
    협력원활성점수 = case_when(
      ques_29 == 1 ~ 5,   # 매우 그렇다
      ques_29 == 2 ~ 4,   # 그렇다
      ques_29 == 3 ~ 3,   # 보통이다
      ques_29 == 4 ~ 2,   # 그렇지 않다
      ques_29 == 5 ~ 1,   # 매우 그렇지 않다
      TRUE ~ NA_real_
    ),
    직책 = factor(직책, levels = c("학교장", "교감", "교사 등"))
  )

job_summary_29 <- dat_score_29 %>%
  group_by(직책) %>%
  summarise(
    평균 = round(mean(협력원활성점수, na.rm = TRUE), 2),
    표준편차 = round(sd(협력원활성점수, na.rm = TRUE), 2),
    n = n(),
    .groups = "drop"
  ) %>%
  arrange(직책)

print(job_summary_29)

anova_job_29 <- aov(협력원활성점수 ~ 직책, data = dat_score_29)
summary(anova_job_29)

tukey_job_29 <- TukeyHSD(anova_job_29)
print(tukey_job_29)
```

```{r}
#| echo: false
#| warning: false
#| message: false
# 박스플롯
tukey_letters_job_29 <- multcompView::multcompLetters4(anova_job_29, tukey_job_29)
letters_df_job_29 <- data.frame(
  직책 = names(tukey_letters_job_29$`직책`$Letters),
  group = tukey_letters_job_29$`직책`$Letters
)

job_summary_with_groups_29 <- job_summary_29 %>%
  left_join(letters_df_job_29, by = "직책")

ggplot(dat_score_29, aes(x = factor(직책, levels = c("학교장", "교감", "교사 등")), y = 협력원활성점수, fill = 직책)) +
  geom_boxplot(alpha = 0.7, width = 0.6, outlier.shape = 21) +
  stat_summary(fun = mean, geom = "point", shape = 23, size = 10, fill = "yellow", stroke = 1) +
  geom_text(data = job_summary_with_groups_29, 
            aes(x = 직책, y = 8, label = paste0(group, "\n(M=", 평균, ")")),
            inherit.aes = FALSE, fontface = "bold", size = 8, vjust = 0.3, lineheight=0.5) +
  labs(
    title = "직책별 협력원활성 인식",
    x = "직책", 
    y = "협력원활성\n인식도"
  ) +
  theme_minimal(base_size = 15) +
  theme(
    plot.title = element_text(face = "bold", size = 32, hjust = 0.5),
    axis.text.x = element_text(size = 20),
    axis.text.y = element_text(size = 20),
    axis.title.x = element_text(size = 20, margin = margin(t = 15)),
    axis.title.y = element_text(size = 20, angle = 0, vjust = 0.5),
    legend.position = "none"
  ) +
  scale_y_continuous(expand = expansion(mult = c(0.025, 0.10)))
```

### 문항 29-2. 학교급별 협력원활성 분석

학교급별 응답자는 총 3,090명이며, 초등학교 응답자는 1,277명(41.33%), 중학교 응답자는 1,100명(35.60%), 고등학교 응답자는 713명(23.07%)이 응답하였음

초등학교 응답 중에서 매우 그렇다는 609명(47.7%), 그렇다는 499명(39.1%), 보통이다는 142명(11.1%), 그렇지 않다는 19명(1.5%), 매우 그렇지 않다는 8명(0.6%)이었음

중학교 응답 중에서 매우 그렇다는 429명(39%), 그렇다는 499명(45.4%), 보통이다는 142명(12.9%), 그렇지 않다는 25명(2.3%), 매우 그렇지 않다는 5명(0.5%)이었음

고등학교 응답 중에서 매우 그렇다는 177명(24.8%), 그렇다는 342명(48%), 보통이다는 166명(23.3%), 그렇지 않다는 24명(3.4%), 매우 그렇지 않다는 4명(0.6%)이었음

```{r}
#| echo: false
#| warning: false
#| message: false
# 학교급별 기술통계 (합계 포함)
summary_school_table_29 <- dat_filtered_29 %>%
  group_by(학교급, 협력원활성) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  mutate(pct = round(n / sum(n) * 100, 1)) %>%
  ungroup()

summary_school_with_total_29 <- summary_school_table_29 %>%
  group_by(학교급) %>%
  summarise(n = sum(n), pct = sum(pct), 협력원활성 = "합계") %>%
  bind_rows(summary_school_table_29) %>%
  arrange(
    factor(학교급, levels = c("초등학교","중학교","고등학교")),
    협력원활성 == "합계",
    if_else(협력원활성 != "합계", -n, 0)
  )

summary_school_final_29 <- summary_school_with_total_29 %>%
  bind_rows(
    summary_school_with_total_29 %>%
      summarise(학교급 = "전체 합계", n = sum(n[협력원활성 == "합계"]), pct = 100, 협력원활성 = "합계")
  )

print(summary_school_final_29, n = Inf)

# 카이제곱 검정
tab_school_29 <- table(dat_filtered_29$학교급, dat_filtered_29$협력원활성)
chisq_test_school_29 <- chisq.test(tab_school_29)
print(chisq_test_school_29)
```

```{r}
#| echo: false
#| warning: false
#| message: false
# 누적막대그래프
summary_school_plot_29 <- summary_school_table_29 %>%
  mutate(협력원활성 = factor(협력원활성, 
                        levels = c("매우 그렇다", "그렇다", "보통이다", 
                                 "그렇지 않다", "매우 그렇지 않다")))

ggplot(summary_school_plot_29, aes(x = factor(학교급, levels = c("초등학교", "중학교", "고등학교")), y = pct, fill = 협력원활성)) +
  geom_bar(stat = "identity", width = 0.7) +
  labs(
    title = "학교급별 협력원활성 인식",
    x = "학교급",
    y = "비율",
    fill = "협력원활성"
  ) +
  scale_y_continuous(limits = c(0, 100), expand = expansion(mult = c(0, 0.02))) +
  theme_minimal(base_size = 15) +
  theme(
    plot.title = element_text(size = 32, face = "bold", hjust = 0.5),
    axis.text.x = element_text(size = 18, margin = margin(t = 10)),
    axis.text.y = element_text(size = 18),
    axis.title.x = element_text(size = 20, angle = 0, margin = margin(t = 15)),
    axis.title.y = element_text(size = 20, angle = 0, vjust = 0.5),
    legend.position = "right",
    legend.text = element_text(size = 14),
    legend.title = element_text(size = 16, face = "bold")
  )
```

학교 내에서 학생 지원을 위해서 교육구성원 간 협력이 원활한지에 대한 학교급별 인식도 평균점수를 비교한 결과, 초등학교(4.32), 중학교(4.2), 고등학교(3.93)으로 초등학교-고등학교, 중학교-고등학교, 중학교-고등학교 간에는 협력의 원활성에 대한 인식도에 유의미한 차이가 있는 것으로 나타났음(초등학교 \> 중학교 \> 고등학교)

```{r}
#| echo: false
#| warning: false
#| message: false
# 학교급별 ANOVA
school_summary_29 <- dat_score_29 %>%
  mutate(학교급 = factor(학교급, levels = c("초등학교", "중학교", "고등학교"))) %>%
  group_by(학교급) %>%
  summarise(
    평균 = round(mean(협력원활성점수, na.rm = TRUE), 2),
    표준편차 = round(sd(협력원활성점수, na.rm = TRUE), 2),
    n = n(),
    .groups = "drop"
  ) %>%
  arrange(학교급)

print(school_summary_29)

anova_school_29 <- aov(협력원활성점수 ~ 학교급, data = dat_score_29)
summary(anova_school_29)

tukey_school_29 <- TukeyHSD(anova_school_29)
print(tukey_school_29)
```

```{r}
#| echo: false
#| warning: false
#| message: false
# 박스플롯
tukey_letters_school_29 <- multcompView::multcompLetters4(anova_school_29, tukey_school_29)
letters_df_school_29 <- data.frame(
  학교급 = names(tukey_letters_school_29$`학교급`$Letters),
  group = tukey_letters_school_29$`학교급`$Letters
)

school_summary_with_groups_29 <- school_summary_29 %>%
  left_join(letters_df_school_29, by = "학교급")

ggplot(dat_score_29, aes(x = factor(학교급, levels = c("초등학교", "중학교", "고등학교")), y = 협력원활성점수, fill = 학교급)) +
  geom_boxplot(alpha = 0.7, width = 0.6, outlier.shape = 21) +
  stat_summary(fun = mean, geom = "point", shape = 23, size = 10, fill = "yellow", stroke = 1) +
  geom_text(data = school_summary_with_groups_29, 
            aes(x = 학교급, y = 8, label = paste0(group, "\n(M=", 평균, ")")),
            inherit.aes = FALSE, fontface = "bold", size = 8, vjust = 0.35, lineheight=0.5) +
  labs(
    title = "학교급별 협력원활성 인식",
    x = "학교급", 
    y = "협력원활성\n인식도"
  ) +
  theme_minimal(base_size = 15) +
  theme(
    plot.title = element_text(face = "bold", size = 32, hjust = 0.5),
    axis.text.x = element_text(size = 20),
    axis.text.y = element_text(size = 20),
    axis.title.x = element_text(size = 20, margin = margin(t = 15)),
    axis.title.y = element_text(size = 20, angle = 0, vjust = 0.5),
    legend.position = "none"
  ) +
  scale_y_continuous(expand = expansion(mult = c(0.025, 0.10)))
```

### 문항 29-3. 설립별 협력원활성 분석

설립별 응답자는 총 3,090명이며 이 중에서 공립학교 응답자는 2,317명(74.5%), 사립학교 응답자는 761명(25.5%)이 응답하였음

공립학교 응답 중에서 매우 그렇다는 991명(42.8%), 그렇다는 965명(41.6%), 보통이다는 310명(13.4%), 그렇지 않다는 41명(1.8%), 매우 그렇지 않다는 10명(0.4%)이었음

사립학교 응답 중에서 매우 그렇다는 224명(29%), 그렇다는 375명(27.8%), 보통이다는 140명(18.1%), 그렇지 않다는 27명(3.5%), 매우 그렇지 않다는 7명(0.9%)이었음

```{r}
#| echo: false
#| warning: false
#| message: false
# 설립별 데이터 준비
dat_found_29 <- dat_filtered_29 %>%
  filter(설립 %in% c("공립", "사립")) %>%
  mutate(설립 = factor(설립, levels = c("공립", "사립")))

# 설립별 기술통계 (합계 포함)
summary_found_table_29 <- dat_found_29 %>%
  group_by(설립, 협력원활성) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  mutate(pct = round(n / sum(n) * 100, 1)) %>%
  ungroup()

summary_found_with_total_29 <- summary_found_table_29 %>%
  group_by(설립) %>%
  summarise(n = sum(n), pct = sum(pct), 협력원활성 = "합계") %>%
  bind_rows(summary_found_table_29) %>%
  arrange(설립, 협력원활성 == "합계", desc(n))

summary_found_final_29 <- summary_found_with_total_29 %>%
  bind_rows(
    summary_found_with_total_29 %>%
      summarise(설립 = "전체 합계", n = sum(n[협력원활성 == "합계"]), pct = 100, 협력원활성 = "합계")
  )

print(summary_found_final_29, n = Inf)

# 카이제곱 검정
tab_found_29 <- table(dat_found_29$설립, dat_found_29$협력원활성)
print(tab_found_29)
chisq_test_found_29 <- chisq.test(tab_found_29)
print(chisq_test_found_29)
```

```{r}
#| echo: false
#| warning: false
#| message: false
# 누적막대그래프
summary_found_plot_29 <- summary_found_table_29 %>%
  mutate(협력원활성 = factor(협력원활성, 
                        levels = c("매우 그렇다", "그렇다", "보통이다", 
                                 "그렇지 않다", "매우 그렇지 않다")))

ggplot(summary_found_plot_29, aes(x = 설립, y = pct, fill = 협력원활성)) +
  geom_bar(stat = "identity", width = 0.7) +
  labs(
    title = "설립별 협력원활성 인식",
    x = "설립",
    y = "비율",
    fill = "협력원활성"
  ) +
  scale_y_continuous(limits = c(0, 100), expand = expansion(mult = c(0, 0.02))) +
  theme_minimal(base_size = 15) +
  theme(
    plot.title = element_text(size = 32, face = "bold", hjust = 0.5),
    axis.text.x = element_text(size = 20, margin = margin(t = 10)),
    axis.text.y = element_text(size = 20),
    axis.title.x = element_text(size = 20, angle = 0, margin = margin(t = 15)),
    axis.title.y = element_text(size = 20, angle = 0, vjust = 0.5),
    legend.position = "right",
    legend.text = element_text(size = 18),
    legend.title = element_text(size = 20, face = "bold")
  )
```

학생 지원을 위해서 교육구성원 간 협력이 원활한지에 대한 설립별 인식도 평균점수를 비교한 결과, 공립학교(4.25), 사립학교(4.01)에서 협력의 원활성에 대한 인식도에 유의미한 차이가 있는 것으로 나타났음

```{r}
#| echo: false
#| warning: false
#| message: false
# T-test 분석
dat_score_found_29 <- dat_found_29 %>%
  mutate(
    협력원활성점수 = case_when(
      ques_29 == 1 ~ 5,   # 매우 그렇다
      ques_29 == 2 ~ 4,   # 그렇다
      ques_29 == 3 ~ 3,   # 보통이다
      ques_29 == 4 ~ 2,   # 그렇지 않다
      ques_29 == 5 ~ 1,   # 매우 그렇지 않다
      TRUE ~ NA_real_
    )
  )

summary_found_stats_29 <- dat_score_found_29 %>%
  group_by(설립) %>%
  summarise(
    평균 = round(mean(협력원활성점수, na.rm = TRUE), 2),
    표준편차 = round(sd(협력원활성점수, na.rm = TRUE), 2),
    n = n(),
    .groups = "drop"
  )

# T-test
t_test_result_29 <- t.test(협력원활성점수 ~ 설립, data = dat_score_found_29, var.equal = FALSE)
print(t_test_result_29)
```

```{r}
#| echo: false
#| warning: false
#| message: false
# 박스플롯
if(t_test_result_29$p.value < 0.05) {
  establishment_groups_29 <- data.frame(
    설립 = c("공립", "사립"),
    group = c("a", "b")
  )
} else {
  establishment_groups_29 <- data.frame(
    설립 = c("공립", "사립"),
    group = c("a", "a")
  )
}

summary_found_with_groups_29 <- summary_found_stats_29 %>%
  left_join(establishment_groups_29, by = "설립")

ggplot(dat_score_found_29, aes(x = 설립, y = 협력원활성점수, fill = 설립)) +
  geom_boxplot(alpha = 0.7, width = 0.6, outlier.shape = 21) +
  stat_summary(fun = mean, geom = "point", shape = 23, size = 10, fill = "yellow", stroke = 1) +
  geom_text(data = summary_found_with_groups_29, 
            aes(x = 설립, y = 8, label = paste0(group, "\n(M=", 평균, ")")),
            inherit.aes = FALSE, fontface = "bold", size = 7, vjust = 0, lineheight=0.5) +
  labs(
    title = "설립별 협력원활성 인식",
    x = "설립", 
    y = "협력원활성"
  ) +
  theme_minimal(base_size = 15) +
  theme(
    plot.title = element_text(face = "bold", size = 32, hjust = 0.5),
    axis.text.x = element_text(size = 20),
    axis.text.y = element_text(size = 20),
    axis.title.x = element_text(size = 20, margin = margin(t = 15)),
    axis.title.y = element_text(size = 20, angle = 0, vjust = 0.5),
    legend.position = "none"
  ) +
  scale_y_continuous(expand = expansion(mult = c(0.05, 0.15)))
```

### 문항30. 학교 내 구성원 간 협력을 저해하는 요인은 무엇입니까? (중복응답)

① 협력에 대한 인식 부족 ② 소통부족 ③ 업무과중 ④ 업무 담당자 위주 운영방식 ⑤ 기타

학교 내 구성원 간 협력을 저해하는 요인에 대한 설문에 총 응답건수는 4,301건이고 초등학교 응답건수는 1,701건(39.5%) 중학교 응답건수는 1,495건(34.8%)이고 고등학교 응답건수는 1,010건(23.5%)이고, 특수학교 응답건수는 63건(1.5%)이고 각종학교 응답건수는 32건(0.7%)으로 나타남

초등학교 응답 중에서 업무과중이라고 답변한 응답건수는 869건(51.1%), 업무 담당자 위주 운영 방식이라고 답변한 응답건수는 335건(19.7%), 협력에 대한 인식 부족이라고 답변한 응답건수는 221건(13%), 소통부족이라고 답변한 응답건수는 166건(9.8%) 등으로 나타났음

중학교 응답 중에서 업무과중이라고 답변한 응답건수는 843건(56.4%), 업무 담당자 위주 운영 방식이라고 답변한 응답건수는 287건(19.2%), 협력에 대한 인식 부족이라고 답변한 응답건수는 170건(11.4%), 소통부족이라고 답변한 응답건수는 136건(9.1%) 등으로 나타났음

고등학교 응답 중에서 업무과중이라고 답변한 응답건수는 526건(52.1%), 업무 담당자 위주 운영 방식이라고 답변한 응답건수는 186건(18.4%), 협력에 대한 인식 부족이라고 답변한 응답건수는 151건(15%), 소통부족이라고 답변한 응답건수는 107건(10.6%) 등으로 나타났음

특수학교 응답 중에서 업무과중이라고 답변한 응답건수는 31건(49.2%), 업무 담당자 위주 운영 방식이라고 답변한 응답건수는 11건(17.5%), 협력에 대한 인식 부족이라고 답변한 응답건수는 11건(17.5%), 소통부족이라고 답변한 응답건수는 5건(7.9%) 등으로 나타났음

각종학교 응답 중에서 업무과중이라고 답변한 응답건수는 15건(46.9%), 협력에 대한 인식부족이라고 답변한 응답건수는 7건(21.9%), 소통부족이라고 답변한 응답건수는 5건(15.6%), 업무 담당자 위주 운영방식이라고 답변한 응답건수는 4건(12.5%) 등으로 나타났음

```{r}
#| echo: false
#| warning: false
#| message: false
dat_q30_long <- dat %>%
  filter(!is.na(ques_30)) %>%
  separate_rows(ques_30, sep = ",\\s*") %>%
  mutate(
    ques_30 = str_trim(as.character(ques_30)),
    문항30 = recode(ques_30,
                   "1" = "협력 인식 부족",
                   "2" = "소통부족",
                   "3" = "업무과중",
                   "4" = "담당자 위주 운영방식",
                   "5" = "기타",
                   .default = "기타"),
    학교급 = recode(as.character(ques_1),
                 "1" = "초등학교",
                 "2" = "중학교",
                 "3" = "고등학교",
                 "4" = "특수학교",
                 "5" = "각종학교")
  )

# 전체 기준으로 문항30 순서 결정
item_order <- dat_q30_long %>%
  count(문항30, sort = TRUE) %>%
  pull(문항30)

# 기술통계
summary_q30 <- dat_q30_long %>%
  mutate(
    학교급 = factor(학교급, levels = c("초등학교", "중학교", "고등학교", "특수학교", "각종학교")),
    문항30 = factor(문항30, levels = item_order)
  ) %>%
  group_by(학교급, 문항30, .drop = FALSE) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  mutate(pct = round(n / sum(n) * 100, 1)) %>%
  ungroup() %>%
  arrange(학교급, 문항30)

summary_q30_total <- summary_q30 %>%
  group_by(학교급) %>%
  summarise(n = sum(n), pct = 100, 문항30 = "합계", .groups = "drop") %>%
  bind_rows(summary_q30) %>%
  arrange(factor(학교급, 
                 levels=c("초등학교","중학교","고등학교","특수학교","각종학교")),
          if_else(문항30 == "합계", 2, 1),
          desc(n))

print(summary_q30_total, n = Inf)
```

```{r}
#| echo: false
#| warning: false
#| message: false
ggplot(
  summary_q30,  # 여기서 reorder 제거
  aes(x = 문항30, y = n, fill = 문항30)
) +
  geom_bar(stat = "identity", width = 0.7) +
  geom_text(aes(label = paste0(n,"건(",pct,"%)"), 
                y = n + max(n) * 0.05),
            vjust = 0.1, hjust = 0.5, size = 5, lineheight = 0.4) +
  facet_wrap(~학교급, ncol = 1, scales = "free_y") +
  labs(
    title = "학교구성원 간\n 협력 저해요인",
    x = "협력 저해요인",
    y = "응답수"
  ) +
  # scale_x_discrete의 labels도 순서에 맞게 조정 필요할 수 있음
  theme_minimal(base_size = 13) +
  theme(
    plot.title = element_text(face = "bold", size = 32, hjust = 0.5, lineheight = 0.6),
    legend.position = "none",
    axis.text.x = element_text(angle = 0, vjust = 0.8, lineheight = 0.4, size = 17),
    axis.text.y = element_text(size = 17),
    strip.text = element_text(face = "bold", size = 20),
    axis.title.x = element_text(size = 20, margin = margin(t = 18)),
    axis.title.y = element_text(angle = 0, vjust = 0.5, size = 20)
  ) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.15))) +
  coord_cartesian(clip = "off")  
```

# 6. 실태조사 (학생맞춤통합지원을 위한 교육지원청과 협업 현황 조사)

### 문항31. 교육지원청으로부터 학생맞춤통합지원을 위해 도움을 받은 적이 있습니까?

① 그렇다 ② 아니다

교육지원청으로부터 학생맞춤통합지원을 위해 도움을 받았는지에 대한 설문에 총 응답자는 3,178명이고 초등학교 응답자는 1,282명(40.3%) 중학교 응답자는 1,109명(35%)이고 고등학교 응답자는 718명(22.6%)이고, 특수학교 응답자는 46명(1.4%)이고 각종학교 응답자는 23명(0.7%)으로 나타남

초등학교 응답 중에서 교육지원청으로부터 도움을 받았다고 답변한 응답자는 471명(36.7%), 도움을 받지 않았다고 답변한 응답자는 811명(63.3%)으로 나타났음

중학교 응답 중에서 교육지원청으로부터 도움을 받았다고 답변한 응답자는 383명(34.5%), 도움을 받지 않았다고 답변한 응답자는 726명(65.5%)으로 나타났음

고등학교 응답 중에서 교육지원청으로부터 도움을 받았다고 답변한 응답자는 233명(32.5%), 도움을 받지 않았다고 답변한 응답자는 485명(67.5%)으로 나타났음

특수학교 응답 중에서 교육지원청으로부터 도움을 받았다고 답변한 응답자는 2명(4.3%), 도움을 받지 않았다고 답변한 응답자는 44명(95.7%)으로 나타났음

각종학교 응답 중에서 교육지원청으로부터 도움을 받았다고 답변한 응답자는 4명(17.4%), 도움을 받지 않았다고 답변한 응답자는 19명(82.6%)으로 나타났음

```{r}
#| echo: false
#| warning: false
#| message: false
dat_q31 <- dat %>%
  filter(!is.na(ques_31)) %>%
  mutate(
    문항31 = recode(as.character(ques_31),
                   "1" = "그렇다",
                   "2" = "아니다",
                   .default = "기타"),
    문항31 = factor(문항31, levels = c("그렇다", "아니다")),
    학교급 = factor(학교급, levels = c("초등학교", "중학교", "고등학교", "특수학교", "각종학교"))  # 이 줄 추가!
  )

# 기술통계
summary_q31 <- dat_q31 %>%
  group_by(학교급, 문항31) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  mutate(pct = round(n / sum(n) * 100, 1)) %>%
  ungroup()

summary_q31_total <- summary_q31 %>%
  group_by(학교급) %>%
  summarise(n = sum(n), pct = 100, 문항31 = "합계", .groups = "drop") %>%
  bind_rows(summary_q31) %>%
  arrange(factor(학교급, 
                 levels=c("초등학교","중학교","고등학교","특수학교","각종학교")),
          if_else(문항31 == "합계", 2, 1),
          desc(n))

print(summary_q31_total, n = Inf)
```

```{r}
#| echo: false
#| warning: false
#| message: false
ggplot(summary_q31, aes(x = 문항31, y = n, fill = 문항31)) +
  geom_bar(stat="identity", width=0.7) +
  geom_text(aes(label = paste0(n,"명\n(",pct,"%)"),
                y = n),
            hjust=0.5, vjust=-0.2, size=6.5, fontface="bold", lineheight=0.5) +
  facet_wrap(~학교급, ncol = 2, nrow = 3) +
  labs(
    title = "교육지원청 도움 여부\n(학교급별)",
    x = "도움여부",
    y = "응답수"
  ) +
  scale_x_discrete(labels = c("그렇다", "아니다")) +
  theme_minimal(base_size = 13) +
  theme(
    plot.title = element_text(face="bold", size=32, hjust=0.5, margin = margin(b = 18), lineheight = 0.5),
    legend.position = "none",
    axis.text.x = element_text(angle=0, hjust=0.5, size=18, lineheight=0.6),
    axis.text.y = element_text(size=18),
    axis.title.x = element_text(size=20, margin = margin(t = 18)),
    axis.title.y = element_text(angle = 0, vjust = 0.5, size=20),
    strip.text = element_text(face="bold", size=15, margin = margin(t = 6, b = 6)),
    panel.spacing = unit(1.5, "lines"),
    plot.margin = margin(20, 20, 20, 20)
  ) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.25))) +
  coord_cartesian(clip = "off")
```

### 문항32. \[31번 문항에 ①로 답변한 경우만 응답\] 교육지원청으로부터 학생맞춤통합지원을 위해 도움을 받은 영역은 어느 영역이었습니까? (중복응답)

① 학생맞춤통합지원 컨설팅 ② 찾아가는 연수(정책안내) ③ 학생성장(사례) 지원 관련 ④ 기타

교육지원청으로부터 학생맞춤통합지원을 위해 도움을 받은 영역 설문에 총 응답건수는 1,256건이고 초등학교 응답건수는 539건(42.9%) 중학교 응답건수는 442건(35.2%)이고 고등학교 응답건수는 268건(21.3%)이고, 특수학교 응답건수는 2건(0.2%)이고 각종학교 응답건수는 5건(0.4%)으로 나타남

초등학교 응답 중에서 교육지원청으로부터 학생맞춤통합지원 컨설팅으로 도움을 받았다고 답변한 응답건수는 235건(43.6%), 학생성장(사례) 지원 관련으로 도움을 받았다고 답변한 응답건수는 196건(36.4%), 찾아가는 연수(정책안내)라고 답변한 응답건수는 51건(9.5%) 등으로 나타났음

중학교의 경우 교육지원청으로부터 학생맞춤통합지원 컨설팅으로 도움을 받았다고 답변한 응답건수는 174건(39.4%), 학생성장(사례) 지원 관련으로 도움을 받았다고 답변한 응답건수는 164건(37.1%), 찾아가는 연수(정책안내)라고 답변한 응답건수는 68건(15.4%) 등으로 나타났음

고등학교의 경우 교육지원청으로부터 학생맞춤통합지원 컨설팅으로 도움을 받았다고 답변한 응답건수는 132건(49.3%), 학생성장(사례) 지원 관련으로 도움을 받았다고 답변한 응답건수는 69건(25.7%), 찾아가는 연수(정책안내)라고 답변한 응답건수는 40건(14.9%) 등으로 나타났음

특수학교의 경우 교육지원청으로부터 학생성장(사례) 지원 관련으로 도움을 받았다고 답변한 응답건수는 2건(100%) 등으로 나타났음

각종학교의 경우 교육지원청으로부터 학생맞춤통합지원 컨설팅으로 도움을 받았다고 답변한 응답건수는 2건(40%), 찾아가는 연수(정책안내)라고 답변한 응답건수는 1건(20%) 등으로 나타났음

```{r}
#| echo: false
#| warning: false
#| message: false
dat_q32_long <- dat %>%
  filter(as.character(ques_31) == "1") %>%  # 문항31에서 "그렇다"인 경우만
  separate_rows(ques_32, sep = ",\\s*") %>%
  mutate(
    ques_32 = str_trim(as.character(ques_32)),
    문항32 = recode(ques_32,
                   "1" = "학생맞춤통합지원 컨설팅",
                   "2" = "찾아가는 연수(정책안내)",
                   "3" = "학생성장(사례) 지원 관련",
                   "4" = "기타",
                   .default = "기타"),
    학교급 = factor(학교급, levels = c("초등학교", "중학교", "고등학교", "특수학교", "각종학교"))
  )

# 기술통계
summary_q32 <- dat_q32_long %>%
  group_by(학교급, 문항32) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  mutate(pct = round(n / sum(n) * 100, 1)) %>%
  ungroup()

summary_q32_total <- summary_q32 %>%
  group_by(학교급) %>%
  summarise(n = sum(n), pct = 100, 문항32 = "합계", .groups = "drop") %>%
  bind_rows(summary_q32) %>%
  arrange(factor(학교급, 
                 levels=c("초등학교","중학교","고등학교","특수학교","각종학교")),
          if_else(문항32 == "합계", 2, 1),
          desc(n))

print(summary_q32_total, n = Inf)
```

```{r}
#| echo: false
#| warning: false
#| message: false
# 시각화
ggplot(
  summary_q32 %>%
    mutate(문항32 = reorder(문항32, -n)),
  aes(x = 문항32, y = n, fill = 문항32)
) +
  geom_bar(stat = "identity", width = 0.7) +
  geom_text(aes(label = paste0(n,"건\n(",pct,"%)"), 
                y = n + max(n) * 0.05),
            vjust = -0.2, hjust = 0.5, size = 6.5, lineheight = 0.5) +
  facet_wrap(~학교급, ncol = 1, scales = "free_y") +
  labs(
    title = "교육지원청의 도움을 받은 영역",
    x = "도움을 받은 영역",
    y = "응답수"
  ) +
  scale_x_discrete(labels = c("학생맞춤\n통합지원\n컨설팅", "찾아가는\n 연수\n(정책안내)", "학생성장(사례)\n지원 관련", "기타")) +
  theme_minimal(base_size = 13) +
  theme(
    plot.title = element_text(face = "bold", size = 32, hjust = 0.5),
    legend.position = "none",
    axis.text.x = element_text(angle = 0, vjust = 0.8, lineheight = 0.6, size = 17),
    axis.text.y = element_text(size = 17),
    strip.text = element_text(face = "bold", size = 20),
    axis.title.x = element_text(size = 20, margin = margin(t = 18)),
    axis.title.y = element_text(angle = 0, vjust = 0.5, size = 20)
  ) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.15))) +
  coord_cartesian(clip = "off")
```

### 문항33. \[32번 문항에 ①항으로 답변한 경우만 응답\] 학생맞춤통합지원으로 컨설팅을 받았다면 어느 분야의 컨설팅을 받았나요? (중복응답)

① 통합지원팀 구성ㆍ운영 ② 학생 사례지원 방안 ③ 지역자원 연계 방안 ④ 기타

교육지원청으로부터 학생맞춤통합지원을 위해 컨설팅을 받은 영역 설문에 총 응답건수는 553건이고 초등학교 응답건수는 239건(43.2%) 중학교 응답건수는 172건(31.1%)이고 고등학교 응답건수는 141건(25.5%)이고, 각종학교 응답건수는 1건(0.2%)으로 나타남

초등학교의 경우 교육지원청로부터 학생 사례지원 방안에 대해 컨설팅을 받았다고 답변한 응답건수가 115건(48.1%), 통합지원팀 구성ㆍ운영 방안이라고 답변한 응답건수는 72건(30.1%), 지역자원 연계 방안이라고 답변한 응답건수는 45건(18.8%) 등으로 나타났음

중학교의 경우 교육지원청로부터 학생 사례지원 방안에 대해 컨설팅을 받았다고 답변한 응답건수가 75건(43.6%), 통합지원팀 구성ㆍ운영 방안이라고 답변한 응답건수는 60건(34.9%), 지역자원 연계 방안이라고 답변한 응답건수는 35건(20.3%) 등으로 나타났음

고등학교의 경우 교육지원청로부터 통합지원팀 구성ㆍ운영방안으로 컨설팅을 받았다고 답변한 응답건수가 58건(41.1%), 학생 사례지원 방안이라고 답변한 응답건수는 54건(38.3%), 지역자원 연계 방안이라고 답변한 응답건수는 29건(20.6%)으로 나타났음

각종학교의 경우 교육지원청로부터 통합지원팀 구성ㆍ운영 방안으로 컨설팅을 받았다고 답변한 응답건수가 1건(100%)으로 나타났음

```{r}
#| echo: false
#| warning: false
#| message: false
dat_q33_long <- dat %>%
  filter(!is.na(ques_32), !is.na(ques_33)) %>%
  filter(as.character(ques_32) == "1") %>%  # 문항32에서 "1"인 경우만
  separate_rows(ques_33, sep = ",\\s*") %>%
  mutate(
    ques_33 = str_trim(as.character(ques_33)),
    문항33 = recode(ques_33,
                   "1" = "통합지원팀 구성·운영",
                   "2" = "학생 사례지원 방안",
                   "3" = "지역자원 연계 방안",
                   "4" = "기타",
                   .default = "기타"),
    학교급 = factor(학교급, levels = c("초등학교", "중학교", "고등학교", "특수학교", "각종학교"))
  )

# 기술통계
summary_q33 <- dat_q33_long %>%
  group_by(학교급, 문항33) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  mutate(pct = round(n / sum(n) * 100, 1)) %>%
  ungroup()

summary_q33_total <- summary_q33 %>%
  group_by(학교급) %>%
  summarise(n = sum(n), pct = 100, 문항33 = "합계", .groups = "drop") %>%
  bind_rows(summary_q33) %>%
  arrange(factor(학교급, 
                 levels=c("초등학교","중학교","고등학교","특수학교","각종학교")),
          if_else(문항33 == "합계", 2, 1),
          desc(n))

print(summary_q33_total, n = Inf)
```

```{r}
#| echo: false
#| warning: false
#| message: false
# 시각화
ggplot(
  summary_q33 %>%
    mutate(문항33 = reorder(문항33, -n)),
  aes(x = 문항33, y = n, fill = 문항33)
) +
  geom_bar(stat = "identity", width = 0.7) +
  geom_text(aes(label = paste0(n,"건\n(",pct,"%)"), 
                y = n + max(n) * 0.05),
            vjust = -0.2, hjust = 0.5, size = 7, lineheight = 0.4) +
  facet_wrap(~학교급, ncol = 1, scales = "free_y") +
  labs(
    title = "컨설팅 받은 분야",
    x = "컨설팅 분야",
    y = "응답수"
  ) +
  scale_x_discrete(labels = c("통합지원팀\n구성·운영", "학생 사례지원\n방안", "지역자원\n연계 방안", "기타")) +
  theme_minimal(base_size = 13) +
  theme(
    plot.title = element_text(face = "bold", size = 32, hjust = 0.5),
    legend.position = "none",
    axis.text.x = element_text(angle = 0, vjust = 0.8, lineheight = 0.5, size = 18),
    axis.text.y = element_text(size = 20),
    strip.text = element_text(face = "bold", size = 20),
    axis.title.x = element_text(size = 20, margin = margin(t = 18)),
    axis.title.y = element_text(angle = 0, vjust = 0.5, size = 20)
  ) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.15))) +
  coord_cartesian(clip = "off")
```

### 문항34. \[33번 문항에 답변한 경우만 응답\] 교육지원청의 컨설팅이 학교에 도움이 되었습니까?

① 매우 그렇다 ② 그렇다 ③ 보통이다 ④ 그렇지 않다 ⑤ 매우 그렇지 않다

교육지원청의 컨설팅이 학교에 도움이 되었는지에 대한 문항의 총 응답자는 52명이며 매우 그렇다고 답변한 응답은 227명(43.2%), 그렇다고 답변한 응답은 227명(43.2%), 보통이다라고 답변한 응답은 55명(10.5%), 그렇지 않다고 답변한 응답은 10명(1.9%), 매우 그렇지 않다고 답변한 응답은 7명(1.3%)으로 나타났음

```{r}
#| echo: false
#| warning: false
#| message: false
ques34_freq <- dat %>%
  # 조건부 응답 필터링: 32번에서 1번 선택 + 33번 응답 + 34번 응답
  filter(!is.na(ques_32), 
         !is.na(ques_33), 
         !is.na(ques_34),
         str_detect(as.character(ques_32), "1"),  # 32번에서 1번(컨설팅) 포함
         ques_34 %in% as.character(1:5)) %>%
  count(ques_34) %>%
  mutate(
    응답 = recode(ques_34,
                 "1" = "매우 그렇다",
                 "2" = "그렇다", 
                 "3" = "보통이다",
                 "4" = "그렇지 않다",
                 "5" = "매우 그렇지 않다"),
    pct = round(n / sum(n) * 100, 1)
  ) %>%
  arrange(desc(n)) %>%
  bind_rows(summarise(., 응답 = "합계", n = sum(n), pct = sum(pct)))

print(ques34_freq %>% select(응답, n, pct), n = Inf)
```

```{r}
#| echo: false
#| warning: false
#| message: false
ggplot(ques34_freq %>% filter(응답 != "합계"), aes(x = reorder(응답, -n), y = n, fill = 응답)) +
  geom_bar(stat = "identity", width = 0.5) +
  geom_text(aes(label = paste0(n, "명 (", pct, "%)")), 
            vjust = -0.5, size = 7) +
  labs(
    title = "교육지원청 컨설팅의 도움 정도",
    x = "도움 정도",
    y = "응답수"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    plot.title = element_text(size = 32, face = "bold", hjust = 0.5),
    axis.text.x = element_text(angle=0, hjust=0.5, size=20, lineheight=0.5),
    axis.text.y = element_text(size=20),
    axis.title.x = element_text(size=20, margin = margin(t = 18)),
    axis.title.y = element_text(angle = 0, vjust = 0.5, size=20),
    strip.text = element_text(face="bold", size=23, margin = margin(t = 6, b = 6)),
    panel.spacing = unit(1.5, "lines"), plot.margin = margin(20, 20, 20, 20),
    legend.position = "none"
  ) +
  ylim(0, max(ques34_freq$n) * 1.15)
```

### 문항 34-1. 직책별 컨설팅 유용성 인식 분석

직책별 응답자는 총 524명이고 이 중에서 학교장 응답건수는 102명(19.5%), 교감 응답건수는 116명(22.1%), 교사 등 응답건수는 306명(58.4%)이었음

학교장 응답 중에서 매우 그렇다는 53명(52%), 그렇다는 50명(43.1%), 보통이다는 5명(4.9%)이었음.

교감 응답 중에서 매우 그렇다는 53명(45.7%), 그렇다는 50명(43.1%), 보통이다는 12명(10.3%), 그렇지 않다는 1명(0.9%)이었음

교사 등 응답 중에서 매우 그렇다는 121명(39.5%), 그렇다는 131명(42.8%), 보통이다는 38명(12.4%), 그렇지 않다는 9명(2.9%), 매우 그렇지 않다는 7명(2.3%)이었음

```{r}
#| echo: false
#| warning: false
#| message: false
## 1. 직책별 분석

dat_filtered_34 <- dat %>%
  filter(ques_1 %in% c(1,2,3),
         !is.na(ques_33), 
         !is.na(ques_34),
         str_detect(as.character(ques_32), "1"),  # 32번에서 1번(컨설팅) 포함
         ques_34 %in% as.character(1:5)) %>%
  mutate(
    직책 = case_when(
      ques_7 == 1 ~ "학교장",
      ques_7 == 2 ~ "교감", 
      TRUE ~ "교사 등"
    ),
    컨설팅도움정도 = factor(as.character(ques_34),
                     levels = c("1","2","3","4","5"),
                     labels = c("매우 그렇다","그렇다","보통이다","그렇지 않다","매우 그렇지 않다"))
  )

# 직책별 기술통계 (합계 포함)
summary_job_table_34 <- dat_filtered_34 %>%
  group_by(직책, 컨설팅도움정도) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  mutate(pct = round(n / sum(n) * 100, 1)) %>%
  ungroup()

summary_job_with_total_34 <- summary_job_table_34 %>%
  group_by(직책) %>%
  summarise(n = sum(n), pct = sum(pct), 컨설팅도움정도 = "합계") %>%
  bind_rows(summary_job_table_34) %>%
  arrange(
    factor(직책, levels = c("학교장","교감","교사 등")),
    컨설팅도움정도 == "합계",
    if_else(컨설팅도움정도 != "합계", -n, 0)
  )

summary_job_final_34 <- summary_job_with_total_34 %>%
  bind_rows(
    summary_job_with_total_34 %>%
      summarise(직책 = "전체 합계", n = sum(n[컨설팅도움정도 == "합계"]), pct = 100, 컨설팅도움정도 = "합계")
  )

print(summary_job_final_34, n = Inf)

# 카이제곱 검정
tab1_34 <- table(dat_filtered_34$직책, dat_filtered_34$컨설팅도움정도)
chisq_test1_34 <- chisq.test(tab1_34)
print(chisq_test1_34)
```

```{r}
#| echo: false
#| warning: false
#| message: false
# 누적막대그래프
summary_job_plot_34 <- summary_job_table_34 %>%
  mutate(컨설팅도움정도 = factor(컨설팅도움정도, 
                          levels = c("매우 그렇다", "그렇다", "보통이다", 
                                   "그렇지 않다", "매우 그렇지 않다")))

ggplot(summary_job_plot_34, aes(x = factor(직책, levels = c("학교장", "교감", "교사 등")), 
                                    y = pct, fill = 컨설팅도움정도)) +
  geom_bar(stat = "identity", width = 0.7) +
  labs(
    title = "직책별 컨설팅 도움정도 인식",
    x = "직책",
    y = "비율",
    fill = "컨설팅도움정도"
  ) +
  scale_y_continuous(limits = c(0, 100), expand = expansion(mult = c(0, 0.02))) +
  theme_minimal(base_size = 15) +
  theme(
    plot.title = element_text(face = "bold", size = 32, hjust = 0.5),
    axis.text.x = element_text(size = 20, face = "bold"),
    axis.text.y = element_text(size = 18),
    axis.title.x = element_text(size = 25, angle = 0, margin = margin(t = 15)),
    axis.title.y = element_text(size = 20, angle = 0, vjust = 0.5),
    legend.position = "right",
    legend.text = element_text(size = 14),
    legend.title = element_text(size = 16, face = "bold")
  )
```

교육지원청의 컨설팅이 학교에 도움이 되었는지에 대해 직책별 평균점수를 비교한 결과, 학교장(4.47), 교감(4.34), 교사 등(4.14)으로 학교장-교사 등 간에는 유의미한 차이가 있었으나, 학교장-교감, 교감-교사 등 간에는 컨설팅이 학교에 도움이 되었는지에 대한 평균점수에 유의미한 차이가 있지는 않았음

```{r}
#| echo: false
#| warning: false
#| message: false
# ANOVA 분석
dat_score_job_34 <- dat_filtered_34 %>%
  filter(!is.na(ques_34)) %>%
  mutate(
    컨설팅도움정도점수 = case_when(
      ques_34 == 1 ~ 5,   # 매우 그렇다
      ques_34 == 2 ~ 4,   # 그렇다
      ques_34 == 3 ~ 3,   # 보통이다
      ques_34 == 4 ~ 2,   # 그렇지 않다
      ques_34 == 5 ~ 1,   # 매우 그렇지 않다
      TRUE ~ NA_real_
    ),
    직책 = factor(직책, levels = c("학교장", "교감", "교사 등"))
  )

job_stats_34 <- dat_score_job_34 %>%
  group_by(직책) %>%
  summarise(
    평균 = round(mean(컨설팅도움정도점수, na.rm = TRUE), 2),
    표준편차 = round(sd(컨설팅도움정도점수, na.rm = TRUE), 2),
    n = n(),
    .groups = "drop"
  ) %>%
  arrange(직책)

print(job_stats_34)

anova_job_34 <- aov(컨설팅도움정도점수 ~ 직책, data = dat_score_job_34)
summary(anova_job_34)

tukey_job_34 <- TukeyHSD(anova_job_34)
print(tukey_job_34)
```

```{r}
#| echo: false
#| warning: false
#| message: false
# 박스플롯
tukey_letters_job_34 <- multcompView::multcompLetters4(anova_job_34, tukey_job_34)
letters_df_job_34 <- data.frame(
  직책 = names(tukey_letters_job_34$`직책`$Letters),
  group = tukey_letters_job_34$`직책`$Letters
)

job_stats_with_groups_34 <- job_stats_34 %>%
  left_join(letters_df_job_34, by = "직책")

ggplot(dat_score_job_34, aes(x = factor(직책, levels = c("학교장", "교감", "교사 등")), y = 컨설팅도움정도점수, fill = 직책)) +
  geom_boxplot(alpha = 0.7, width = 0.6, outlier.shape = 21) +
  stat_summary(fun = mean, geom = "point", shape = 23, size = 10, fill = "yellow", stroke = 1) +
  geom_text(data = job_stats_with_groups_34, 
            aes(x = 직책, y = 8, label = paste0(group, "\n(M=", 평균, ")")),
            inherit.aes = FALSE, fontface = "bold", size = 8, vjust = 0, lineheight = 0.5) +
  labs(
    title = "직책별 컨설팅 유용성 인식",
    x = "직책", 
    y = "컨설팅 유용성"
  ) +
  theme_minimal(base_size = 15) +
  theme(
    plot.title = element_text(face = "bold", size = 32, hjust = 0.5),
    axis.text.x = element_text(size = 20),
    axis.text.y = element_text(size = 20),
    axis.title.x = element_text(size = 20, margin = margin(t = 15)),
    axis.title.y = element_text(size = 20, angle = 0, vjust = 0.5),
    legend.position = "none"
  ) +
  scale_y_continuous(expand = expansion(mult = c(0.05, 0.15)))
```

### 문항 34-2. 학교급별 컨설팅 유용성 인식 분석

학교급별 응답자는 524명이고 초등학교 응답자는 226명(43.13%), 중학교 응답자는 170명(32.44%), 고등학교 응답자는 128명(24.43%)이 응답하였음.

초등학교 응답건수 중에서 매우 그렇다는 101명(44.7%), 그렇다는 96명(42.5%), 보통이다는 22명(9.7%), 그렇지 않다는 5명(2.2%), 매우 그렇지 않다는 2명(0.9%)이었음

중학교 응답건수 중에서 매우 그렇다는 72명(42.4%), 그렇다는 74명(43.5%), 보통이다는 19명(11.2%), 그렇지 않다는 3명(1.8%), 매우 그렇지 않다는 2명(1.2%)이었음

고등학교 응답건수 중에서 매우 그렇다는 54명(42.2%), 그렇다는 55명(43%), 보통이다는 14명(10.9%), 그렇지 않다는 3명(2.3%), 매우 그렇지 않다는 2명(1.6%)이었음

```{r}
#| echo: false
#| warning: false
#| message: false
## 3. 학교급별 분석

# 학교급별 기술통계 (합계 포함)
summary_school_table_34 <- dat_filtered_34 %>%
  group_by(학교급, 컨설팅도움정도) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  mutate(pct = round(n / sum(n) * 100, 1)) %>%
  ungroup()

summary_school_with_total_34 <- summary_school_table_34 %>%
  group_by(학교급) %>%
  summarise(n = sum(n), pct = sum(pct), 컨설팅도움정도 = "합계") %>%
  bind_rows(summary_school_table_34) %>%
  arrange(
    factor(학교급, levels = c("초등학교","중학교","고등학교")),
    컨설팅도움정도 == "합계",
    if_else(컨설팅도움정도 != "합계", -n, 0)
  )

summary_school_final_34 <- summary_school_with_total_34 %>%
  bind_rows(
    summary_school_with_total_34 %>%
      summarise(학교급 = "전체 합계", n = sum(n[컨설팅도움정도 == "합계"]), pct = 100, 컨설팅도움정도 = "합계")
  )

print(summary_school_final_34, n = Inf)

# 카이제곱 검정
tab_school_34 <- table(dat_filtered_34$학교급, dat_filtered_34$컨설팅도움정도)
chisq_test_school_34 <- chisq.test(tab_school_34)
print(chisq_test_school_34)
```

```{r}
#| echo: false
#| warning: false
#| message: false
# 누적막대그래프
summary_school_plot_34 <- summary_school_table_34 %>%
  mutate(컨설팅도움정도 = factor(컨설팅도움정도, 
                          levels = c("매우 그렇다", "그렇다", "보통이다", 
                                   "그렇지 않다", "매우 그렇지 않다")))

ggplot(summary_school_plot_34, aes(x = factor(학교급, levels = c("초등학교", "중학교", "고등학교")), y = pct, fill = 컨설팅도움정도)) +
  geom_bar(stat = "identity", width = 0.7) +
  labs(
    title = "학교급별 컨설팅 도움정도 인식",
    x = "학교급",
    y = "비율",
    fill = "컨설팅도움정도"
  ) +
  scale_y_continuous(limits = c(0, 100), expand = expansion(mult = c(0, 0.02))) +
  theme_minimal(base_size = 15) +
  theme(
    plot.title = element_text(size = 32, face = "bold", hjust = 0.5),
    axis.text.x = element_text(size = 18, margin = margin(t = 10)),
    axis.text.y = element_text(size = 18),
    axis.title.x = element_text(size = 20, angle = 0, margin = margin(t = 15)),
    axis.title.y = element_text(size = 20, angle = 0, vjust = 0.5),
    legend.position = "right",
    legend.text = element_text(size = 14),
    legend.title = element_text(size = 16, face = "bold")
  )
```

교육지원청의 컨설팅이 학교에 도움이 되었는지에 대해 학교급별 평균점수를 비교한 결과, 초등학교(4.28), 중학교(4.24), 고등학교(4.22)이었으며, 학교급별 유의미한 차이가 있지는 않았음

```{r}
#| echo: false
#| warning: false
#| message: false
# 학교급별 ANOVA
school_stats_34 <- dat_score_job_34 %>%
  mutate(학교급 = factor(학교급, levels = c("초등학교", "중학교", "고등학교"))) %>%
  group_by(학교급) %>%
  summarise(
    평균 = round(mean(컨설팅도움정도점수, na.rm = TRUE), 2),
    표준편차 = round(sd(컨설팅도움정도점수, na.rm = TRUE), 2),
    n = n(),
    .groups = "drop"
  ) %>%
  arrange(학교급)

print(school_stats_34)

anova_school_34 <- aov(컨설팅도움정도점수 ~ 학교급, data = dat_score_job_34)
summary(anova_school_34)

tukey_school_34 <- TukeyHSD(anova_school_34)
print(tukey_school_34)
```

```{r}
#| echo: false
#| warning: false
#| message: false
# 박스플롯
tukey_letters_school_34 <- multcompView::multcompLetters4(anova_school_34, tukey_school_34)
letters_df_school_34 <- data.frame(
  학교급 = names(tukey_letters_school_34$`학교급`$Letters),
  group = tukey_letters_school_34$`학교급`$Letters
)

school_stats_with_groups_34 <- school_stats_34 %>%
  left_join(letters_df_school_34, by = "학교급")

ggplot(dat_score_job_34, aes(x = factor(학교급, levels = c("초등학교", "중학교", "고등학교")), y = 컨설팅도움정도점수, fill = 학교급)) +
  geom_boxplot(alpha = 0.7, width = 0.6, outlier.shape = 21) +
  stat_summary(fun = mean, geom = "point", shape = 23, size = 10, fill = "yellow", stroke = 1) +
  geom_text(data = school_stats_with_groups_34, 
            aes(x = 학교급, y = 8, label = paste0(group, "\n(M=", 평균, ")")),
            inherit.aes = FALSE, fontface = "bold", size = 8, vjust = 0, lineheight = 0.5) +
  labs(
    title = "학교급별 컨설팅 유용성",
    x = "학교급", 
    y = "컨설팅 유용성"
  ) +
  theme_minimal(base_size = 15) +
  theme(
    plot.title = element_text(face = "bold", size = 32, hjust = 0.5),
    axis.text.x = element_text(size = 20),
    axis.text.y = element_text(size = 20),
    axis.title.x = element_text(size = 20, margin = margin(t = 15)),
    axis.title.y = element_text(size = 20, angle = 0, vjust = 0.5),
    legend.position = "none"
  ) +
  scale_y_continuous(expand = expansion(mult = c(0.05, 0.15)))
```

### 문항 34-3. 설립별 컨설팅 유용성 인식 분석

설립별 응답자는 524건이고 공립학교 응답자는 394명(75.2%), 사립학교 응답자는 130명(24.8%)이 응답하였음.

공립학교 응답건수 중에서 매우 그렇다는 165명(41.9%), 그렇다는 170명(43.1%), 보통이다는 45명(11.4%), 그렇지 않다는 8명(2%), 매우 그렇지 않다는 6명(1.5%)이었음

사립학교 응답건수 중에서 매우 그렇다는 62명(47.7%), 그렇다는 55명(42.3%), 보통이다는 10명(7.7%), 그렇지 않다는 2명(1.5%), 매우 그렇지 않다는 1명(0.8%)이었음

```{r}
#| echo: false
#| warning: false
#| message: false
# 설립별 데이터 준비
dat_found_34 <- dat_filtered_34 %>%
  filter(설립 %in% c("공립", "사립")) %>%
  mutate(설립 = factor(설립, levels = c("공립", "사립")))

# 설립별 기술통계 (합계 포함)
summary_found_table_34 <- dat_found_34 %>%
  group_by(설립, 컨설팅도움정도) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  mutate(pct = round(n / sum(n) * 100, 1)) %>%
  ungroup()

summary_found_with_total_34 <- summary_found_table_34 %>%
  group_by(설립) %>%
  summarise(n = sum(n), pct = sum(pct), 컨설팅도움정도 = "합계") %>%
  bind_rows(summary_found_table_34) %>%
  arrange(설립, 컨설팅도움정도 == "합계", if_else(컨설팅도움정도 != "합계", -n, 0))

summary_found_final_34 <- summary_found_with_total_34 %>%
  bind_rows(
    summary_found_with_total_34 %>%
      summarise(설립 = "전체 합계", n = sum(n[컨설팅도움정도 == "합계"]), pct = 100, 컨설팅도움정도 = "합계")
  )

print(summary_found_final_34, n = Inf)

# 카이제곱 검정
tab_found_34 <- table(dat_found_34$설립, dat_found_34$컨설팅도움정도)
print(tab_found_34)
chisq_test_found_34 <- chisq.test(tab_found_34)
print(chisq_test_found_34)
```

```{r}
#| echo: false
#| warning: false
#| message: false
# 누적막대그래프
summary_found_plot_34 <- summary_found_table_34 %>%
  mutate(컨설팅도움정도 = factor(컨설팅도움정도, 
                          levels = c("매우 그렇다", "그렇다", "보통이다", 
                                   "그렇지 않다", "매우 그렇지 않다")))

ggplot(summary_found_plot_34, aes(x = 설립, y = pct, fill = 컨설팅도움정도)) +
  geom_bar(stat = "identity", width = 0.7) +
  labs(
    title = "설립별 컨설팅 유용성 인식",
    x = "설립",
    y = "비율",
    fill = "컨설팅 유용성"
  ) +
  scale_y_continuous(limits = c(0, 100), expand = expansion(mult = c(0, 0.02))) +
  theme_minimal(base_size = 15) +
  theme(
    plot.title = element_text(size = 32, face = "bold", hjust = 0.5),
    axis.text.x = element_text(size = 18, margin = margin(t = 10)),
    axis.text.y = element_text(size = 18),
    axis.title.x = element_text(size = 20, angle = 0, margin = margin(t = 15)),
    axis.title.y = element_text(size = 20, angle = 0, vjust = 0.5),
    legend.position = "right",
    legend.text = element_text(size = 14),
    legend.title = element_text(size = 16, face = "bold")
  )
```

교육지원청의 컨설팅이 학교에 도움이 되었는지에 대해 설립별 평균점수를 비교한 결과, 공립학교(4.22), 사립학교(4.35)에서 교육지원청 컨설팅이 도움이 되었는지에 대해 유의미한 차이가 있지는 않았음

```{r}
#| echo: false
#| warning: false
#| message: false
# T-test 분석
dat_score_found_34 <- dat_found_34 %>%
  mutate(
    컨설팅도움정도점수 = case_when(
      ques_34 == 1 ~ 5,   # 매우 그렇다
      ques_34 == 2 ~ 4,   # 그렇다
      ques_34 == 3 ~ 3,   # 보통이다
      ques_34 == 4 ~ 2,   # 그렇지 않다
      ques_34 == 5 ~ 1,   # 매우 그렇지 않다
      TRUE ~ NA_real_
    )
  )

found_stats_34 <- dat_score_found_34 %>%
  group_by(설립) %>%
  summarise(
    평균 = round(mean(컨설팅도움정도점수, na.rm = TRUE), 2),
    표준편차 = round(sd(컨설팅도움정도점수, na.rm = TRUE), 2),
    n = n(),
    .groups = "drop"
  )

print(found_stats_34)

# T-test
t_test_result_34 <- t.test(컨설팅도움정도점수 ~ 설립, data = dat_score_found_34, var.equal = FALSE)
print(t_test_result_34)
```

```{r}
#| echo: false
#| warning: false
#| message: false
# 박스플롯
if(t_test_result_34$p.value < 0.05) {
  establishment_groups_34 <- data.frame(
    설립 = c("공립", "사립"),
    group = c("a", "b")
  )
} else {
  establishment_groups_34 <- data.frame(
    설립 = c("공립", "사립"),
    group = c("a", "a")
  )
}

found_stats_with_groups_34 <- found_stats_34 %>%
  left_join(establishment_groups_34, by = "설립")

ggplot(dat_score_found_34, aes(x = 설립, y = 컨설팅도움정도점수, fill = 설립)) +
  geom_boxplot(alpha = 0.7, width = 0.6, outlier.shape = 21) +
  stat_summary(fun = mean, geom = "point", shape = 23, size = 10, fill = "yellow", stroke = 1) +
  geom_text(data = found_stats_with_groups_34, 
            aes(x = 설립, y = 8, label = paste0(group, "\n(M=", 평균, ")")),
            inherit.aes = FALSE, fontface = "bold", size = 8, vjust = 0, lineheight=0.5) +
  labs(
    title = "설립별 컨설팅 유용성 인식",
    x = "설립", 
    y = "컨설팅 유용성"
  ) +
  theme_minimal(base_size = 15) +
  theme(
    plot.title = element_text(face = "bold", size = 32, hjust = 0.5),
    axis.text.x = element_text(size = 20),
    axis.text.y = element_text(size = 20),
    axis.title.x = element_text(size = 20, margin = margin(t = 15)),
    axis.title.y = element_text(size = 20, angle = 0, vjust = 0.5),
    legend.position = "none"
  ) +
  scale_y_continuous(expand = expansion(mult = c(0.05, 0.15)))
```

### 문항35. \[33번 문항에 ④ 또는 ⑤항으로 답변한 경우만 응답\] 교육지원청의 컨설팅이 도움이 되지 않은 이유는 무엇입니까? (주관식)

해당없음

### 문항36. 귀 기관에서는 학생맞춤통합지원을 위한 컨설팅이 필요하다고 생각하십니까?

① 그렇다 ② 아니다

교육지원청의 컨설팅 필요성에 대한 설문 총 응답자는 3,178명이고 초등학교 응답자는 1,282명(40.3%) 중학교 응답자는 1,109명(34.9%)이고 고등학교 응답자는 718명(22.6%)이고, 각종학교 응답자는 46명(1.4%), 특수학교 응답자는 23명(0.7%)으로 나타남

초등학교의 경우 교육지원청의 컨설팅이 필요하다고 답변한 응답자는 531명(41.1%), 필요하지 않다고 답변한 응답지는 751명(58.6%)으로 나타났음

중학교의 경우 교육지원청의 컨설팅이 필요하다고 답변한 응답자는 483명(43.6%), 필요하지 않다고 답변한 응답자는 626명(56.4%)으로 나타났음

고등학교의 경우 교육지원청의 컨설팅이 필요하다고 답변한 응답자는 354명(49.3%), 필요하지 않다고 답변한 응답자는 364명(50.7%)으로 나타났음

특수학교의 경우 교육지원청의 컨설팅이 필요하다고 답변한 응답자는 22명(47.8%), 필요하지 않다고 답변한 응답자는 24명(52.2%)으로 나타났음

각종학교의 경우 교육지원청의 컨설팅이 필요하다고 답변한 응답자는 10명(43.5%), 필요하지 않다고 답변한 응답자는 13명(56.5%)으로 나타났음

```{r}
#| echo: false
#| warning: false
#| message: false
dat_q36 <- dat %>%
  filter(!is.na(ques_36)) %>%
  mutate(
    문항36 = recode(as.character(ques_36),
                   "1" = "그렇다",
                   "2" = "아니다",
                   .default = "기타"),
    문항36 = factor(문항36, levels = c("그렇다", "아니다")),
    학교급 = factor(학교급, levels = c("초등학교", "중학교", "고등학교", "특수학교", "각종학교"))
  )

# 기술통계
summary_q36 <- dat_q36 %>%
  group_by(학교급, 문항36) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  mutate(pct = round(n / sum(n) * 100, 1)) %>%
  ungroup()

summary_q36_total <- summary_q36 %>%
  group_by(학교급) %>%
  summarise(n = sum(n), pct = 100, 문항36 = "합계", .groups = "drop") %>%
  bind_rows(summary_q36) %>%
  arrange(factor(학교급, 
                 levels=c("초등학교","중학교","고등학교","특수학교","각종학교")),
          if_else(문항36 == "합계", 2, 1))

print(summary_q36_total, n = Inf)
```

```{r}
#| echo: false
#| warning: false
#| message: false
# 시각화
ggplot(summary_q36, aes(x = 문항36, y = n, fill = 문항36)) +
  geom_bar(stat="identity", width=0.7) +
  geom_text(aes(label = paste0(n,"명\n(",pct,"%)"),
                y = n),
            hjust=0.5, vjust=-0.2, size= 6, fontface="bold", lineheight=0.5) +
  facet_wrap(~학교급, ncol = 2, nrow = 3) +
  labs(
    title = "컨설팅 필요성 인식",
    x = "컨설팅 필요성",
    y = "응답수"
  ) +
  scale_x_discrete(labels = c("그렇다", "아니다")) +
  theme_minimal(base_size = 13) +
  theme(
    plot.title = element_text(face="bold", size=32, hjust=0.5, margin = margin(b = 18), lineheight = 0.9),
    legend.position = "none",
    axis.text.x = element_text(angle=0, hjust=0.5, size=18, lineheight=0.6),
    axis.text.y = element_text(size=18),
    axis.title.x = element_text(size=20, margin = margin(t = 18)),
    axis.title.y = element_text(angle = 0, vjust = 0.5, size=20),
    strip.text = element_text(face="bold", size=15, margin = margin(t = 6, b = 6)),
    panel.spacing = unit(1.5, "lines"),
    plot.margin = margin(20, 20, 20, 20)
  ) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.25))) +
  coord_cartesian(clip = "off")
```

### 문항37. \[36번 문항에 ①항으로 답변한 경우만 응답\] 학생맞춤통합지원으로 컨설팅이 필요하다면 어느 분야의 컨설팅을 신청할 필요가 있다고 생각하시나요? (중복응답)

① 통합지원팀 구성ㆍ운영 ② 학생 사례지원 방안 ③ 지역자원 연계 방안 ④ 기타

교육지원청으로부터 학생맞춤통합지원을 위해 컨설팅이 필요한 영역에 대한 설문 총 응답건수는 869건이고 초등학교 응답건수는 333건(38.3%) 중학교 응답건수는 282건(32.5%)이고 고등학교 응답건수는 229건(26.4%)이고, 특수학교 응답건수는 20건(2.3%), 각종학교 응답건수는 5건(0.6%)으로 나타남

초등학교의 경우 교육지원청로부터 학생 사례지원 방안에 대한 컨설팅이 필요하다고 답변한 응답건수가 149건(44.7%), 지역자원 연계 방안이라고 답변한 응답건수는 97건(29.1%), 통합지원팀 구성ㆍ운영 방안이라고 답변한 응답건수는 82건(24.6%) 등으로 나타났음

중학교의 경우 교육지원청로부터 학생 사례지원 방안에 대한 컨설팅이 필요하다고 답변한 응답건수가 122건(43.3%), 지역자원 연계 방안이라고 답변한 응답건수는 81건(28.7%), 통합지원팀 구성ㆍ운영 방안이라고 답변한 응답건수는 77건(27.3%) 등으로 나타났음

고등학교의 경우 교육지원청로부터 학생 사례지원 방안에 대한 컨설팅이 필요하다고 답변한 응답건수가 95건(41.5%), 통합지원팀 구성ㆍ운영 방안이라고 답변한 응답건수는 74건(32.3%), 통합지원팀 구성ㆍ운영 방안이라고 답변한 응답건수는 59건(25.8%) 등으로 나타났음

특수학교의 경우 교육지원청로부터 학생 사례지원 방안에 대한 컨설팅이 필요하다고 답변한 응답건수가 8건(40%), 지역자원 연계 방안이라고 답변한 응답건수는 7건(35%), 통합지원팀 구성ㆍ운영 방안이라고 답변한 응답건수는 4건(20%) 등으로 나타났음

각종학교의 경우 교육지원청로부터 통합지원팀 구성ㆍ운영 방안으로 컨설팅이 필요하다고 답변한 응답건수가 3건(60%), 지역자원 연계 방안이라고 답변한 응답건수는 1건(20%), 학생 사례지원 방안이라고 답변한 응답건수는 1건(20%)으로 나타났음

```{r}
#| echo: false
#| warning: false
#| message: false
dat_q37_long <- dat_trimed %>%
  filter(!is.na(ques_36), !is.na(ques_37)) %>%
  filter(as.character(ques_36) == "1") %>%  # 문항36에서 "그렇다"인 경우만
  separate_rows(ques_37, sep = ",\\s*") %>%
  mutate(
    ques_37 = str_trim(as.character(ques_37)),
    문항37 = recode(ques_37,
                   "1" = "통합지원팀 구성·운영",
                   "2" = "학생 사례지원 방안",
                   "3" = "지역자원 연계 방안",
                   "4" = "기타",
                   .default = "기타")
  )

# 기술통계
summary_q37 <- dat_q37_long %>%
  group_by(학교급, 문항37) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  mutate(pct = round(n / sum(n) * 100, 1)) %>%
  ungroup()

summary_q37_total <- summary_q37 %>%
  group_by(학교급) %>%
  summarise(n = sum(n), pct = 100, 문항37 = "합계", .groups = "drop") %>%
  bind_rows(summary_q37) %>%
  arrange(학교급,
          if_else(문항37 == "합계", 2, 1),
          desc(n))

print(summary_q37_total, n = Inf)
```

```{r}
#| echo: false
#| warning: false
#| message: false
# 시각화
ggplot(
  summary_q37 %>%
    mutate(문항37 = reorder(문항37, -n)),
  aes(x = 문항37, y = n, fill = 문항37)
) +
  geom_bar(stat = "identity", width = 0.7) +
  geom_text(aes(label = paste0(n,"건\n(",pct,"%)"), 
                y = n + max(n) * 0.05),
            vjust = -0.2, hjust = 0.5, size = 6, lineheight = 0.4) +
  facet_wrap(~학교급, ncol = 1, scales = "free_y") +
  labs(
    title = "컨설팅이 필요한 분야",
    x = "컨설팅 분야",
    y = "응답수"
  ) +
  scale_x_discrete(labels = c("통합지원팀\n구성·운영", "학생 사례지원\n방안", "지역자원\n연계 방안", "기타")) +
  theme_minimal(base_size = 13) +
  theme(
    plot.title = element_text(face = "bold", size = 32, hjust = 0.5),
    legend.position = "none",
    axis.text.x = element_text(angle = 0, vjust = 0.8, lineheight = 0.5, size = 20),
    axis.text.y = element_text(size = 20),
    strip.text = element_text(face = "bold", size = 20),
    axis.title.x = element_text(size = 20, margin = margin(t = 18)),
    axis.title.y = element_text(angle = 0, vjust = 0.5, size = 20)
  ) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.15))) +
  coord_cartesian(clip = "off")
```

### 문항38. \[36번 문항에 ②항으로 답변한 경우만 응답\] 학생맞춤통합지원 관련하여 컨설팅이 필요하지 않다고 생각하시는 이유는 무엇입니까?

① 학교의 학생맞춤통합지원이 원활히 운영되고 있음 ② 교육(지원)청의 컨설팅이 도움이 되지 않을 것 같음 ③ 학생맞춤통합지원이 주요 사업이 아니라고 생각됨 ④ 학교의 다른 업무들로 너무 바빠서 컨설팅을 받을 시간이 없음 ⑤ 기타

초등학교의 경우 학교의 학생맞춤통합지원이 원활히 운영되고 있다고 답변한 응답건수가 166건(56.7%), 다른 업무로 너무 바빠서 시간이 없다고 답변한 응답건수가 46건(15.7%), 교육(지원)청의 컨설팅이 도움이 되지 않은 것 같다고 답변한 응답건수가 29건(9.9%), 주요 사업이 아니라고 생각한다고 답변한 응답건수가 18건(6.1%) 등으로 나타났음

중학교의 경우 학교의 학생맞춤통합지원이 원활히 운영되고 있다고 답변한 응답건수가 97건(45.5%), 다른 업무로 너무 바빠서 시간이 없다고 답변한 응답건수가 36건(21.1%), 교육(지원)청의 컨설팅이 도움이 되지 않은 것 같다고 답변한 응답건수가 11건(6.4%), 주요 사업이 아니라고 생각한다고 답변한 응답건수가 6건(3.5%) 등으로 나타났음

고등학교의 경우 학교의 학생맞춤통합지원이 원활히 운영되고 있다고 답변한 응답건수가 56건(45.5%), 다른 업무로 너무 바빠서 시간이 없다고 답변한 응답건수가 31건(25.2%), 교육(지원)청의 컨설팅이 도움이 되지 않은 것 같다고 답변한 응답건수가 11건(8.9%), 주요 사업이 아니라고 생각한다고 답변한 응답건수가 9건(7.3%) 등으로 나타났음

특수학교의 경우 학교의 학생맞춤통합지원이 원활히 운영되고 있다고 답변한 응답건수가 2건(28.6%), 교육(지원)청의 컨설팅이 도움이 되지 않은 것 같다고 답변한 응답건수가 1건(14.3%), 주요 사업이 아니라고 생각한다고 답변한 응답건수가 1건(14.3%) 등으로 나타났음

각종학교의 경우 다른 업무로 너무 바빠서 시간이 없다고 답변한 응답건수가 1건(20%), 주요 사업이 아니라고 생각한다고 답변한 응답건수가 3건(60%) 등으로 나타났음

```{r}
#| echo: false
#| warning: false
#| message: false
dat_q38 <- dat_trimed %>%
  filter(!is.na(ques_36), !is.na(ques_38)) %>%
  filter(as.character(ques_36) == "2") %>%  # 문항36에서 "아니다"인 경우만
  mutate(
    문항38 = recode(as.character(ques_38),
                   "1" = "학교의 학생맞춤통합지원이 원활히 운영",
                   "2" = "교육청 컨설팅이 도움되지 않을 것 같음",
                   "3" = "주요 사업이 아니라고 생각됨",
                   "4" = "다른 업무로 너무 바빠서 시간이 없음",
                   "5" = "기타",
                   .default = "기타")
  )

# 기술통계
summary_q38 <- dat_q38 %>%
  group_by(학교급, 문항38) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  mutate(pct = round(n / sum(n) * 100, 1)) %>%
  ungroup()

summary_q38_total <- summary_q38 %>%
  group_by(학교급) %>%
  summarise(n = sum(n), pct = 100, 문항38 = "합계", .groups = "drop") %>%
  bind_rows(summary_q38) %>%
  arrange(학교급,
          if_else(문항38 == "합계", 2, 1),
          desc(n))

print(summary_q38_total, n = Inf)
```

```{r}
#| echo: false
#| warning: false
#| message: false
# 시각화
ggplot(
  summary_q38 %>%
    mutate(문항38 = reorder(문항38, -n)),
  aes(x = 문항38, y = n, fill = 문항38)
) +
  geom_bar(stat = "identity", width = 0.7) +
  geom_text(aes(label = paste0(n,"건(",pct,"%)"), 
                y = n + max(n) * 0.05),
            vjust = 0.005, hjust = 0.5, size = 5, lineheight = 0.5) +
  facet_wrap(~학교급, ncol = 1, scales = "free_y") +
  labs(
    title = "컨설팅이 불필요한 이유",
    x = "불필요한 이유",
    y = "응답수"
  ) +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 12)) +
  theme_minimal(base_size = 13) +
  theme(
    plot.title = element_text(face = "bold", size = 32, hjust = 0.5),
    legend.position = "none",
    axis.text.x = element_text(angle = 0, vjust = 0.8, lineheight = 0.4, size = 15),
    axis.text.y = element_text(size = 15),
    strip.text = element_text(face = "bold", size = 20),
    axis.title.x = element_text(size = 20, margin = margin(t = 18)),
    axis.title.y = element_text(angle = 0, vjust = 0.5, size = 20)
  ) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.15))) +
  coord_cartesian(clip = "off")
```

### 문항39. \[32번 문항에 ③항으로 답변한 경우만 응답\] 교육지원청으로부터 학생성장 (사례) 지원을 받았다면 어느 영역 사례에 대한 지원을 받았나요? (중복응답)

① 경제적 지원 ② 심리정서 지원 ③ 학업 및 진로지원 ④ 안전지원(학교폭력, 아동학대, 성희롱ㆍ성폭력, 게임중독, 약물중독 등) ⑤ 건강지원(위생관리, 영양관리, 운동관리, 스트레스 관리, 수면관리, 스마트폰 사용 시간 관리 등)

교육지원청으로부터 학생성장(사례) 지원을 받은 영역에 대한 문항의 총 응답건수는 171건이며 초등학교 응답건수는 79건(46.2%), 중학교 응답건수는 73건(42.7%), 고등학교 응답건수는 18건(10.5%), 특수학교 응답건수는 1건(0.6%)으로 나타났음

초등학교의 경우 심리정서 지원이라고 답변한 응답건수가 51건(64.6%), 학업 및 진로지원이라고 답변한 응답건수가 17건(21.5%), 경제적 지원이라고 답변한 응답건수가 8건(10.1%), 안전지원이라고 답변한 응답건수는 2건(2.5%), 건강지원이라고 답변한 응답건수가 1건(1.3%)으로 나타났음

중학교의 경우 심리정서 지원이라고 답변한 응답건수가 31건(42.5%), 경제적 지원이라고 답변한 응답건수가 18건(24.7%), 학업 및 진로지원이라고 답변한 응답건수가 10건(13.7%), 안전지원이라고 답변한 응답건수는 8건(11%), 건강지원이라고 답변한 응답건수가 6건(8.2%)으로 나타났음

고등학교의 경우 심리정서 지원이라고 답변한 응답건수가 12건(66.7%), 경제적 지원이라고 답변한 응답건수가 3건(16.7%), 학업 및 진로지원이라고 답변한 응답건수가 2건(11.1%), 안전지원이라고 답변한 응답건수는 1건(5.6%)으로 나타났음

특수학교의 경우 심리정서 지원이라고 답변한 응답건수가 1건(100%)이었음

```{r}
#| echo: false
#| warning: false
#| message: false
dat_q39_long <- dat_trimed %>%
  filter(!is.na(ques_32), !is.na(ques_39)) %>%
  filter(as.character(ques_32) == "3") %>%  # 문항32에서 "3"인 경우만
  separate_rows(ques_39, sep = ",\\s*") %>%
  mutate(
    ques_39 = str_trim(as.character(ques_39)),
    문항39 = recode(ques_39,
                   "1" = "경제적 지원",
                   "2" = "심리정서 지원",
                   "3" = "학업 및 진로지원",
                   "4" = "안전지원",
                   "5" = "건강지원",
                   .default = "기타")
  )

# 기술통계
summary_q39 <- dat_q39_long %>%
  group_by(학교급, 문항39) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  mutate(pct = round(n / sum(n) * 100, 1)) %>%
  ungroup()

summary_q39_total <- summary_q39 %>%
  group_by(학교급) %>%
  summarise(n = sum(n), pct = 100, 문항39 = "합계", .groups = "drop") %>%
  bind_rows(summary_q39) %>%
  arrange(학교급,
          if_else(문항39 == "합계", 2, 1),
          desc(n))

print(summary_q39_total, n = Inf)
```

```{r}
#| echo: false
#| warning: false
#| message: false
# 시각화
ggplot(
  summary_q39 %>%
    mutate(문항39 = reorder(문항39, -n)),
  aes(x = 문항39, y = n, fill = 문항39)
) +
  geom_bar(stat = "identity", width = 0.7) +
  geom_text(aes(label = paste0(n,"건(",pct,"%)"), 
                y = n + max(n) * 0.05),
            vjust = 0.1, hjust = 0.5, size = 5, lineheight = 0.4) +
  facet_wrap(~학교급, ncol = 1, scales = "free_y") +
  labs(
    title = "학생성장(사례) 지원을 받은 영역",
    x = "지원영역",
    y = "응답수"
  ) +
  scale_x_discrete(labels = c("경제적 지원", "심리정서 지원", "학업 및\n진로지원", "안전지원", "건강지원")) +
  theme_minimal(base_size = 13) +
  theme(
    plot.title = element_text(face = "bold", size = 32, hjust = 0.5),
    legend.position = "none",
    axis.text.x = element_text(angle = 0, vjust = 0.8, lineheight = 0.7, size = 18),
    axis.text.y = element_text(size = 18),
    strip.text = element_text(face = "bold", size = 20),
    axis.title.x = element_text(size = 20, margin = margin(t = 18)),
    axis.title.y = element_text(angle = 0, vjust = 0.5, size = 20)
  ) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.15))) +
  coord_cartesian(clip = "off")
```

### 문항40. \[39번 문항에 답변한 경우만 응답\] 교육지원청으로부터 받은 학생성장(사례) 지원이 학교에 도움이 되었습니까?

① 매우 그렇다 ② 그렇다 ③ 보통이다 ④ 그렇지 않다 ⑤ 매우 그렇지 않다

교육지원청으로부터 받은 학생성장(사례) 지원이 되었는지에 대한 문항에 총 응답자는 331건이며 매우 그렇다고 답변한 응답은 134명(40.5%), 그렇다고 답변한 응답은 166명(50.2%), 보통이다라고 답변한 응답은 26명(7.9%), 그렇지 않다고 답변한 응답은 4명(1.2%), 매우 그렇지 않다고 답변한 응답은 1명(0.3%)으로 나타났음

```{r}
#| echo: false
#| message: false
#| warning: false
ques40_freq <- dat %>%
  filter(!is.na(ques_32),
         !is.na(ques_39), 
         !is.na(ques_40),
         str_detect(as.character(ques_32), "3"),  # 32번에서 3번(사례지원) 선택
         ques_40 %in% as.character(1:5)) %>%
  count(ques_40) %>%
  mutate(
    응답 = recode(ques_40,
                 "1" = "매우 그렇다",
                 "2" = "그렇다", 
                 "3" = "보통이다",
                 "4" = "그렇지 않다",
                 "5" = "매우 그렇지 않다"),
    pct = round(n / sum(n) * 100, 1)
  ) %>%
  arrange(desc(n)) %>%
  bind_rows(summarise(., 응답 = "합계", n = sum(n), pct = sum(pct)))

print(ques40_freq %>% select(응답, n, pct), n = Inf)
```

```{r}
#| echo: false
#| message: false
#| warning: false
ggplot(ques40_freq %>% filter(응답 != "합계"), aes(x = reorder(응답, -n), y = n, fill = 응답)) +
  geom_bar(stat = "identity", width = 0.5) +
  geom_text(aes(label = paste0(n, "명 (", pct, "%)")), 
            vjust = -0.6, size = 7) +
  labs(
    title = "학생성장(사례) 지원의 유용성",
    x = "도움 정도",
    y = "응답수"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    plot.title = element_text(size = 32, face = "bold", hjust = 0.5),
    axis.text.x = element_text(angle = 0, vjust = 0.8, lineheight = 0.4, size = 20),
    axis.text.y = element_text(size = 17),
    strip.text = element_text(face = "bold", size = 20),
    axis.title.x = element_text(size = 20, margin = margin(t = 18)),
    axis.title.y = element_text(angle = 0, vjust = 0.5, size = 20),
    legend.position = "none",
    panel.spacing = unit(1.5, "lines"), plot.margin = margin(20, 20, 20, 20)
  ) +
  ylim(0, max(ques40_freq$n) * 1.15)
```

### 문항 40-1. 직책별 학생성장(사례) 지원 유용성 인식 분석

직책별 응답자는 총 32명건이고 이 중에서 학교장은 73명(22.3%), 교감은 100명(30.6%), 교사 등은 154명(47.1%)이었음

학교장 응답 중에서 매우 그렇다는 33명(45.2%), 그렇다는 34명(46.6%), 보통이다는 6명(8.2%)이었음.

교감 응답 중에서 매우 그렇다는 39명(39%), 그렇다는 53명(53%), 보통이다는 7명(7%), 그렇지 않다는 1명(1%)이었음

교사 등 응답 중에서 매우 그렇다는 60명(39%), 그렇다는 78명(50.6%), 보통이다는 12명(7.8%), 그렇지 않다는 3명(1.9%), 매우 그렇지 않다는 1명(0.6%)이었음

```{r}
#| echo: false
#| message: false
#| warning: false
dat_filtered_40 <- dat %>%
  filter(!is.na(ques_32),
         !is.na(ques_39), 
         !is.na(ques_40),
         str_detect(as.character(ques_32), "3"),  # 32번에서 3번 선택 조건 추가
         ques_1 %in% c(1,2,3),      # 학교급 필터
         ques_2 %in% c(1,2),         # 설립유형 필터  
         !is.na(ques_7),             # 직책 필터
         ques_40 %in% as.character(1:5)) %>%
  mutate(
    직책 = case_when(
      ques_7 == 1 ~ "학교장",
      ques_7 == 2 ~ "교감", 
      TRUE ~ "교사 등"
    ),
    사례지원도움정도 = factor(as.character(ques_40),
                       levels = c("1","2","3","4","5"),
                       labels = c("매우 그렇다","그렇다","보통이다","그렇지 않다","매우 그렇지 않다"))
  )

# 직책별 기술통계 (합계 포함)
summary_job_table_40 <- dat_filtered_40 %>%
  group_by(직책, 사례지원도움정도) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  mutate(pct = round(n / sum(n) * 100, 1)) %>%
  ungroup()

summary_job_with_total_40 <- summary_job_table_40 %>%
  group_by(직책) %>%
  summarise(n = sum(n), pct = sum(pct), 사례지원도움정도 = "합계") %>%
  bind_rows(summary_job_table_40) %>%
  arrange(
    factor(직책, levels = c("학교장","교감","교사 등")),
    사례지원도움정도 == "합계",
    if_else(사례지원도움정도 != "합계", -n, 0)
  )

summary_job_final_40 <- summary_job_with_total_40 %>%
  bind_rows(
    summary_job_with_total_40 %>%
      summarise(직책 = "전체 합계", n = sum(n[사례지원도움정도 == "합계"]), pct = 100, 사례지원도움정도 = "합계")
  )

print(summary_job_final_40, n = Inf)

# 카이제곱 검정
tab_job_40 <- table(dat_filtered_40$직책, dat_filtered_40$사례지원도움정도)
chisq_test_job_40 <- chisq.test(tab_job_40)
print(chisq_test_job_40)
```

```{r}
#| echo: false
#| message: false
#| warning: false
# 누적막대그래프
summary_job_plot_40 <- summary_job_table_40 %>%
  mutate(사례지원도움정도 = factor(사례지원도움정도, 
                            levels = c("매우 그렇다", "그렇다", "보통이다", 
                                     "그렇지 않다", "매우 그렇지 않다")))

ggplot(summary_job_plot_40, aes(x = factor(직책, levels = c("학교장", "교감", "교사 등")), 
                                    y = pct, fill = 사례지원도움정도)) +
  geom_bar(stat = "identity", width = 0.7) +
  labs(
    title = "직책별 사례지원 유용성 인식",
    x = "직책",
    y = "비율",
    fill = "사례지원도움정도"
  ) +
  scale_y_continuous(limits = c(0, 100), expand = expansion(mult = c(0, 0.02))) +
  theme_minimal(base_size = 15) +
  theme(
    plot.title = element_text(face = "bold", size = 32, hjust = 0.5),
    axis.text.x = element_text(size = 20, face = "bold"),
    axis.text.y = element_text(size = 18),
    axis.title.x = element_text(size = 25, angle = 0, margin = margin(t = 15)),
    axis.title.y = element_text(size = 20, angle = 0, vjust = 0.5),
    legend.position = "right",
    legend.text = element_text(size = 14),
    legend.title = element_text(size = 16, face = "bold")
  )

```

교육지원청으로부터 받은 학생성장(사례) 지원 유용성에 대한 직책별 평균점수를 비교한 결과, 학교장(4.37), 교감(4.3), 교사 등(4.25)으로 직책별로 평균점수에 유의미한 차이가 나타나지는 않았음

```{r}
#| echo: false
#| message: false
#| warning: false
# ANOVA 분석
dat_score_job_40 <- dat_filtered_40 %>%
  filter(!is.na(ques_40)) %>%
  mutate(
    사례지원도움정도점수 = case_when(
      ques_40 == 1 ~ 5,   # 매우 그렇다
      ques_40 == 2 ~ 4,   # 그렇다
      ques_40 == 3 ~ 3,   # 보통이다
      ques_40 == 4 ~ 2,   # 그렇지 않다
      ques_40 == 5 ~ 1,   # 매우 그렇지 않다
      TRUE ~ NA_real_
    ),
    직책 = factor(직책, levels = c("학교장", "교감", "교사 등"))
  )

job_stats_40 <- dat_score_job_40 %>%
  group_by(직책) %>%
  summarise(
    평균 = round(mean(사례지원도움정도점수, na.rm = TRUE), 2),
    표준편차 = round(sd(사례지원도움정도점수, na.rm = TRUE), 2),
    n = n(),
    .groups = "drop"
  ) %>%
  arrange(직책)

print(job_stats_40)

anova_job_40 <- aov(사례지원도움정도점수 ~ 직책, data = dat_score_job_40)
summary(anova_job_40)

tukey_job_40 <- TukeyHSD(anova_job_40)
print(tukey_job_40)
```

```{r}
#| echo: false
#| message: false
#| warning: false
# 박스플롯
tukey_letters_job_40 <- multcompView::multcompLetters4(anova_job_40, tukey_job_40)
letters_df_job_40 <- data.frame(
  직책 = names(tukey_letters_job_40$`직책`$Letters),
  group = tukey_letters_job_40$`직책`$Letters
)

job_stats_with_groups_40 <- job_stats_40 %>%
  left_join(letters_df_job_40, by = "직책")

ggplot(dat_score_job_40, aes(x = factor(직책, levels = c("학교장", "교감", "교사 등")), y = 사례지원도움정도점수, fill = 직책)) +
  geom_boxplot(alpha = 0.7, width = 0.6, outlier.shape = 21) +
  stat_summary(fun = mean, geom = "point", shape = 23, size = 10, fill = "yellow", stroke = 1) +
  geom_text(data = job_stats_with_groups_40, 
            aes(x = 직책, y = 9, label = paste0(group, "\n(M=", 평균, ")")),
            inherit.aes = FALSE, fontface = "bold", size = 8, vjust = 0) +
  labs(
    title = "직책별 사례지원\n 유용성 인식",
    x = "직책", 
    y = "사례지원의\n 유용성"
  ) +
  theme_minimal(base_size = 15) +
  theme(
    plot.title = element_text(face = "bold", size = 32, hjust = 0.5),
    axis.text.x = element_text(size = 20),
    axis.text.y = element_text(size = 20),
    axis.title.x = element_text(size = 20, margin = margin(t = 15)),
    axis.title.y = element_text(size = 20, angle = 0, vjust = 0.5, lineheight = 0.5),
    legend.position = "none"
  ) +
  scale_y_continuous(expand = expansion(mult = c(0.05, 0.15)))
```

### 문항 40-2. 학교급별 학생성장(사례) 지원 유용성 인식 분석

학교급별 응답자는 327명이고 초등학교 응답자는 148명(45.3%), 중학교 응답자는 127명(38.8%), 고등학교 응답자는 52명(15.9%)이 응답하였음.

초등학교 응답건수 중에서 매우 그렇다는 61명(41.2%), 그렇다는 48명(37.8%), 보통이다는 11명(7.4%), 그렇지 않다는 2명(1.4%)으로 나타남

중학교 응답건수 중에서 매우 그렇다는 48명(37.8%), 그렇다는 67명(52.8%), 보통이다는 10명(7.9%), 그렇지 않다는 2명(1.6%)으로 나타남

고등학교 응답건수 중에서 매우 그렇다는 23명(44.2%), 그렇다는 24명(46.2%), 보통이다는 4명(7.7%), 매우 그렇지 않다는 1명(1.9%)이었음

```{r}
#| echo: false
#| message: false
#| warning: false
# 학교급별 기술통계 (합계 포함)
summary_school_table_40 <- dat_filtered_40 %>%
  group_by(학교급, 사례지원도움정도) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  mutate(pct = round(n / sum(n) * 100, 1)) %>%
  ungroup()

summary_school_with_total_40 <- summary_school_table_40 %>%
  group_by(학교급) %>%
  summarise(n = sum(n), pct = sum(pct), 사례지원도움정도 = "합계") %>%
  bind_rows(summary_school_table_40) %>%
  arrange(
    factor(학교급, levels = c("초등학교","중학교","고등학교")),
    사례지원도움정도 == "합계",
    if_else(사례지원도움정도 != "합계", -n, 0)
  )

summary_school_final_40 <- summary_school_with_total_40 %>%
  bind_rows(
    summary_school_with_total_40 %>%
      summarise(학교급 = "전체 합계", n = sum(n[사례지원도움정도 == "합계"]), pct = 100, 사례지원도움정도 = "합계")
  )

print(summary_school_final_40, n = Inf)

# 카이제곱 검정
tab_school_40 <- table(dat_filtered_40$학교급, dat_filtered_40$사례지원도움정도)
chisq_test_school_40 <- chisq.test(tab_school_40)
print(chisq_test_school_40)
```

```{r}
#| echo: false
#| message: false
#| warning: false
# 누적막대그래프
summary_school_plot_40 <- summary_school_table_40 %>%
  mutate(사례지원도움정도 = factor(사례지원도움정도, 
                            levels = c("매우 그렇다", "그렇다", "보통이다", 
                                     "그렇지 않다", "매우 그렇지 않다")))

ggplot(summary_school_plot_40, aes(x = factor(학교급, levels = c("초등학교", "중학교", "고등학교")), y = pct, fill = 사례지원도움정도)) +
  geom_bar(stat = "identity", width = 0.7) +
  labs(
    title = "학교급별 사례지원 유용성 인식",
    x = "학교급",
    y = "비율",
    fill = "사례지원도움정도"
  ) +
  scale_y_continuous(limits = c(0, 100), expand = expansion(mult = c(0, 0.02))) +
  theme_minimal(base_size = 15) +
  theme(
    plot.title = element_text(size = 32, face = "bold", hjust = 0.5),
    axis.text.x = element_text(size = 18, margin = margin(t = 10)),
    axis.text.y = element_text(size = 18),
    axis.title.x = element_text(size = 20, angle = 0, margin = margin(t = 15)),
    axis.title.y = element_text(size = 20, angle = 0, vjust = 0.5),
    legend.position = "right",
    legend.text = element_text(size = 14),
    legend.title = element_text(size = 16, face = "bold")
  )
```

교육지원청으로부터 받은 학생성장(사례) 지원 유용성에 대한 학교급별 평균 점수를 비교한 결과, 초등학교(4.31), 중학교(4.27), 고등학교(4.31) 학교급별로 평균점수에 유의미한 차이가 나타나지는 않았음

```{r}
#| echo: false
#| message: false
#| warning: false
# 학교급별 ANOVA
school_stats_40 <- dat_score_job_40 %>%
  mutate(학교급 = factor(학교급, levels = c("초등학교", "중학교", "고등학교"))) %>%
  group_by(학교급) %>%
  summarise(
    평균 = round(mean(사례지원도움정도점수, na.rm = TRUE), 2),
    표준편차 = round(sd(사례지원도움정도점수, na.rm = TRUE), 2),
    n = n(),
    .groups = "drop"
  ) %>%
  arrange(학교급)

print(school_stats_40)

anova_school_40 <- aov(사례지원도움정도점수 ~ 학교급, data = dat_score_job_40)
summary(anova_school_40)

tukey_school_40 <- TukeyHSD(anova_school_40)
print(tukey_school_40)
```

```{r}
#| echo: false
#| message: false
#| warning: false
# 박스플롯
tukey_letters_school_40 <- multcompView::multcompLetters4(anova_school_40, tukey_school_40)
letters_df_school_40 <- data.frame(
  학교급 = names(tukey_letters_school_40$`학교급`$Letters),
  group = tukey_letters_school_40$`학교급`$Letters
)

school_stats_with_groups_40 <- school_stats_40 %>%
  left_join(letters_df_school_40, by = "학교급")

ggplot(dat_score_job_40, aes(x = factor(학교급, levels = c("초등학교", "중학교", "고등학교")), y = 사례지원도움정도점수, fill = 학교급)) +
  geom_boxplot(alpha = 0.7, width = 0.6, outlier.shape = 21) +
  stat_summary(fun = mean, geom = "point", shape = 23, size = 10, fill = "yellow", stroke = 1) +
  geom_text(data = school_stats_with_groups_40, 
            aes(x = 학교급, y = 10, label = paste0(group, "\n(M=", 평균, ")")),
            inherit.aes = FALSE, fontface = "bold", size = 8, vjust = 0, lineheight=0.5) +
  labs(
    title = "학교급별 사례지원\n 유용성 인식",
    x = "학교급", 
    y = "사례지원\n유용성"
  ) +
  theme_minimal(base_size = 15) +
  theme(
    plot.title = element_text(face = "bold", size = 32, hjust = 0.5),
    axis.text.x = element_text(size = 20),
    axis.text.y = element_text(size = 20),
    axis.title.x = element_text(size = 20, margin = margin(t = 15)),
    axis.title.y = element_text(size = 20, angle = 0, vjust = 0.5, lineheight = 0.5),
    legend.position = "none"
  ) +
  scale_y_continuous(expand = expansion(mult = c(0.05, 0.15)))
```

### 문항 40-3. 설립별 학생성장(사례) 지원 유용성 인식 분석

설립별 응답자는 327건이고 공립학교 응답자는 262명(80.1%), 사립학교 응답자는 65명(19.9%)이 응답하였음.

공립학교 응답건수 중에서 매우 그렇다는 103명(39.3%), 그렇다는 133명(50.8%), 보통이다는 22명(8.4%), 그렇지 않다는 4명(1.5%)이었음

사립학교 응답건수 중에서 매우 그렇다는 29명(44.6%), 그렇다는 32명(49.2%), 보통이다는 3명(4.6%), 매우 그렇지 않다는 1명(1.5%)이었음

```{r}
#| echo: false
#| message: false
#| warning: false
## 4. 설립별 분석

# 설립별 데이터 준비
dat_found_40 <- dat_filtered_40 %>%
  filter(설립 %in% c("공립", "사립")) %>%
  mutate(설립 = factor(설립, levels = c("공립", "사립")))

# 설립별 기술통계 (합계 포함)
summary_found_table_40 <- dat_found_40 %>%
  group_by(설립, 사례지원도움정도) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  mutate(pct = round(n / sum(n) * 100, 1)) %>%
  ungroup()

summary_found_with_total_40 <- summary_found_table_40 %>%
  group_by(설립) %>%
  summarise(n = sum(n), pct = sum(pct), 사례지원도움정도 = "합계") %>%
  bind_rows(summary_found_table_40) %>%
  arrange(설립, 사례지원도움정도 == "합계", if_else(사례지원도움정도 != "합계", -n, 0))

summary_found_final_40 <- summary_found_with_total_40 %>%
  bind_rows(
    summary_found_with_total_40 %>%
      summarise(설립 = "전체 합계", n = sum(n[사례지원도움정도 == "합계"]), pct = 100, 사례지원도움정도 = "합계")
  )

print(summary_found_final_40, n = Inf)

# 카이제곱 검정
tab_found_40 <- table(dat_found_40$설립, dat_found_40$사례지원도움정도)
chisq_test_found_40 <- chisq.test(tab_found_40)
print(chisq_test_found_40)
```

```{r}
#| echo: false
#| message: false
#| warning: false
# 누적막대그래프
summary_found_plot_40 <- summary_found_table_40 %>%
  mutate(사례지원도움정도 = factor(사례지원도움정도, 
                            levels = c("매우 그렇다", "그렇다", "보통이다", 
                                     "그렇지 않다", "매우 그렇지 않다")))

ggplot(summary_found_plot_40, aes(x = 설립, y = pct, fill = 사례지원도움정도)) +
  geom_bar(stat = "identity", width = 0.7) +
  labs(
    title = "설립별 사례지원 도움정도 인식",
    x = "설립",
    y = "비율",
    fill = "사례지원도움정도"
  ) +
  scale_y_continuous(limits = c(0, 100), expand = expansion(mult = c(0, 0.02))) +
  theme_minimal(base_size = 15) +
  theme(
    plot.title = element_text(size = 32, face = "bold", hjust = 0.5),
    axis.text.x = element_text(size = 18, margin = margin(t = 10)),
    axis.text.y = element_text(size = 18),
    axis.title.x = element_text(size = 20, angle = 0, margin = margin(t = 15)),
    axis.title.y = element_text(size = 20, angle = 0, vjust = 0.5),
    legend.position = "right",
    legend.text = element_text(size = 18),
    legend.title = element_text(size = 20, face = "bold")
  )
```

교육지원청으로부터 받은 학생성장(사례) 지원 유용성에 대한 학교급별 평균 점수를 비교한 결과, 공립학교(4.28), 사립학교(4.35) 간 평균점수에 유의미한 차이가 나타나지는 않았음

```{r}
#| echo: false
#| message: false
#| warning: false
# T-test 분석
dat_score_found_40 <- dat_found_40 %>%
  mutate(
    사례지원도움정도점수 = case_when(
      ques_40 == 1 ~ 5,   # 매우 그렇다
      ques_40 == 2 ~ 4,   # 그렇다
      ques_40 == 3 ~ 3,   # 보통이다
      ques_40 == 4 ~ 2,   # 그렇지 않다
      ques_40 == 5 ~ 1,   # 매우 그렇지 않다
      TRUE ~ NA_real_
    )
  )

found_stats_40 <- dat_score_found_40 %>%
  group_by(설립) %>%
  summarise(
    평균 = round(mean(사례지원도움정도점수, na.rm = TRUE), 2),
    표준편차 = round(sd(사례지원도움정도점수, na.rm = TRUE), 2),
    n = n(),
    .groups = "drop"
  )

print(found_stats_40)

# T-test
t_test_result_40 <- t.test(사례지원도움정도점수 ~ 설립, data = dat_score_found_40, var.equal = FALSE)
print(t_test_result_40)
```

```{r}
#| echo: false
#| message: false
#| warning: false
# 박스플롯
if(t_test_result_40$p.value < 0.05) {
  establishment_groups_40 <- data.frame(
    설립 = c("공립", "사립"),
    group = c("a", "b")
  )
} else {
  establishment_groups_40 <- data.frame(
    설립 = c("공립", "사립"),
    group = c("a", "a")
  )
}

found_stats_with_groups_40 <- found_stats_40 %>%
  left_join(establishment_groups_40, by = "설립")

ggplot(dat_score_found_40, aes(x = 설립, y = 사례지원도움정도점수, fill = 설립)) +
  geom_boxplot(alpha = 0.7, width = 0.6, outlier.shape = 21) +
  stat_summary(fun = mean, geom = "point", shape = 23, size = 10, fill = "yellow", stroke = 1) +
  geom_text(data = found_stats_with_groups_40, 
            aes(x = 설립, y = 10, label = paste0(group, "\n(M=", 평균, ")")),
            inherit.aes = FALSE, fontface = "bold", size = 10, vjust = 0, lineheight=0.5) +
  labs(
    title = "설립별 사례지원\n 유용성 인식",
    x = "설립", 
    y = "사례지원\n 유용성"
  ) +
  theme_minimal(base_size = 15) +
  theme(
    plot.title = element_text(face = "bold", size = 32, hjust = 0.5),
    axis.text.x = element_text(size = 20),
    axis.text.y = element_text(size = 20,lineheight=0.5),
    axis.title.x = element_text(size = 20, margin = margin(t = 15)),
    axis.title.y = element_text(size = 20, angle = 0, vjust = 0.5, lineheight=0.5),
    legend.position = "none"
  ) +
  scale_y_continuous(expand = expansion(mult = c(0.05, 0.15)))
```

### 문항41. 학생맞춤통합지원 체계운영을 통한 긍정적인 효과 또는 우수사례에 대해서 작성하여 주시기 바랍니다. (주관식)

학생맞춤통합지원 체계운영을 통해 긍정적인 효과 또는 우수사례와 대한 문항에서 조기발견과 관련한 답변은 463건(43.9%), 통합지원 체계마련이라는 답변은 368건(.4.9%), 심리정서 지원이라는 답변은 110건(10.4%), 건강복지 지원이라는 답변은 66건(6.3%) 등으로 나타남

```{r}
#| echo: false
#| message: false
#| warning: false
# 패키지
suppressPackageStartupMessages({
  library(dplyr)
  library(stringr)
  library(tidyr)
  library(ggplot2)
})

# ----- 0) 사용자 설정 -----

# (A) 전체 응답에서 '통째로 제외'할 표현 (무응답류)
ban_full <- c("해당없음","없음","무응답","모름","잘모르겠","잘 모르겠", "\\.{1,}")  # ... 같은 점 몇개도 제거

# (B) 텍스트 안에서 '치환/삭제'할 관용구(사업명/형식문구 등) - 분석 전 텍스트에서 제거
drop_phrases <- c(
  "학생맞춤통합지원", "도움[이가] 필요한", "지원이 필요", "필요하다고 생각",
  "도움이 필요", "필요함", "필요함니다", "필요합니다", "있습니다", "없습니다","해당 무","미운영"
)

# (C) 토큰(단어) 단위에서 제거할 불용어(빈도표에서 제외)
stop_tokens <- c(
  # 매우 일반적인 불용어
  "학생","학생에게", "학생의", "학생들의", "학생들이","학생에게","학생들에게","지원이", "지원할", "지원을을", "필요","도움","사업","학교","교육","관련","활동","운영","필요성",
  "함","함니다","합니다","됨","된다","것","수","등","및","통해","통한","대한","대해","위한","위해",
  "개선","확대","강화","진행","필요하","필요하다고","생각","생각함","있을", "지원이", "다양한",
  # 사용자 요청으로 꼭 빼달라 하신 표현들
  "학생맞춤통합지원","도움이","필요한","지원필요","필요하다고","필요합니다", "없습니다", "것이", "아직", "있어서", "있습니다"
)

# (D) 41번용 카테고리 사전(원하시면 키워드 계속 추가)
dict41 <- list(
  "조기발견"            = c("개입","위기","지원","보호","중재", "이해","공유","학생지원","점검","파악으로","파악","복합적인","관리",
                        "관찰", "정보공유","모색","학생에 대한","어려움","복합","혼자","공유를","공유로","정보공유로","위기학생",
                        "지원이 필요한", "도움이 필요한", "필요한 학생에게", "필요한 학생", "겪는 학생들을"),
  "학습진로 지원"       = c("학습","수업","진로","학업","지도","멘토링"),
  "심리정서 지원"       = c("정서","정서적", "심리","행동","치유","상담","불안","우울","심리적",
                      "적응력", "자신감","적응", "정서행동", "상담지원","학교적응력","위센터"),
  "안전생활 지원"       = c("안전","폭력","학교폭력","아동학대","성폭력","중독","자해","위험"),
  "건강복지 지원"       = c("건강","위생","영양","운동","스트레스","수면","복지","의료","식사", "경제적","수급","기초수급","경제적지원"),
  "통합지원 체계마련"   = c("협력","소통", "연계","다각도", "지역","유관기관","센터","의뢰","네트워크","연계를",
                    "자원 능력", "연계하여", "연수","효율성","효과","잘 운영","지역연계", "체계", "체계적인",
                    "효율적","통합","시스템","구축","협력하여","협력으로","컨설팅", "통합지원", "체제","컨트롤타워","컨트롤타워가",
                    "인식개선", "연계한", "협업","일괄적인","함께","맞춤형", "상황에 맞는", "유기적","효율적인",
                    "잘 운영되고", "다각적인", "다각적","구성원간 협력","협력을","교육복지센터","축소",
                    "지원이 가능", "지원이 가능함", "공감대 형성", "학생에게 필요한", "학생에 대해",
                    "이루어지고 있음", "학생에게 필요한", "맞춤 지원이", "운영하고 있음", "지원을 통해", "학생에게 실질적인"))


# ── 1) 헬퍼 함수 ─────────────────────────────────────────
esc <- function(x) stringr::str_replace_all(x, "([\\^$.|()?*+\\[\\]{}\\\\])","\\\\\\1")
key_to_regex <- function(keys){
  paste0("(?<![가-힣A-Za-z0-9])(", paste(esc(keys), collapse="|"), ")(?![가-힣A-Za-z0-9])")
}

# 문장전처리
clean_sentences <- function(x, ban_full, drop_phrases){
  x <- as.character(x); x <- x[!is.na(x)]
  x <- stringr::str_squish(x)
  if (length(x) == 0) return(character(0))
  # 통째로 제외
  pat_ban <- paste0("(", paste(ban_full, collapse="|"), ")")
  x <- x[!stringr::str_detect(x, stringr::regex(pat_ban))]
  if (length(x) == 0) return(character(0))
  # 상투구 제거
  if (length(drop_phrases) > 0) {
    pat_drop <- key_to_regex(drop_phrases)
    x <- stringr::str_replace_all(x, stringr::regex(pat_drop), " ")
  }
  # 특수문자 제거 + 공백 정리 + 너무 짧은 것 제거
  x <- stringr::str_replace_all(x, "[^가-힣A-Za-z0-9\\s]", " ")
  x <- stringr::str_squish(x)
  x <- x[nchar(x) >= 2 & nzchar(x)]
  x
}

# 2글자 이상 한글 토큰화(간이) — 동사어미 대부분 자연히 소거됨
tokenize_ko2 <- function(sentences){
  if (length(sentences) == 0) return(tibble::tibble(doc=integer(), token=character()))
  tibble::tibble(doc = seq_along(sentences), text = sentences) |>
    dplyr::mutate(tokens = stringr::str_extract_all(text, "[가-힣]{2,}")) |>
    tidyr::unnest(tokens) |>
    dplyr::transmute(doc, token = tokens) |>
    dplyr::filter(!is.na(token), nzchar(token))
}

# 토큰 빈도표
count_tokens <- function(tokens_tbl, stop = NULL){
  out <- tokens_tbl
  if (!is.null(stop) && length(stop) > 0){
    pat_stop <- key_to_regex(stop)
    out <- dplyr::filter(out, !stringr::str_detect(token, stringr::regex(pat_stop)))
  }
  dplyr::count(out, token, name="n", sort=TRUE)
}

count_keys <- function(s, keys){
  pat <- key_to_regex(keys)
  as.integer(isTRUE(stringr::str_detect(s, stringr::regex(pat))))
}

# 멀티라벨 집계
count_by_categories <- function(sentences, dict){
  if (length(sentences) == 0) return(tibble::tibble(category=character(), n=integer(), pct=numeric()))
  names_dict <- names(dict)
  row_df <- purrr::map_dfr(sentences, function(s){
    vals <- purrr::map_int(dict, ~ count_keys(s, .x))
    tibble::as_tibble_row(vals) |> rlang::set_names(names_dict)
  })
  counts <- colSums(as.matrix(row_df), na.rm = TRUE)
  tibble::tibble(category = names(counts), n = as.integer(counts)) |>
    dplyr::arrange(dplyr::desc(n)) |>
    dplyr::mutate(pct = round(n / sum(n) * 100, 1))
}

# Top1 배정
classify_top1 <- function(sentences, dict){
  if (length(sentences) == 0) return(tibble::tibble(category=character(), n=integer(), pct=numeric()))
  top1 <- purrr::map_chr(sentences, function(s){
    scores <- purrr::map_int(dict, ~ count_keys(s, .x))
    if (all(scores == 0L)) "기타" else names(dict)[which.max(scores)]
  })
  tibble::tibble(category = top1) |>
    dplyr::count(category, name="n", sort=TRUE) |>
    dplyr::mutate(pct = round(n / sum(n) * 100, 1))
}

## ---- (1) 텍스트 클린 → 멀티라벨 빈도 (기타 제외) ----

QCOL  <- "ques_41"       # <- 42번 돌릴 땐 "ques_42" 로만 바꾸면 됨
QNAME <- "문항 41"

#   * 총 유효응답 수와 '사전 미적합(=기타 후보)' 수도 같이 출력
txt_raw   <- dat[[QCOL]]
txt_clean <- clean_sentences(txt_raw, ban_full, drop_phrases)        # ← 기존 헬퍼 사용
N_valid   <- length(txt_clean)


# 멀티라벨(한 문장이 여러 카테고리 기여) 집계
freq_multi <- count_by_categories(txt_clean, dict41)                  # ← 기존 헬퍼 사용

# '사전 미적합(=기타 후보)' 문장 수 계산
# (각 문장에서 dict41 어떤 키워드도 안 맞으면 '기타')
matched_any <- vapply(txt_clean, function(s){
  any(vapply(dict41, function(keys){
    count_keys(s, keys) > 0L
  }, logical(1)))
}, logical(1))
n_misc <- sum(!matched_any)

# ✅ 총 갯수 정보 출력
cat("\n=== 문항 41 텍스트 분석 결과 ===\n")
cat("원본 응답 수:", length(txt_raw[!is.na(txt_raw)]), "개\n")
cat("유효 응답 수:", N_valid, "개\n")
cat("총 분류항목 매칭 수:", sum(freq_multi$n), "개\n")

# 41번 문항 영역별 응답 합계 추가 (42번 스타일)
freq_multi_with_total <- freq_multi %>%
  bind_rows(
    tibble(
      category = "합계",
      n = sum(freq_multi$n),
      pct = 100.0
    )
  )

# 합계 포함 결과 출력
print(freq_multi_with_total)
```

```{r}
#| echo: false
#| message: false
#| warning: false

# 41번 문항 막대그래프 수정 (데이터 레이블 침범 방지)
p_multi <- freq_multi %>%
  filter(n > 0) %>%
  mutate(category = factor(category, levels = rev(category))) %>%
  ggplot(aes(x = category, y = n)) +
  geom_col(width = 0.37, fill = "#2E8B57", alpha = 0.9) +
  geom_text(aes(label = paste0(n, " (", pct, "%)")), 
            hjust = 0.5, vjust = -0.5, size = 6, fontface = "bold") +  # hjust=0.5 (중앙), vjust=-0.3 (막대 위)
  coord_flip() +
  labs(title = sprintf("%s. 긍정적인 효과\n 또는 사례분야", QNAME),
       x = "우수사례 분야", y = "응답수") +
  scale_y_continuous(expand = expansion(mult = c(0, 0.25))) +
  theme_minimal(base_size = 13) +
  theme(plot.title = element_text(face="bold", size=32, hjust=0.5, lineheight = 0.5),
        axis.text.x = element_text(size = 18, margin = margin(t = 10)),
        axis.text.y = element_text(size = 18),
        axis.title.x = element_text(size = 20, angle = 0, margin = margin(t = 15)),
        axis.title.y = element_text(size = 20, angle = 0, vjust = 0.5),
        plot.margin = margin(20, 30, 20, 20)
  ) +
  coord_cartesian(clip = "off")

print(p_multi)
```

```{r}
#| echo: false
#| message: false
#| warning: false
tokens_all <- tokenize_ko2(txt_clean)                                # ← 기존 헬퍼 사용
freq_tok   <- count_tokens(tokens_all, stop = stop_tokens)           # ← 기존 헬퍼 사용

top20_tbl <- freq_tok %>%
  slice_max(n, n = 20) %>%
  mutate(token = factor(token, levels = rev(token)))

if (requireNamespace("wordcloud", quietly = TRUE) &&
    requireNamespace("RColorBrewer", quietly = TRUE)) {
  if (.Platform$OS.type == "windows") {
    suppressWarnings(try(windowsFonts(malgun = windowsFont("Malgun Gothic")), silent = TRUE))
    par(family = "malgun")
  }
  
  # ✅ 여백 조정 - 위쪽 여백을 늘려서 타이틀 공간 확보
  par(mar = c(3, 3, 8, 3))  # bottom, left, top, right 여백
  
  with(freq_tok, wordcloud::wordcloud(
    words = token, freq = n,
    min.freq = max(2, floor(0.005 * nrow(freq_tok))),
    max.words = 150, random.order = FALSE, rot.per = 0.1,
    colors = RColorBrewer::brewer.pal(8, "Dark2"),
    scale = c(20, 3)  # ✅ 글씨 크기 대폭 증가
  ))
  
        
} else {
  message("wordcloud / RColorBrewer 패키지가 없어 워드클라우드는 건너뜁니다.")
}
```

### 문항42. 학생맞춤통합지원 체계가 발전할 수 있도록 제언하시거나 의견을 작성하여 주시기 바랍니다. (주관식)

학생맞춤통합지원 체계가 발전할 수 있도록 제언 또는 의견과 관련해서 인력ㆍ예산ㆍ행정에 관한 요청은 123건(25.5%), 인식ㆍ홍보ㆍ연수에 관한 요청은 123건(25.5%), 조기발견ㆍ사례관리에 관한 요청은 88건(18.3%), 지역연계ㆍ기관협력에 관한 요청은 66건(13.7%), 체계ㆍ지침ㆍ제도에 관한 요청은 40건(8.3%) 등으로 나타났음

```{r}
#| echo: false
#| message: false
#| warning: false
# ---- (0) 분석 대상 문항 선택 ----
QCOL  <- "ques_42"       # <- 42번 돌릴 땐 "ques_42" 로만 바꾸면 됨
QNAME <- "문항 42"

if (!exists("ban_full")) ban_full <- c(
  "해당없음","없음","무응답","모름","잘모르겠","잘 모르겠","미응답","무", "있도록", "또는",
  "\\.{1,}"                 # "..." 같은 점만 있는 응답 제거
)

if (!exists("drop_phrases")) drop_phrases <- c(
  # 42번 텍스트에서 분석 의미가 약한 상투구/형식 문구 (원하면 추가/수정)
  "학생맞춤통합지원","도움[이가] 필요한","지원이 필요","필요하다고 생각",
  "필요함","필요합니다","있습니다","없습니다", "있도록", "지속적인"
)

if (!exists("stop_tokens")) stop_tokens <- c(
  # 매우 일반적인 불용어(필요 시 가감)
  "학생","학생들","학생의","학교","교육","지원","사업","필요","도움",
  "관련","운영","개선","강화","확대","진행","것","수","등","및","위해",
  "통해","대한","대해","있다","하다","됨","된다","했습니다","했습니다만",
  # 요청: 사업명/형식문구류
  "학생맞춤통합지원","도움이","필요한","필요합니다","없습니다","있습니다"
)

# 42번용 카테고리 사전(멀티라벨용) — 필요 시 어휘 추가/수정
dict42 <- list(
  "조기발견·사례관리"  = c("조기","발굴","파악","식별","사례","관리","개입","중재","연계","의뢰"),
  "학습·진로지원"      = c("학습","학업","수업","보충","멘토링","진로","진학","상담"),
  "심리정서·행동지원"  = c("정서","심리","행동","불안","우울","상담","치유","회복","적응"),
  "건강·복지지원"      = c("건강","위생","영양","운동","수면","스트레스","복지","의료","경제적"),
  "지역연계·기관협력"  = c("지역","기관","센터","복지관","경찰","병원","연계","협력","네트워크"),
  "체계·지침·제도"     = c("체계","시스템","지침","가이드","규정","제도","컨트롤타워","프로세스"),
  "인력·예산·행정"     = c("인력","전담","예산","재정","행정","서류","공문","시간","과중","부담"),
  "인식·홍보·연수"     = c("인식","홍보","연수","교육","캠페인","안내","설명회","워크숍")
)

# ----- 1) 헬퍼 함수 -----
esc <- function(x) str_replace_all(x, "([\\^$.|()?*+\\[\\]{}\\\\])","\\\\\\1")
key_to_regex <- function(keys){
  paste0("(?<![가-힣A-Za-z0-9])(", paste(esc(keys), collapse="|"), ")(?![가-힣A-Za-z0-9])")
}

clean_sentences <- function(x, ban_full, drop_phrases){
  x <- as.character(x)
  x <- x[!is.na(x)]
  x <- str_squish(x)
  if (length(x) == 0) return(character(0))
  # 통째로 제외(무응답류)
  pat_ban <- paste0("(", paste(ban_full, collapse="|"), ")")
  x <- x[!str_detect(x, regex(pat_ban))]
  if (length(x) == 0) return(character(0))
  # 상투구 제거
  if (length(drop_phrases) > 0) {
    pat_drop <- key_to_regex(drop_phrases)
    x <- str_replace_all(x, regex(pat_drop), " ")
  }
  # 특수문자 제거 + 공백 정리 + 아주 짧은 응답 제거
  x <- str_replace_all(x, "[^가-힣A-Za-z0-9\\s]", " ")
  x <- str_squish(x)
  x <- x[nchar(x) >= 2 & nzchar(x)]
  x
}

tokenize_ko2 <- function(sentences){
  if (length(sentences) == 0) return(tibble(doc=integer(), token=character()))
  tibble(doc = seq_along(sentences), text = sentences) %>%
    mutate(tokens = str_extract_all(text, "[가-힣]{2,}")) %>%
    unnest(tokens) %>%
    transmute(doc, token = tokens) %>%
    filter(!is.na(token), nzchar(token))
}

count_tokens <- function(tokens_tbl, stop = NULL){
  out <- tokens_tbl
  if (!is.null(stop) && length(stop) > 0){
    pat_stop <- key_to_regex(stop)
    out <- filter(out, !str_detect(token, regex(pat_stop)))
  }
  count(out, token, name="n", sort=TRUE)
}

count_keys <- function(s, keys){
  pat <- key_to_regex(keys)
  as.integer(isTRUE(str_detect(s, regex(pat))))
}

# 멀티라벨 집계
count_by_categories <- function(sentences, dict){
  if (length(sentences) == 0) return(tibble(category=character(), n=integer(), pct=numeric()))
  names_dict <- names(dict)
  row_df <- map_dfr(sentences, function(s){
    vals <- map_int(dict, ~ count_keys(s, .x))
    tibble::as_tibble_row(vals) |> rlang::set_names(names_dict)
  })
  counts <- colSums(as.matrix(row_df), na.rm = TRUE)
  tibble(category = names(counts), n = as.integer(counts)) |>
    arrange(desc(n)) |>
    mutate(pct = round(n / sum(n) * 100, 1))
}

# Top1 단일 분류
classify_top1 <- function(sentences, dict){
  if (length(sentences) == 0) return(tibble(category=character(), n=integer(), pct=numeric()))
  top1 <- map_chr(sentences, function(s){
    scores <- map_int(dict, ~ count_keys(s, .x))
    if (all(scores == 0L)) "기타" else names(dict)[which.max(scores)]
  })
  tibble(category = top1) |>
    count(category, name="n", sort=TRUE) |>
    mutate(pct = round(n / sum(n) * 100, 1))
}

# ----- 2) 본분석(ques_42) -----
q42_raw   <- dat$ques_42
q42_clean <- clean_sentences(q42_raw, ban_full, drop_phrases)

# 기술통계 출력 추가
N_raw_42 <- length(q42_raw[!is.na(q42_raw)])  # 원본 응답 수
N_valid_42 <- length(q42_clean)               # 전처리 후 유효 응답 수


# 2-1) 멀티라벨 빈도(기타 제외 표시 + 총합 확인)
freq42_multi <- count_by_categories(q42_clean, dict42)
total_labeled <- sum(freq42_multi$n)  # 멀티라벨 총 카운트(문장 1개가 복수 카테고리에 기여)

# '기타' 문장 수 계산 (사전 미적합)
classified_top1 <- classify_top1(q42_clean, dict42)
n_misc_42 <- classified_top1 %>% filter(category == "기타") %>% pull(n)
if(length(n_misc_42) == 0) n_misc_42 <- 0

# 간단한 기술통계 출력
cat("\n=== 문항 42 텍스트 분석 결과 ===\n")
cat("원본 응답 수:", N_raw_42, "개\n")
cat("유효 응답 수:", N_valid_42, "개\n")
cat("총 분류항목 매칭 수:", sum(freq42_multi$n), "개\n\n")

# 합계 행 추가된 멀티라벨 결과
freq42_multi_with_total <- freq42_multi %>%
  bind_rows(
    tibble(
      category = "합계",
      n = sum(freq42_multi$n),
      pct = 100.0
    )
  )

# (보고용) 기타 제외한 막대
freq42_multi_no_etc <- freq42_multi %>% filter(category != "기타")
print(freq42_multi_with_total)
```

```{r}
#| echo: false
#| message: false
#| warning: false
# 42번 문항 세로 막대그래프 (데이터 레이블 개선)
p_multi_42 <- freq42_multi_no_etc %>%
  filter(n > 0) %>%
  mutate(category = factor(category, levels = category[order(n)])) %>%
  ggplot(aes(x = category, y = n)) +
  geom_col(width = 0.6, fill = "#2E8B57", alpha = 0.9) +
  geom_text(aes(label = paste0(n, " (", pct, "%)")), 
            vjust = -0.5, size = 5.5, fontface = "bold") +  # 글씨 크기 5→8로 증가
  labs(title = sprintf("%s. 학생맞춤통합지원 체계\n발전을 위한 제언", QNAME),
       x = "개선·발전 분야", y = "응답수") +
  scale_y_continuous(expand = expansion(mult = c(0, 0.15))) +
  theme_minimal(base_size = 13) +
  theme(
    plot.title = element_text(face="bold", size=28, hjust=0.5, lineheight = 0.5),
    axis.text.x = element_text(size = 17, angle = 45, hjust = 1, margin = margin(t = 10)),
    axis.text.y = element_text(size = 16),
    axis.title.x = element_text(size = 22, margin = margin(t = 15)),
    axis.title.y = element_text(size = 22, angle = 0, vjust = 0.5, margin = margin(r = 15)), # angle=0으로 가로 설정
    plot.margin = margin(20, 20, 20, 20)
  ) +
  coord_cartesian(clip = "off")

print(p_multi_42)
```

```{r}
#| echo: false
#| message: false
#| warning: false
# ---- (3) 기존 막대그래프 데이터로 워드클라우드 ----
if (requireNamespace("wordcloud", quietly = TRUE) &&
    requireNamespace("RColorBrewer", quietly = TRUE)) {
  if (.Platform$OS.type == "windows") {
    suppressWarnings(try(windowsFonts(malgun = windowsFont("Malgun Gothic")), silent = TRUE))
    par(family = "malgun")
  }
  
  # 여백 최소화
  par(mar = c(0.5, 0.5, 0.5, 0.5))
  
  # ✅ 기존 막대그래프와 동일한 데이터 사용
  with(freq42_multi_no_etc, wordcloud::wordcloud(
    words = category, freq = n,
    min.freq = 1,  # 모든 카테고리 표시
    max.words = 20, random.order = FALSE, rot.per = 0.2,
    colors = RColorBrewer::brewer.pal(8, "Dark2"),
    scale = c(8, 2)  # 크기를 조금 줄여서 긴 카테고리명도 들어가게
  ))
  
} else {
  message("wordcloud / RColorBrewer 패키지가 없어 워드클라우드는 건너뜁니다.")
}
```

# 7. 학교 유형 분류

설문 문항 중에서 학생맞춤통합지원 정책에 대한 인식도, 홍보 필요성, 교육구성원 간 협력의 중요성, 원활성에 대한 평가, 학생맞춤통합지원팀 운영횟수, 학생맞춤통합지원팀이 지원한 학생수 문항을 활용하여 군집분석을 실시하고 학교 특성을 분류하였음. 응답자는 학교별 중복응답자를 제외한 1,155명을 대상으로 분석을 실시하였음.

```{r}
#| echo: false
#| message: false
#| warning: false


library(dplyr)
library(cluster)
library(factoextra)
library(ggplot2)

# 학교별 대표 응답자 선정 및 점수 체계 수정
dat_cluster <- dat %>%
  filter(!is.na(ques_12)) %>%
  mutate(
    우선순위 = case_when(
      ques_7 == "2" ~ 1,  # 교감
      ques_7 == "1" ~ 2,  # 교장  
      ques_7 == "3" ~ 3,  # 교사
      ques_7 == "4" ~ 4,  # 상담교사
      ques_7 == "8" ~ 5,  # 지역사회교육전문가
      ques_7 == "9" ~ 6,  # 상담사
      ques_7 == "5" ~ 7,  # 보건교사
      TRUE ~ 8
    )
  ) %>%
  group_by(학교아이디) %>%  
  arrange(우선순위) %>%
  slice(1) %>%
  ungroup() %>%
  filter(!is.na(ques_19), !is.na(ques_20),
         !is.na(ques_9), !is.na(ques_11),
         !is.na(ques_28), !is.na(ques_29)) %>%
  mutate(
    학교급 = recode(as.character(ques_1),
                 "1" = "초등학교",
                 "2" = "중학교", 
                 "3" = "고등학교",
                 "4" = "특수학교",
                 "5" = "각종학교"),
    # 점수 체계 수정: 1번=5점, 2번=4점, 3번=3점, 4번=2점, 5번=1점
    정책인지도 = 6 - as.numeric(ques_9),
    홍보충분성 = 6 - as.numeric(ques_11),
    협력중요성 = 6 - as.numeric(ques_28),
    협력실행도 = 6 - as.numeric(ques_29),
    # 팀운영횟수 실제 값으로 변환 (19번 문항)
    팀운영횟수 = case_when(
      ques_19 == "1" ~ 1,    # 1회
      ques_19 == "2" ~ 2,    # 2회
      ques_19 == "3" ~ 3,    # 3회
      ques_19 == "4" ~ 4,    # 4회
      ques_19 == "5" ~ 5,    # 5회 이상 → 5로 설정
      ques_19 == "6" ~ 0,    # 미실시 → 0으로 설정
      TRUE ~ NA_real_
    ),
    # 지원학생수 실제 값으로 변환 (20번 문항)
    지원학생수 = case_when(
      ques_20 == "1" ~ 1,    # 1명
      ques_20 == "2" ~ 2,    # 2명
      ques_20 == "3" ~ 3,    # 3명
      ques_20 == "4" ~ 4,    # 4명
      ques_20 == "5" ~ 5,    # 5명 이상 → 5로 설정
      ques_20 == "6" ~ 0,    # 없음 → 0으로 설정
      TRUE ~ NA_real_
    ),
    직책 = case_when(
      ques_7 == "1" ~ "교장",
      ques_7 == "2" ~ "교감",
      TRUE ~ "교사등"
    )
  )

cat("군집분석 대상 학교 수:", nrow(dat_cluster), "개교\n")
```

학교 그룹은 최적군집수 분류결과에 따라 다음과 같이 3개 그룹으로 분류하였음

1 그룹: 정책인식도 및 취지에 대한 이해도가 상대적으로 낮고, 통합지원팀 운영도 원활하지 않은 학교

2 그룹: 정책인식도 및 취지에 대한 이해도는 높으나, 통합지원팀 운영은 원활하지 않은 학교

3 그룹: 정책인지도 및 취지에 대한 이대도도 높고, 통합지원팀 운영도 활성화 된 학교

```{r}
#| echo: false
#| message: false
#| warning: false

# 군집분석용 변수 추출 및 표준화
cluster_vars <- dat_cluster %>% 
  select(정책인지도, 홍보충분성, 협력중요성, 협력실행도, 팀운영횟수, 지원학생수)

cluster_scaled <- scale(cluster_vars)

# 최적 군집 수 결정 (Elbow Method)
fviz_nbclust(cluster_scaled, kmeans, method = "wss") +
  labs(title = "최적 군집 수 결정 (Elbow Method)")
```

학교별 유형은 3개 유형으로 분류하였으며, 1그룹은 정책인지도, 정책 홍보의 충분성에 대한 인식, 협력중요성에 대한 인식, 협력 실행이 원활한지에 대해서 가장 평균점수가 낮은 그룹에 해당함. 2그룹은 학생맞춤통합지원팀의 운영횟수가 지원학생수가 가장 적은 그룹이며, 3그룹은 학생맞춤통합지원팀 운영횟수와 지원학생수가 3그룹 중에서 가장 높고, 그 외 문항에서도 평균점수가 우수한 그룹이었음.

```{r}
#| echo: false
#| message: false
#| warning: false
# K-means 군집분석 및 결과 출력 (통합 코드)
set.seed(123)
k3_result <- kmeans(cluster_scaled, centers = 3, nstart = 25)

# 군집 결과 추가
dat_cluster_final <- dat_cluster %>%
  mutate(군집 = as.factor(k3_result$cluster))

# 군집별 기술통계 계산 및 세로 형태로 변환
cluster_summary_long <- dat_cluster_final %>%
  group_by(군집) %>%
  summarise(
    학교수 = n(),
    정책인지도_평균 = round(mean(정책인지도), 2),
    홍보충분성_평균 = round(mean(홍보충분성), 2),
    협력중요성_평균 = round(mean(협력중요성), 2),
    협력실행도_평균 = round(mean(협력실행도), 2),
    팀운영횟수_평균 = round(mean(팀운영횟수), 2),
    지원학생수_평균 = round(mean(지원학생수), 2),
    .groups = "drop"
  ) %>%
  pivot_longer(cols = -군집, names_to = "변수", values_to = "값") %>%
  pivot_wider(names_from = 군집, values_from = 값) %>%
  mutate(
    변수 = recode(변수,
                 "학교수" = "학교수",
                 "정책인지도_평균" = "정책인지도 평균",
                 "홍보충분성_평균" = "홍보충분성 평균", 
                 "협력중요성_평균" = "협력중요성 평균",
                 "협력실행도_평균" = "협력실행도 평균",
                 "팀운영횟수_평균" = "팀운영횟수 평균",
                 "지원학생수_평균" = "지원학생수 평균")
  )

print("군집별 특성 요약:")
print(cluster_summary_long, n = Inf)
```

```{r}
#| echo: false
#| message: false
#| warning: false

# PCA 기반 군집 시각화
fviz_cluster(k3_result, data = cluster_scaled,
             palette = c("#2E8B57", "#FF6B6B", "#4ECDC4"),
             geom = "point",
             ellipse.type = "convex",
             ggtheme = theme_bw()) +
  labs(title = "학교 특성별 군집분석 결과")
```

초등학교의 경우, 1그룹은 93교(18%), 2그룹은 230교(44.4%), 3그룹은 195교(37.6%)로 나타났음. 정책인식도나 취지에 대한 이해도는 높으나 상대적으로 통합지원팀 운영이 원활하지 않은 학교 비중이 높은 것으로 나타났음

중학교의 경우, 1그룹은 65교(18.7%), 2그룹은 130교(37.5%), 3그룹은 152교(43.8%)으로, 정책인식도나 취지에 대한 이해도가 높고, 통합지원팀 운영도 원활한 학교의 비중이 가장 높은 것으로 나타났음

고등학교의 경우, 1그룹은 114교(43.2%), 2그룹은 79교(29.9%), 3그룹은 71교(26.9%)으로, 정책이해도나 취지에 대한 이해도가 낮고 통합지원팀 운영도 원활하지 않은 학교의 비중이 가장 높은 것으로 나타남

특수학교의 경우, 1그룹은 10교(58.8%), 2그룹은 5교(29.4%), 3그룹은 2교(11.8%)로 정책이해도나 취지에 대한 이해도가 낮고 통합지원팀 운영도 원활하지 않은 학교의 비중이 가장 높은 것으로 나타남

각종학교의 경우, 1그룹은 2교(22.2%), 2그룹은 6교(66.7%), 3그룹은 1교(11.1%)으로 정책인식도나 취지에 대한 이해도는 높으나 상대적으로 통합지원팀 운영이 원활하지 않은 학교 비중이 높은 것으로 나타났음

```{r}
#| echo: false
#| message: false
#| warning: false

# 학교급별 군집 분포 데이터 준비 (순서 지정)
school_cluster <- dat_cluster_final %>%
  count(학교급, 군집) %>%
  group_by(학교급) %>%
  mutate(비율 = round(n/sum(n)*100, 1)) %>%
  ungroup() %>%
  mutate(학교급 = factor(학교급, 
                     levels = c("초등학교", "중학교", "고등학교", "특수학교", "각종학교"))) %>%
  arrange(학교급, 군집)

# 학교급별 합계 추가된 요약표 생성
school_summary_with_total <- school_cluster %>% 
  select(학교급, 군집, n, 비율) %>%
  # 각 학교급별 합계 계산
  group_by(학교급) %>%
  bind_rows(
    school_cluster %>%
      group_by(학교급) %>%
      summarise(n = sum(n), .groups = "drop") %>%
      mutate(군집 = "합계", 비율 = 100.0) %>%
      select(학교급, 군집, n, 비율)
  ) %>%
  ungroup() %>%
  arrange(
    factor(학교급, levels = c("초등학교", "중학교", "고등학교", "특수학교", "각종학교")),
    군집 == "합계",  # 합계가 마지막에 오도록
    군집
  ) %>%
  # 전체 합계도 추가
  bind_rows(
    school_cluster %>%
      summarise(n = sum(n)) %>%
      mutate(학교급 = "전체 합계", 군집 = "합계", 비율 = 100.0) %>%
      select(학교급, 군집, n, 비율)
  )

print("학교급별 군집 분포 요약 (합계 포함):")
print(school_summary_with_total, n = Inf)

# facet_wrap을 사용한 시각화
ggplot(school_cluster, aes(x = 군집, y = n, fill = 군집)) +
  geom_col(width = 0.6) +
  geom_text(aes(label = paste0(n, "개교 (", 비율, "%)")), 
            vjust = -0.3, hjust = 0.5,
            size = 4.5, fontface = "bold", color = "black") +
  facet_wrap(~ 학교급, scales = "free_y", ncol = 3) +
  labs(title = "학교급별 군집 분포",
       x = "군집", 
       y = "학교 수",
       fill = "학교 유형") +
  scale_fill_manual(values = c("#2E8B57", "#FF6B6B", "#4ECDC4"),
                    labels = c("1군집", "2군집", "3군집")) +
  scale_x_discrete(labels = c("1군집", "2군집", "3군집")) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.15))) +
  theme_minimal(base_size = 12) +
  theme(
    plot.title = element_text(size = 32, face = "bold", hjust = 0.5),
    axis.title.y = element_text(size = 16, angle = 0, vjust = 0.5),
    axis.text.x = element_text(size = 18),
    axis.text.y = element_text(size = 18),
    strip.text = element_text(size = 12, face = "bold"),
    legend.position = "bottom"
  )
```







